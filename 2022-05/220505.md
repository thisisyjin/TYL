# React.js

**Today I Learned ... **`react.js`

>ğŸ™‹â€â™‚ï¸ [**Reference Book**](https://thebook.io/080203/)

>ğŸ™‹â€ [**My Dev Blog**](https://mywebproject.tistory.com/)

***

> **ë¦¬ì•¡íŠ¸ë¥¼ ë‹¤ë£¨ëŠ” ê¸°ìˆ  DAY 18**
- Redux Middleware 


# Redux ë¯¸ë“¤ì›¨ì–´ 


- ë¯¸ë“¤ì›¨ì–´ì—ì„œëŠ” íŠ¹ì • ì¡°ê±´ì— ë”°ë¼ ì•¡ì…˜ì„ ë¬´ì‹œí• ìˆ˜ë„ ìˆê³ , íŠ¹ì • ì¡°ê±´ì— ë”°ë¼ ì•¡ì…˜ ì •ë³´ë¥¼ ê°€ë¡œì±„ì„œ ë³€ê²½í•œ í›„ ë¦¬ë“€ì„œì—ê²Œ ì „ë‹¬í•  ìˆ˜ë„ ìˆìŒ.
-> ì´ëŸ¬í•œ ë¦¬ë•ìŠ¤ ë¯¸ë“¤ì›¨ì–´ì˜ ì†ì„±ì„ ì‚¬ìš©í•˜ì—¬ ë„¤íŠ¸ì›Œí¬ ìš”ì²­ ë“±ì˜ **ë¹„ë™ê¸° ì‘ì—…**ì„ ê´€ë¦¬í•˜ë©´ ìœ ìš©.


## redux-logger ì‚¬ìš©

- ìš°ë¦¬ê°€ ì§ì ‘ ìƒì„±í•œ loggerMiddleware.js ë³´ë‹¤ í›¨ì”¬ ì˜ ë§Œë“¤ì–´ì§„ ë¼ì´ë¸ŒëŸ¬ë¦¬ì„.

``` bash
$ yarn add redux-logger
```

index.js
``` js
import React from 'react';
import ReactDOM from 'react-dom/client';
import App from './App';
import './index.css'
import { applyMiddleware, createStore } from 'redux';
import { Provider } from 'react-redux';
import rootReducer from './modules';
// import loggerMiddleWare from './lib/loggerMiddleware';
import { createLogger } from 'redux-logger';


const logger = createLogger();
const store = createStore(rootReducer, applyMiddleware(logger));

const root = ReactDOM.createRoot(document.getElementById('root'));
root.render(
  <Provider store={store}>
    <App />
  </Provider>
);
```
- redux-logger ë¼ì´ë¸ŒëŸ¬ë¦¬ì˜ `createLogger` í•¨ìˆ˜ë¥¼ ì„í¬íŠ¸í•œ í›„,
`const logger= createLogger();`ì„ í•´ì„œ **applyMiddleware í•¨ìˆ˜**ì˜ ì¸ìë¡œ ë„£ì–´ì¤Œ.

### consoleì°½ ê²°ê³¼
![](https://velog.velcdn.com/images/thisisyjin/post/96ccdaf7-2e0b-47ef-8cf6-10702c8e2832/image.png) - ì½˜ì†”ì— ìƒ‰ìƒë„ ì…í˜€ì§€ê³ , ì•¡ì…˜ íƒ€ì… ë’¤ì— **ì•¡ì…˜ ë””ìŠ¤íŒ¨ì¹˜ ì‹œê°„**ë„ ë‚˜íƒ€ë‚¨.

<br>


> cf- loggerMiddleware.js ì‚¬ìš©ì‹œ
![](https://velog.velcdn.com/images/thisisyjin/post/eec2f321-207d-4485-8b3a-38aee04abf2a/image.png)
- ì—¬ê¸°ì„œëŠ” ì§ì ‘ loggerMiddleware.js ì—ì„œ console.groupê³¼ console.logë¡œ ì‘ì„±í•´ì¤¬ì—ˆìŒ.


***

## ë¹„ë™ê¸° ì‘ì—…ì„ ì²˜ë¦¬í•˜ëŠ” ë¯¸ë“¤ì›¨ì–´

- ë¹„ë™ê¸° ì‘ì—…ì‹œ ë„ì›€ì„ ì£¼ëŠ” ë¯¸ë“¤ì›¨ì–´ëŠ” ë§¤ìš° ë‹¤ì–‘í•¨.
- ì´ í”„ë¡œì íŠ¸ì—ì„œëŠ” `redux-thunk`ì™€ `redux-saga`ë¥¼ ì‚¬ìš©í•¨.

| redux-thunk | redux-saga |
| :-: | :-: |
| ê°ì²´ê°€ ì•„ë‹Œ **í•¨ìˆ˜í˜•íƒœ**ì˜ ì•¡ì…˜ì„ ë””ìŠ¤íŒ¨ì¹˜ í•´ì¤Œ | íŠ¹ì • ì•¡ì…˜ì´ ë””ìŠ¤íŒ¨ì¹˜ ë  ë•Œ,  ì •í•´ì§„ ë¡œì§ì— ë”°ë¼ ë‹¤ë¥¸ ì•¡ì…˜ì„ ë””ìŠ¤íŒ¨ì¹˜ <br> ì‹œí‚¤ëŠ” ê·œì¹™ì„ ì‘ì„±í•˜ì—¬ ë¹„ë™ê¸° ì‘ì—… ì²˜ë¦¬ |


### 1. redux-thunk

- ë¦¬ë•ìŠ¤ì˜ ì°½ì‹œìì¸ Dan Abranmovê°€ ë§Œë“  ë¼ì´ë¸ŒëŸ¬ë¦¬. 
- ê³µì‹ ë©”ë‰´ì–¼ì—ì„œë„ ì´ ë¯¸ë“¤ì›¨ì–´ë¡œ ë¹„ë™ê¸° ì‘ì—…ì„ ë‹¤ë£¸.

> #### ğŸ™‹â€â™‚ï¸ Thunk ë€?
- íŠ¹ì • ì‘ì—…ì„ ë‚˜ì¤‘ì— í•  ìˆ˜ ìˆë„ë¡ ë¯¸ë£¨ê¸° ìœ„í•´ì„œ **í•¨ìˆ˜ í˜•íƒœë¡œ ê°ì‹¼ í˜•íƒœ**.
-> í•¨ìˆ˜ê°€ í˜¸ì¶œë˜ì–´ì•¼ë§Œ ì‹¤í–‰ë¨. (í•¨ìˆ˜ë¥¼ ë¦¬í„´í•˜ëŠ” í•¨ìˆ˜. **ê³ ì°¨í•¨ìˆ˜**)


- redux-thunk ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ì‚¬ìš©í•˜ë©´ thunk í•¨ìˆ˜ë¥¼ ìƒì„±í•´ì„œ ë””ìŠ¤íŒ¨ì¹˜ í•  ìˆ˜ ìˆë‹¤.
-> ë¦¬ë•ìŠ¤ ë¯¸ë“¤ì›¨ì–´ê°€ thunk í•¨ìˆ˜ë¥¼ ì „ë‹¬ë°›ì•„ store.`dispatch`ì™€ store.`getState`ë¥¼ ì¸ìë¡œ ë„£ì–´ í˜¸ì¶œí•´ì¤Œ.

``` js
const sampleThunk = () => (dispatch, getState) => {
 	// í˜„ì¬ state ì°¸ì¡° ê°€ëŠ¥
    // ìƒˆ ì•¡ì…˜ ë””ìŠ¤íŒ¨ì¹˜ ê°€ëŠ¥
}
```

### redux-thunk ë¯¸ë“¤ì›¨ì–´ ì ìš©

#### 1) íŒ¨í‚¤ì§€ ì„¤ì¹˜
``` bash
$ yarn add redux-thunk
```

#### 2) import ReduxThunk

index.js
``` JSX
import React from 'react';
import ReactDOM from 'react-dom/client';
import App from './App';
import './index.css'
import { applyMiddleware, createStore } from 'redux';
import { Provider } from 'react-redux';
import rootReducer from './modules';
// import loggerMiddleWare from './lib/loggerMiddleware';
import { createLogger } from 'redux-logger';
import ReduxThunk from 'redux-thunk';


const logger = createLogger();
const store = createStore(rootReducer, applyMiddleware(logger, ReduxThunk));

const root = ReactDOM.createRoot(document.getElementById('root'));
root.render(
  <Provider store={store}>
    <App />
  </Provider>
);
```
- createStore(rootReducer, applyMiddleware(logger, ReduxThunk))
-> applyMiddleware í•¨ìˆ˜ì˜ ë‘ë²ˆì§¸ ì¸ìë¡œ `ReduxThunk`ë¥¼ ë„£ì–´ì¤Œ.


#### 3) Thunk ìƒì„±í•¨ìˆ˜
- `redux-thunk`ì˜ ì•¡ì…˜ ìƒì„±í•¨ìˆ˜ëŠ” ì¼ë°˜ ì•¡ì…˜ ê°ì²´ë¥¼ ë°˜í™˜í•˜ì§€ ì•Šê³ , **í•¨ìˆ˜ë¥¼ ë°˜í™˜í•¨**.
- counter ëª¨ë“ˆì˜ ì•¡ì…˜ ìƒì„±í•¨ìˆ˜ì¸ increaseAsync, decreaseAsync í•¨ìˆ˜ë¥¼ ë§Œë“¤ì–´ë³´ì.


modules/counter.js
``` jsx
// Thunk í•¨ìˆ˜ (=ê³ ì°¨í•¨ìˆ˜. ë‘ë²ˆì§¸ ì¸ìë¡œ dispatch, getStateë¥¼ ì¤„ìˆ˜ìˆìŒ)
export const increaseAsync = () => dispatch => {
    setTimeout(() => {
        dispatch(increase());
    }, 1000);
};

export const decreaseAsync = () => dispatch => {
    setTimeout(() => {
        dispatch(decrease());
    }, 1000);
};
```

#### 4) CounterContainer ìˆ˜ì •

container/CounterContainer.js

``` jsx
import { connect } from "react-redux";
import { increaseAsync, decreaseAsync } from "../modules/counter";
import Counter from "../components/Counter";

const CounterContainer = ({ number, increaseAsync, decreaseAsync }) => {
    return (
        <Counter
            number={number}
            onIncrease={increaseAsync}
            onDecrease={decreaseAsync}
        />
    );
};

export default connect(
    state => ({
        number: state.counter
    }),
    {
        increaseAsync,
        decreaseAsync
    }
)(CounterContainer);
```

#### consoleì°½ ê²°ê³¼

![](https://velog.velcdn.com/images/thisisyjin/post/dd09e02b-8760-436a-b63e-a0d20db32078/image.png)

- ì²˜ìŒì— +1ë²„íŠ¼ì„ ëˆ„ë¥´ë©´ ì½˜ì†”ì´ ì°íˆëŠ”ë°, **prev state, next state** ëª¨ë‘ 0ì´ë‹¤.
-> ì´ë•Œ action ê°ì²´ë¥¼ ë³´ë©´ `dispatch => { setTimeout(...)}` í•¨ìˆ˜ì„ì„ ì•Œ ìˆ˜ ìˆë‹¤.


- ì¦‰, increaseAsyncí•¨ìˆ˜ëŠ” **ì•¡ì…˜ ìƒì„±í•¨ìˆ˜ì§€ë§Œ í•¨ìˆ˜ë¥¼ ë¦¬í„´**í•œë‹¤.
-> ë¦¬í„´í•œ í•¨ìˆ˜ì— ì˜í•´ **1ì´ˆ í›„ì— ì•¡ì…˜ ê°ì²´ê°€ ìƒì„±**ë˜ëŠ” ê²ƒ.

- 1ì´ˆ í›„, 1ì´ ì¦ê°€í•˜ë©´ì„œ ì½˜ì†”ì´ ë‹¤ì‹œ í•œë²ˆ ì°íŒë‹¤.
-> action ê°ì²´ë¥¼ ë³´ë©´ ì •ìƒì ìœ¼ë¡œ ê°ì²´íƒ€ì…ì´ ë‚˜ì˜¨ë‹¤.


### ì›¹ ìš”ì²­ ë¹„ë™ê¸° ì‘ì—… ì²˜ë¦¬ (axios)

- [JSONPlaceholder](https://jsonplaceholder.typicode.com/) ì—ì„œ ì œê³µí•˜ëŠ” ê°€ì§œ APIë¥¼ ì‚¬ìš©.
- API í˜¸ì¶œì‹œ ì£¼ë¡œ **Promise ê¸°ë°˜ ì›¹ í´ë¼ì´ì–¸íŠ¸**ì¸ `axios`ë¥¼ ì‚¬ìš©í•¨.

> ğŸ”º [Axios](https://axios-http.com/kr/docs/intro)ë€?
AxiosëŠ” node.jsì™€ ë¸Œë¼ìš°ì €ë¥¼ ìœ„í•œ **Promise ê¸°ë°˜ HTTP í´ë¼ì´ì–¸íŠ¸** ì…ë‹ˆë‹¤. 
ì„œë²„ ì‚¬ì´ë“œì—ì„œëŠ” ë„¤ì´í‹°ë¸Œ node.jsì˜ http ëª¨ë“ˆì„ ì‚¬ìš©í•˜ê³ , 
í´ë¼ì´ì–¸íŠ¸(ë¸Œë¼ìš°ì €)ì—ì„œëŠ” XMLHttpRequestsë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤.

#### 1. API í•¨ìˆ˜í™”
``` bash
$ yarn add axios
```

lib/api.js

``` js
import axios from 'axios';

export const getPost = id =>
    axios.get(`https://jsonplaceholder.typicode.com/posts/${id}`);

export const getUsers = id =>
    axios.get(`https://jsonplaceholder.typicode.com/users`);
```
= APIë¥¼ ëª¨ë‘ **í•¨ìˆ˜í™”** í•´ì¤Œ.
ê° APIë¥¼ í˜¸ì¶œí•˜ëŠ” í•¨ìˆ˜ë¥¼ ë”°ë¡œ ì‘ì„±í•˜ë©´, ë‚˜ì¤‘ì— ì‚¬ìš©í•  ë•Œ ê°€ë…ì„±ë„ ì¢‹ê³  ìœ ì§€ë³´ìˆ˜ë„ ìš©ì´í•¨.

### 2. ë¦¬ë“€ì„œ ìƒì„±
- APIë¥¼ ì‚¬ìš©í•˜ì—¬ ë°ì´í„°ë¥¼ ë°›ì•„ì™€ ìƒíƒœë¥¼ ê´€ë¦¬í•  **ë¦¬ë“€ì„œ** ìƒì„±.

modules/sample.js
``` js
import { handleActions } from 'redux-actions';
import * as api from '../lib/api';

// ì•¡ì…˜ íƒ€ì… ì„ ì–¸. (í•œ requestë‹¹ 3ê°œì˜ ì•¡ì…˜)

const GET_POST = 'sample/GET_POST';
const GET_POST_SUCCESS = 'sample/GET_POST_SUCCESS';
const GET_POST_FAILURE = 'sample/GET_POST_FAILURE';

const GET_USERS = 'smaple/GET_USERS';
const GET_USERS_SUCCESS = 'smaple/GET_USERS_SUCCESS';
const GET_USERS_FAILURE = 'smaple/GET_USERS_FAILURE';


// thunk í•¨ìˆ˜ ìƒì„± (í•¨ìˆ˜ë¥¼ ë¦¬í„´í•˜ëŠ” ì•¡ì…˜ ìƒì„±í•¨ìˆ˜)

export const getPost = id => async dispatch => {
    dispatch({ type: GET_POST }); // ìš”ì²­ ì‹œì‘
    try {
        const response = await api.getPost(id);
        dispatch({
            type: GET_POST_SUCCESS,
            payload: response.data
        });
    } catch (e) {
        dispatch({
            type: GET_POST_FAILURE,
            payload: e,
            error: true
        });
        throw e;
    }
};

export const getUsers = () => async dispatch => {
    dispatch({ type: GET_USERS }); // ìš”ì²­ ì‹œì‘
    try {
        const response = await api.getUsers();
        dispatch({
            type: GET_USERS_SUCCESS,
            payload: response.data
        });
    } catch (e) {
        dispatch({
            type: GET_USERS_FAILURE,
            payload: e,
            error: true
        });
        throw e;
    }
};

// initialState ì„ ì–¸

const initialState = {
    loading: {
        GET_POST: false,
        GET_USERS: false
    },
    post: null,
    users: null
};


// reducer í•¨ìˆ˜
const sample = handleActions(
    {
        [GET_POST]: state => ({
            ...state,
            loading: {
                ...state.loading,
                GET_POST: true
            }
        }),
        [GET_POST_SUCCESS]: (state, action) => ({
            ...state,
            loading: {
                ...state.loading,
                GET_POST: false // ë¡œë”© ì™„ë£Œ(ìš”ì²­ì™„ë£Œ)
            },
            post: action.payload
        }),
        [GET_POST_FAILURE]: (state, action) => ({
            ...state,
            loading: {
                ...state.loading,
                GET_POST: false
            },
        }),

        [GET_USERS]: state => ({
            ...state,
            loading: {
                ...state.loading,
                GET_USERS: true
            }
        }),
        [GET_USERS_SUCCESS]: (state, action) => ({
            ...state,
            loading: {
                ...state.loading,
                GET_USERS: false
            },
            users: action.payload
        }),
        [GET_USERS_FAILURE]: (state, action) => ({
            ...state,
            loading: {
                ...state.loading,
                GET_USERS: false
            },
        })
    },
    initialState
);

export default sample;
```

> âš¡ï¸ thunk í•¨ìˆ˜ í˜•íƒœ
``` js
export const thunkFunc = () => (async) dispatch => {
	// ë¹„ë™ê¸° ì•ˆì— dispatch()
  	// setTimeout ë˜ëŠ” (asyncì˜ ê²½ìš°) await / try-catch
}
```


#### 3. rootReducerë¡œ í•©ì³ì¤Œ
modules/index.js
``` js
import { combineReducers } from 'redux';
import counter from './counter';
import sample from './sample';

const rootReducer = combineReducers({
    counter,
    sample
});

export default rootReducer;
```

<br>

#### 4. í”„ë ˆì  í…Œì´ì…”ë„ ì»´í¬ë„ŒíŠ¸ ì‘ì„±

components/Sample.js

``` jsx
const Sample = ( loadingPost, loadingUsers, post, users ) => {

    return (
        <div>
            <section>
                <h1>í¬ìŠ¤íŠ¸</h1>
                {loadingPost && 'ë¡œë”© ì¤‘...'}
                {!loadingPost && post && (
                    <div>
                        <h3>{post.title}</h3>
                        <h3>{post.body}</h3>
                    </div>
                )}
            </section>
            <hr />
            <section>
                <h1>ì‚¬ìš©ì ëª©ë¡</h1>
                {loadingUsers && 'ë¡œë”©ì¤‘ ...'}
                {!loadingUsers && users && (
                    <ul>
                        {users.map(user => (
                            <li key={user.id}>
                                {user.username} ({user.email})
                            </li>
                        ))}
                    </ul>
                )}
            </section>
        </div>
    );
}

export default Sample;
```

- ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì™€ì„œ ë Œë”ë§ í• ë•ŒëŠ” ìœ íš¨ì„± ê²€ì‚¬ë¥¼ í•´ì¤˜ì•¼ í•¨.
``` jsx
{!loadingUsers && users && (
  // JSX
 }
```
-> ì•„ì§ usersê°€ undefined ì¸ë° user.idë‚˜ user.emailì„ ë¶ˆëŸ¬ì˜¤ë ¤ë©´ ì—ëŸ¬ê°€ ë°œìƒí•¨.
ë˜í•œ, map í•¨ìˆ˜ì— undefinedê°€ ë“¤ì–´ê°€ë©´ ì—ëŸ¬ê°€ ë°œìƒë  ìˆ˜ ìˆìŒ.



<br>

#### 5. ì»¨í…Œì´ë„ˆ ì»´í¬ë„ŒíŠ¸ ìƒì„±

containers/SampleContainer.js

``` js
import { useEffect } from "react";
import { connect } from "react-redux";
import Sample from "../components/Sample";

import { getPost, getUsers } from '../modules/sample'; // thunk í•¨ìˆ˜

const SampleContainer = ({
    getPost,
    getUsers,
    post,
    users,
    loadingPost,
    loadingUsers
}) => {

    useEffect(() => {
        getPost(1);
        getUsers(1);
    }, [getPost, getUsers]);

    return (
        <Sample
            post={post}
            users={users}
            loadingPost={loadingPost}
            loadingUsers={loadingUsers}
        />
    );
}

export default connect(
    ({ sample }) => ({
        post: sample.post,
        users: sample.users,
        loadingPost: sample.loading.GET_POST,
        loadingUsers: sample.loading.GET_USERS
    }),
  {
    getPost,
    getUsers
  }
)(SampleContainer);
``` 


### 6. App ë Œë”ë§
- CounterContainerì„ ëŒ€ì‹  SampleContainerì„ ë Œë”ë§í•¨.
App.js
``` jsx
import SampleContainer from "./containers/SampleContainer";

function App() {
  return (
    <div>
      <SampleContainer/>
    </div>
  );
}

export default App;
```

***

## ë¦¬íŒ©í† ë§


- APIë¥¼ ìš”ì²­í•  ë•Œ ë§ˆë‹¤ thunk í•¨ìˆ˜ë¥¼ ì‘ì„±í•˜ëŠ” ê²ƒê³¼, ë¡œë”© ìƒíƒœ(loadingPost, loadingUsers)ë¥¼ reduce í•¨ìˆ˜ì—ì„œ ê´€ë¦¬í•˜ëŠ” ê²ƒì€ ë²ˆê±°ë¡œì›€.
-> ë°˜ë³µë˜ëŠ” ë¡œì§ì´ë¯€ë¡œ, ë”°ë¡œ ë¶„ë¦¬í•˜ì—¬ ì½”ë“œì˜ ì–‘ì„ ì¤„ì¼ ìˆ˜ ìˆìŒ.


### creteRequsetThunk ëª¨ë“ˆ ìƒì„±

lib/createRequestThunk.js
``` js
export default function createRequestThunk(type, request) {
    // ì„±ê³µ ë° ì‹¤íŒ¨ ì•¡ì…˜íƒ€ì… ì •ì˜
    const SUCCESS = `${type}_SUCCESS`;
    const FAILURE = `${type}_FAILURE`;

    return params => async dispatch => {
        dispatch({ type }); // dispatch({type: GET_USERS}) - ì‹œì‘ ì•ˆë‚´
        try {
            const response = await request(params);
            dispatch({
                type: SUCCESS,
                payload: response.data
            });
        } catch (e) {
            dispatch({
                type: FAILURE,
                payload: e,
                error: true
            });
            throw e;
        }
    };
}
```

ğŸ”» example
``` js
createRequestThunk('GET_USERS', api.getUsers);
```
-> ì°¸ê³ ë¡œ **api.getUsers**ëŠ” axios.get(url) ì´ë‹¤. ì¦‰, request line.

### sample ëª¨ë“ˆ (ìˆ˜ì •)


- ìˆ˜ì • ì „
``` js
export const getPost = id => async dispatch => {
    dispatch({ type: GET_POST }); // ìš”ì²­ ì‹œì‘
    try {
        const response = await api.getPost(id);
        dispatch({
            type: GET_POST_SUCCESS,
            payload: response.data
        });
    } catch (e) {
        dispatch({
            type: GET_POST_FAILURE,
            payload: e,
            error: true
        });
        throw e;
    }
};
```

- ìˆ˜ì • í›„ 
``` js
export const getPost = createRequestThunk(GET_POST, api.getPost);
```



### loading ëª¨ë“ˆ ìƒì„±

- reducer ë‚´ë¶€ì—ì„œ loadingìƒíƒœë¥¼ ê´€ë¦¬í•  í•„ìš”ê°€ ì—†ë„ë¡ loading ëª¨ë“ˆì„ ìƒì„±.

``` js
import { createAction, handleActions } from "redux-actions";

const START_LOADING = 'loading/START_LOADING';
const FINISH_LOADING = 'loading/FINISH_LOADING';

/* 

ìš”ì²­ì„ ìœ„í•œ ì•¡ì…˜ íƒ€ì…ì„ payloadë¡œ ì„¤ì • (ex- sample/GET_POST)

*/

export const startLoading = createAction(
    START_LOADING,
    requestType => requestType
);

export const finishLoading = createAction(
    FINISH_LOADING,
    requestType => requestType
);

const initialState = {};

const loading = handleActions(
    {
        [START_LOADING]: (state, action) => ({
            ...state,
            [action.payload]: true
        }),
        [FINISH_LOADING]: (state, action) => ({
            ...state,
            [action.payload]: false
        })
    },
    initialState
);

export default loading;

```

- ìš”ì²­ì´ ì‹œì‘ë˜ë©´ ì•„ë˜ ì•¡ì…˜ì„ ë””ìŠ¤íŒ¨ì¹˜í•¨.
``` js
{
   type: 'loading/START_LOADING,
   payload: 'sample/GET_POST
}
```

loading ë¦¬ë“€ì„œí•¨ìˆ˜ê°€ ê´€ë¦¬í•˜ê³  ìˆëŠ” stateì—ì„œ sample/GET_POST ê°’ì„ trueë¡œ ì„¤ì •í•´ì¤Œ.
- ë§Œì•½ ê¸°ì¡´ stateì— sample/GET_POST í•„ë“œê°€ ì—†ë‹¤ë©´, ìƒˆë¡œ ê°’ì„ ì„¤ì •í•´ì¤Œ.


### createRequestThunk ìˆ˜ì •
``` js
import { startLoading, finishLoading } from "../modules/loading";

export default function createRequestThunk(type, request) {
    // ì„±ê³µ ë° ì‹¤íŒ¨ ì•¡ì…˜íƒ€ì… ì •ì˜
    const SUCCESS = `${type}_SUCCESS`;
    const FAILURE = `${type}_FAILURE`;

    return params => async dispatch => {
        dispatch({ type }); // dispatch({type: GET_USERS}) - ì‹œì‘ ì•ˆë‚´
        try {
            const response = await request(params);
            dispatch({
                type: SUCCESS,
                payload: response.data
            });
            dispatch(finishLoading(type));  // ğŸ‘ˆ ì¶”ê°€
        } catch (e) {
            dispatch({
                type: FAILURE,
                payload: e,
                error: true
            });
            dispatch(finishLoading(type));  // ğŸ‘ˆ ì¶”ê°€
            throw e;
        }
    };
}
```

### SampleContainer.js
- ë¡œë”©ìƒíƒœ ì¡°íšŒ ê°€ëŠ¥.
``` js
...
export default connect(
    ({ sample, loading }) => ({
        post: sample.post,
        users: sample.users,
        loadingPost: loading['sample/GET_POST'], // ğŸ‘ˆ ì¶”ê°€
        loadingUsers: loading['sample/GET_USERS']
    }),
    {
        getPost,
        getUsers
    }
)(SampleContainer);
```

connect í•¨ìˆ˜ì˜ ì²«ë²ˆì§¸ ì¸ìëŠ” mapStateToPropsë¡œ, stateë¥¼ ë°›ì•„ì˜¨ë‹¤.
ì¸ìë¡œ ({ sample, loading })ê³¼ ê°™ì´ êµ¬ì¡°ë¶„í•´ í• ë‹¹ì„ í•´ì„œ state.sample, state.loadingì„ ë°›ì•„ì˜´.


### sample ëª¨ë“ˆ ìˆ˜ì •
- ë¶ˆí•„ìš”í•œ (ì¤‘ë³µëœ)ì½”ë“œë¥¼ ì œê±°í•¨.
``` js
...
// reducer í•¨ìˆ˜
const sample = handleActions(
    {     
        [GET_POST_SUCCESS]: (state, action) => ({
            ...state,
            post: action.payload
        }),
        
        [GET_USERS_SUCCESS]: (state, action) => ({
            ...state,
            users: action.payload
        }),
    },
    initialState
);
```
- `_SUCCESS`ë¥¼ ì œì™¸í•œ ë‚˜ë¨¸ì§€ í•„ë“œë“¤ì„ ëª¨ë‘ ì§€ì›Œì¤€ë‹¤.
- loadingì„ ê´€ë¦¬í•´ì£¼ë˜ ì½”ë“œë¥¼ ë‹¤ ì§€ì›Œì¤€ë‹¤.

-> loading ì¤‘ì— ëŒ€í•œ ìƒíƒœë¥¼ ê´€ë¦¬í•  í•„ìš”ê°€ X.

> ì—ëŸ¬ì‹œ (ì‹¤íŒ¨ì‹œ) ì½”ë“œë¥¼ ê´€ë¦¬í•˜ê³  ì‹¶ë‹¤ë©´, `_FAILURE`ì´ ë¶™ì€ ì•¡ì…˜ì„ ë¦¬ë“€ì„œì—ì„œ ì²˜ë¦¬í•´ì£¼ë©´ ë¨.
ë˜ëŠ”, ì»¨í…Œì´ë„ˆ ì»´í¬ë„ŒíŠ¸ì—ì„œ try-catchë¬¸ì„ ì´ìš©í•˜ì—¬ ì—ëŸ¬ë¥¼ ì¡°íšŒí•  ìˆ˜ ìˆìŒ.

#### try-catchë¬¸
containers/SampleContainer.js

- ìˆ˜ì • ì „
``` js
...
useEffect(() => {
        getPost(1);
        getUsers(1);
    }, [getPost, getUsers]);
...
```

- ìˆ˜ì • í›„
``` js
useEffect(() => {
        const fn = async () => {
            try {
                await getPost(1);
                await getUsers(1);
            } catch (e) {
                console.log(e);
            }
        };
        fn();
    }, [getPost, getUsers]);
```
- useEffect ì•ˆì—ì„œ async í•¨ìˆ˜ë¥¼ ì“°ë ¤ë©´ ë°˜ë“œì‹œ ë‚´ë¶€ì—ì„œ ì„ ì–¸ í›„ í˜¸ì¶œí•´ì¤˜ì•¼ í•œë‹¤.


***

## [redux-saga](https://react.vlpt.us/redux-middleware/10-redux-saga.html)

- ìë°”ìŠ¤í¬ë¦½íŠ¸ì˜ `Generator` ë¬¸ë²•ê³¼ í•¨ê»˜ ì‚¬ìš©ë¨.
- í•¨ìˆ˜ë¥¼ ì‘ì„± í• ë•Œ, í•¨ìˆ˜ë¥¼ íŠ¹ì • êµ¬ê°„ì— ë©ˆì¶°ë†“ê±°ë‚˜ ì›í•  ë•Œ ë‹¤ì‹œ ëŒì•„ê°€ê²Œ í•  ìˆ˜ë„ ìˆìŒ.

### ì œë„¤ë ˆì´í„° í•¨ìˆ˜
> 
``` js
function* generatorFunction() {
    console.log('ì•ˆë…•í•˜ì„¸ìš”?');
    yield 1;
    console.log('ì œë„ˆë ˆì´í„° í•¨ìˆ˜');
    yield 2;
    console.log('function*');
    yield 3;
    return 4;
}
>
const generator = generatorFunction(); // ì œë„¤ë ˆì´í„° ê°ì²´ ë°˜í™˜
```

- `function*` ì´ë¼ëŠ” í‚¤ì›Œë“œë¥¼ ì‚¬ìš©í•˜ì—¬ ì •ì˜í•¨.
- ì œë„¤ë ˆì´í„° í•¨ìˆ˜ë¥¼ í˜¸ì¶œí•˜ë©´, **ì œë„¤ë ˆì´í„° ê°ì²´ë¥¼ ë°˜í™˜í•¨**.
- ì¼ë°˜ í•¨ìˆ˜ëŠ” ì—¬ëŸ¬ ê°’ì„ return í•˜ëŠ”ê²ƒì´ ë¶ˆê°€í•˜ì§€ë§Œ, ì œë„¤ë ˆì´í„° í•¨ìˆ˜ì—ì„œëŠ” ê°€ëŠ¥.


- `generator.next()` ë¥¼ í˜¸ì¶œí•´ì•¼ë§Œ ì½”ë“œê°€ ì‹¤í–‰ë˜ë©°, **`yield`ë¥¼ í•œ ê°’ì„ ë°˜í™˜**í•˜ê³  ì½”ë“œì˜ íë¦„ì„ ë©ˆì¶¤.
-> { value: ___ , done: false } í˜•íƒœì˜ ê°ì²´ë¥¼ ë°˜í™˜í•¨.
- íë¦„ì´ ë©ˆì¶”ê³  ë‚˜ì„œ ë‹¤ì‹œ `generator.next()`ë¥¼ í•˜ë©´ ì½”ë“œê°€ ì‹¤í–‰ë¨.



### ì•¡ì…˜ ëª¨ë‹ˆí„°ë§ 

```  js
function* watchGenerator() {
    console.log('ëª¨ë‹ˆí„°ë§ ì‹œì‘!');
    while(true) {			 // ë¬´í•œë£¨í”„. ê³„ì† ëª¨ë‹ˆí„°ë§
        const action = yield;
        if (action.type === 'HELLO') {
            console.log('ì•ˆë…•í•˜ì„¸ìš”?');
        }
        if (action.type === 'BYE') {
            console.log('ì•ˆë…•íˆê°€ì„¸ìš”.');
        }
    }
}
```

-> ì‚¬ìš©ë°©ë²•
``` js
const watch = watchGenerator();

watch.next();   // ëª¨ë‹ˆí„°ë§ ì‹œì‘
watch.next({ type: 'HELLO' });  // 'ì•ˆë…•í•˜ì„¸ìš”?'
watch.next({ type: 'BYE' });  // 'ì•ˆë…•íˆê°€ì„¸ìš”.'
```
ìœ„ì™€ ê°™ì€ ì›ë¦¬ë¡œ redux-sagaì—ì„œëŠ” ì•¡ì…˜ì„ ëª¨ë‹ˆí„°ë§í•˜ê³ ,
íŠ¹ì • ì•¡ì…˜ì´ ë°œìƒí–ˆì„ ë•Œ ì›í•˜ëŠ” ì½”ë“œë¥¼ ì‹¤í–‰ì‹œí‚´.


### 1. saga ìƒì„±

- ìš°ì„ , redux-saga/effects ì—ì„œ `delay`, `put` í•¨ìˆ˜ë¥¼ ì„í¬íŠ¸í•¨.
``` js
import { delay, put } from 'redux-saga/effects';
```


- `redux-saga` ì—ì„œëŠ” ì œë„ˆë ˆì´í„° í•¨ìˆ˜ë¥¼ "ì‚¬ê°€" ë¼ê³  ë¶€ë¦„.
``` js
function* increaseSaga() {
  yield delay(1000); // 1ì´ˆë¥¼ ê¸°ë‹¤ë¦½ë‹ˆë‹¤.
  yield put(increase()); // putì€ íŠ¹ì • ì•¡ì…˜ì„ ë””ìŠ¤íŒ¨ì¹˜ í•´ì¤ë‹ˆë‹¤.
}
function* decreaseSaga() {
  yield delay(1000); // 1ì´ˆë¥¼ ê¸°ë‹¤ë¦½ë‹ˆë‹¤.
  yield put(decrease()); // putì€ íŠ¹ì • ì•¡ì…˜ì„ ë””ìŠ¤íŒ¨ì¹˜ í•´ì¤ë‹ˆë‹¤.
}
```

### 2. rootSaga ìƒì„±

- `redux-saga/effects`ì˜ **all** í•¨ìˆ˜ë¥¼ í†µí•´ **ë£¨íŠ¸ ì‚¬ê°€**ë¥¼ ìƒì„±.
(reducerì„ í•©ì¹˜ëŠ” combineReducersì™€ ë¹„ìŠ·í•œ ëŠë‚Œ)

modules/index.js
``` js
import { all } from 'redux-saga/effects';

const rootReducer = combineReducers({ counter, posts });
export function* rootSaga() {
  yield all([counterSaga()]); // all ì€ ë°°ì—´ ì•ˆì˜ ì—¬ëŸ¬ ì‚¬ê°€ë¥¼ ë™ì‹œì— ì‹¤í–‰ì‹œì¼œì¤ë‹ˆë‹¤.
}
```

### 3. redux-saga ë¯¸ë“¤ì›¨ì–´ ìƒì„±

src/index.js
``` js
...
import createSagaMiddleware from 'redux-saga';

const customHistory = createBrowserHistory();
const sagaMiddleware = createSagaMiddleware(); // ì‚¬ê°€ ë¯¸ë“¤ì›¨ì–´ë¥¼ ë§Œë“­ë‹ˆë‹¤.

const store = createStore(
  rootReducer,
  // logger ë¥¼ ì‚¬ìš©í•˜ëŠ” ê²½ìš°, loggerê°€ ê°€ì¥ ë§ˆì§€ë§‰ì— ì™€ì•¼í•©ë‹ˆë‹¤.
  composeWithDevTools(
    applyMiddleware(
      ReduxThunk.withExtraArgument({ history: customHistory }),
      sagaMiddleware, // ì‚¬ê°€ ë¯¸ë“¤ì›¨ì–´ë¥¼ ì ìš©í•˜ê³ 
      logger
    )
  )
); // ì—¬ëŸ¬ê°œì˜ ë¯¸ë“¤ì›¨ì–´ë¥¼ ì ìš© í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

sagaMiddleware.run(rootSaga); // ë£¨íŠ¸ ì‚¬ê°€ ì‹¤í–‰ (run)
...
```




***
> ### ì •ë¦¬
- react-thunkëŠ” ë¹„ë™ê¸° ì²˜ë¦¬ì‹œ ì¼ë°˜ í•¨ìˆ˜ë¡œ ì´ë£¨ì–´ì ¸ ìˆì–´ ê°„í¸í•˜ì§€ë§Œ
redux-sagaëŠ” ì§„ì… ì¥ë²½ì´ ìˆëŠ” í¸. (but. ë³µì¡í•œ ê²½ìš°ì—ëŠ” ë”ìš± íš¨ìœ¨ì )
>
>
- ë¯¸ë“¤ì›¨ì–´ë¥¼ ì‚¬ìš©í•˜ì§€ ì•Šê³  ì»´í¬ë„ŒíŠ¸ ë‹¨ì—ì„œ API ìš”ì²­ì„ í•´ë„ ë¨.
BUT. ì¢€ ë” í¸í•˜ê²Œ í•˜ê¸° ìœ„í•´ ì‚¬ìš©í•˜ëŠ” ê²ƒì„.
-> ì»´í¬ë„ŒíŠ¸ë‹¨ì—ì„œ í•˜ëŠ” ê²ƒì´ í¸í•˜ë‹¤ë©´ í¸í•œëŒ€ë¡œ í•˜ë©´ ë¨.


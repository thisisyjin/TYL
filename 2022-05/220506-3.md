# React.js

**Today I Learned ... **`react.js`

>ğŸ™‹â€â™‚ï¸ [**Reference book**](https://thebook.io/080203)

>ğŸ™‹â€ [**My Dev Blog**](https://mywebproject.tistory.com)

***

> **CH 20. ì„œë²„ì‚¬ì´ë“œ ë Œë”ë§ - (2)**
part 2 - ì„œë²„ ì½”ë“œ ì‘ì„±(express) / ì •ì  íŒŒì¼ ì œê³µ 


# ì„œë²„ ì‚¬ì´ë“œ ë Œë”ë§


## ì„œë²„ ì½”ë“œ ì‘ì„±

> Express í”„ë ˆì„ì›Œí¬
- node ì›¹ **í”„ë ˆì„ì›Œí¬**. ì›¹ì„œë²„ êµ¬ì¶• ê°€ëŠ¥.
- ExpressëŠ” ì‚¬ìš©ë¥ ë„ ë†’ê³ , ì¶”í›„ ì •ì  íŒŒì¼ í˜¸ìŠ¤íŒ… ì‹œì—ë„ ì‰½ê²Œ êµ¬í˜„ ê°€ëŠ¥í•¨.

- íŒ¨í‚¤ì§€ ì„¤ì¹˜
```
$ yarn add express
```

src/index.server.js (ìˆ˜ì •)

```js
import ReactDOMServer from 'react-dom/server';
import express from 'express';
import { StaticRouter } from 'react-router-dom';
import App from './App';

const app = express();

const serverRender = (req, res, next) => {
    // 404ê°€ ë– ì•¼ í•˜ëŠ” ìƒí™©ì— ì„œë²„ì‚¬ì´ë“œ ë Œë”ë§ì„ í•´ì¤Œ
    const context = {};
    const jsx = ( 
        <StaticRouter location={req.url} context={context}>
            <App />
        </StaticRouter>
    );
    const root = ReactDOMServer.renderToString(jsx); // ë Œë”ë§ì„ í•˜ê³ ë‚˜ì„œ
    res.send(root); // í´ë¼ì´ì–¸íŠ¸ì—ê²Œ response 
}

app.use(serverRender);

app.listen(5000, () => {
    // 5000 í¬íŠ¸ë¡œ ì„œë²„ ê°€ë™
    console.log('Running on http://localhost:5000');
}); 
```

- StaticRouter ì»´í¬ë„ŒíŠ¸ëŠ” ì£¼ë¡œ ì„œë²„ì‚¬ì´ë“œ ë Œë”ë§ ìš©ìœ¼ë¡œ ì‚¬ìš©ë˜ëŠ” ë¼ìš°í„°ì„.
-> propsì¸ `location` ê°’ì— ë”°ë¼ ë¼ìš°íŒ… í•´ì¤Œ.
- ìœ„ì—ì„œëŠ” req.urlì„ ë„£ì–´ì¤Œ. 
reqëŠ” ìš”ì²­(request)ì— ëŒ€í•œ ì •ë³´ë¥¼ ì§€ë‹Œ ê°ì²´ì„.

- `context` ë¼ëŠ” propsë„ ë„£ì–´ì¤˜ì„œ ë‚˜ì¤‘ì— HTTP ìƒíƒœ ì½”ë“œë¥¼ ì„¤ì •í•´ì¤„ ìˆ˜ ìˆìŒ.

<br>

### ğŸ›  Error ë¡œê·¸
> react-router-domì´ v6ë¡œ ì—…ë°ì´íŠ¸ë˜ë©´ì„œ
`StaticRouter`ë¥¼ ì„í¬íŠ¸í•˜ëŠ” ì½”ë“œê°€ ë‹¬ë¼ì¡Œë‹¤.
``` js
import { StaticRouter } from 'react-router-dom/server';
```
-> 'react-router-dom'ì´ ì•„ë‹Œ 'react-router-dom/server'ë¡œ í•´ì£¼ë‹ˆ ì—ëŸ¬ í•´ê²°ë¨.


<br>

### Result

![](https://velog.velcdn.com/images/thisisyjin/post/2982b821-c768-4176-a9cb-c81240e405f9/image.png)

- í˜„ì¬ëŠ” CSSë¥¼ ë¶ˆëŸ¬ì˜¤ì§€ ì•Šê¸° ë•Œë¬¸ì—, ìŠ¤íƒ€ì¼ ì ìš©ë„ ì•ˆë˜ì–´ìˆì–´ì•¼ ì •ìƒì´ë‹¤.
- ìë°”ìŠ¤í¬ë¦½íŠ¸ë„ ì‹¤í–‰ì´ ì•ˆë˜ì–´ìˆìœ¼ë¯€ë¡œ ìœ„ í™”ë©´ì€ ì „ë¶€ ì„œë²„ì‚¬ì´ë“œ ë Œë”ë§ ëœ ê²ƒì´ë‹¤.

-> Network íƒ­ì„ ì‚´í´ë³´ì.

![](https://velog.velcdn.com/images/thisisyjin/post/99965f4f-c783-4e27-954f-380559c865b8/image.png)
-> blueì˜ Response íƒ­ì„ ë³´ë©´, ì»´í¬ë„ŒíŠ¸ ë Œë”ë§ ê²°ê³¼ê°€ ë¬¸ìì—´ë¡œ ì˜ ì „ë‹¬ë˜ê³  ìˆë‹¤.


***

## ì •ì  íŒŒì¼ ì œê³µ
- Expressì˜ ë‚´ì¥ë˜ì–´ìˆëŠ” `static` ë¯¸ë“¤ì›¨ì–´ë¥¼ ì‚¬ìš©í•˜ì—¬ 
ì„œë²„ë¥¼ í†µí•´ buildì— ìˆëŠ” JS, CSS íŒŒì¼ë“¤ì— ì ‘ê·¼í•˜ê²Œ í•´ì¤Œ.

index.server.js (ìˆ˜ì •)
``` jsx
import ReactDOMServer from 'react-dom/server';
import express from 'express';
import { StaticRouter } from 'react-router-dom/server';
import App from './App';
import path from 'path';
// ğŸ”º path ëª¨ë“ˆ ì„í¬íŠ¸í•¨.

const app = express();

const serverRender = (req, res, next) => {
    // 404ê°€ ë– ì•¼ í•˜ëŠ” ìƒí™©ì— ì„œë²„ì‚¬ì´ë“œ ë Œë”ë§ì„ í•´ì¤Œ
    const context = {};
    const jsx = ( 
        <StaticRouter location={req.url} context={context}>
            <App />
        </StaticRouter>
    );
    const root = ReactDOMServer.renderToString(jsx); // ë Œë”ë§ì„ í•˜ê³ ë‚˜ì„œ
    res.send(root); // í´ë¼ì´ì–¸íŠ¸ì—ê²Œ response 
}

// ğŸ”» serve ì¶”ê°€ (static ë¯¸ë“¤ì›¨ì–´)
const serve = express.static(path.resolve('./build'), {
    index: false    // '/' ê²½ë¡œì—ì„œ index.html ì•ˆë³´ì´ê²Œ
});

app.use(serve); // serverRender ì „ì— ìœ„ì¹˜í•´ì•¼í•¨.
app.use(serverRender);

app.listen(5000, () => {
    // 5000 í¬íŠ¸ë¡œ ì„œë²„ ê°€ë™
    console.log('Running on http://localhost:5000');
}); 
```

- ê·¸ ë‹¤ìŒ, JS ì™€ CSS íŒŒì¼ì„ ë¶ˆëŸ¬ì˜¤ë„ë¡ htmlì— ì½”ë“œë¥¼ ì‚½ì….
-> ë¹Œë“œí•  ë•Œë§ˆë‹¤ ìƒê¸°ëŠ” `asset-manifest.json` íŒŒì¼ì„ ì°¸ê³ .

```
$ yarn build
```

/build/asset-manifest.json
``` 
{
  "files": {
    "main.css": "/static/css/main.6fc69dca.css",
    "main.js": "/static/js/main.2fa3917b.js",
    "index.html": "/index.html",
    "main.6fc69dca.css.map": "/static/css/main.6fc69dca.css.map",
    "main.2fa3917b.js.map": "/static/js/main.2fa3917b.js.map"
  },
  "entrypoints": [
    "static/css/main.6fc69dca.css",
    "static/js/main.2fa3917b.js"
  ]
}
```

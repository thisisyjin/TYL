# React.js

**Today I Learned ... **`react.js`

>ğŸ™‹â€â™‚ï¸ [**Reference Book**](https://thebook.io/080203/)

>ğŸ™‹â€ [**My Dev Blog**](https://mywebproject.tistory.com/)

***

> **ë¦¬ì•¡íŠ¸ë¥¼ ë‹¤ë£¨ëŠ” ê¸°ìˆ  DAY 14**
- ì™¸ë¶€ API ì—°ë™ - ë‰´ìŠ¤ ë·°ì–´ ì œì‘


# ì™¸ë¶€ API ì—°ë™ - ë‰´ìŠ¤ ë·°ì–´

## ì¹´í…Œê³ ë¦¬ ê¸°ëŠ¥ êµ¬í˜„

- business
- science
- entertainment
- sports
- health
- technology

í™”ë©´ì— ë Œë”ë§ì‹œ ì˜ì–´ë¡œ ë³´ì—¬ì£¼ì§€ ì•Šê³ , í•œê¸€ë¡œ ë³´ì—¬ì£¼ë„ë¡.


### 1) Categoris.js ìƒì„±

``` jsx
import styled from 'styled-components';

const categories = [
    {
        name: 'all',
        text: 'ì „ì²´ë³´ê¸°',
    },
    {
        name: 'business',
        text: 'ë¹„ì¦ˆë‹ˆìŠ¤',
    },
    {
        name: 'entertainment',
        text: 'ì—”í„°í…Œì¸ë¨¼íŠ¸',
    },
    {
        name: 'health',
        text: 'ê±´ê°•',
    },
    {
        name: 'science',
        text: 'ê³¼í•™',
    },
    {
        name: 'sports',
        text: 'ìŠ¤í¬ì¸ ',
    },
    {
        name: 'technology',
        text: 'ê¸°ìˆ ',
    },
];
const CategoriesBlock = styled.div`
    display: flex;
    padding: 1rem;
    width: 768px;
    margin: 0 auto;
    @media screen and (max-width: 768px) {
        width: 100%;
        overflow-x: auto;
    }
`;

const Category = styled.div`
    font-size: 1.125rem;
    cursor: pointer;
    white-space: pre;
    text-decoration: none;
    color: inherit;
    padding-bottom: 0.25rem;

    &:hover {
        color: #495057;
    }

    & + & {
        margin-left: 1rem;
    }
`;

const Categories = () => {
    return (
        <CategoriesBlock>
            {categories.map(c => (<Category key={c.name}>{c.text}</Category>))}
        </CategoriesBlock>
    );
};


export default Categories;
```

- categories ë°°ì—´ ì•ˆì— ì‹¤ì œ ì´ë¦„ text(ì˜ë¬¸)ì™€ name(í•œê¸€)ì„ ì €ì¥í•¨.
- `CategoriesBlock`ì´ë¼ëŠ” ì „ì²´ë¥¼ ê°ì‹¸ëŠ” div ìŠ¤íƒ€ì¼ ì»´í¬ë„ŒíŠ¸ì™€
`Category`ë¼ëŠ” ê° ì¹´í…Œê³ ë¦¬ë¥¼ ê¾¸ë¯¸ëŠ” ìŠ¤íƒ€ì¼ ì»´í¬ë„ŒíŠ¸ë¥¼ ë§Œë“¬.

### RESULT

![](https://velog.velcdn.com/images/thisisyjin/post/6eeb8b3f-1b7f-483f-96af-e8b7d8cea9cd/image.png)

- ì¹´í…Œê³ ë¦¬ ëª©ë¡ì´ ìƒë‹¨ì— ë‚˜íƒ€ë‚¬ë‹¤. 
-> categories ë°°ì—´ì˜ nameí•„ë“œê°€ ë‚˜íƒ€ë‚˜ì•¼í•¨. (í•œê¸€)



<br>

- categoryì˜ ìƒíƒœë¥¼ `useState`ë¡œ ê´€ë¦¬ -> App.js ì—ì„œ.
- category ê°’ì„ ì—…ë°ì´íŠ¸í•˜ëŠ” onSelect í•¨ìˆ˜ ì¶”ê°€.


- category, onSelectë¥¼ Categories ì»´í¬ë„ŒíŠ¸ë¡œ ì „ë‹¬. (props)
- category ê°’ì„ NewsList ì»´í¬ë„ŒíŠ¸ì—ë„ ì „ë‹¬í•´ì¤Œ.


### 2) App.js (useState, props)

App.js
``` jsx
import { useState, useCallback } from 'react';
import Categories from './components/Categories';
import NewsList from './components/NewsList';

const App = () => {
  const [category, setCategory] = useState('all');
  const onSelect = useCallback(category => setCategory(category), []);
  
  return (
    <>
      <Categories category={category} onSelect={onSelect} />
      <NewsList category={category}/>
    </>
  );
}

export default App;
```
- category(`state`)ëŠ” í˜„ì¬ í´ë¦­í•œ ì¹´í…Œê³ ë¦¬ë¡œ ì´ë™í•  ìˆ˜ ìˆê²Œ í•´ì£¼ëŠ” ìƒíƒœì´ê³ ,
- onSelectëŠ” í´ë¦­í•œ ì¹´í…Œê³ ë¦¬ë¡œ setCategoryí•´ì£¼ëŠ” í•¨ìˆ˜ì´ë‹¤. 



### 3) Categories.js (css, props)

Categoriesjs

``` jsx
import styled, { css } from 'styled-components';

const categories = [
    {
        name: 'all',
        text: 'ì „ì²´ë³´ê¸°',
    },
    {
        name: 'business',
        text: 'ë¹„ì¦ˆë‹ˆìŠ¤',
    },
    {
        name: 'entertainment',
        text: 'ì—”í„°í…Œì¸ë¨¼íŠ¸',
    },
    {
        name: 'health',
        text: 'ê±´ê°•',
    },
    {
        name: 'science',
        text: 'ê³¼í•™',
    },
    {
        name: 'sports',
        text: 'ìŠ¤í¬ì¸ ',
    },
    {
        name: 'technology',
        text: 'ê¸°ìˆ ',
    },
];
const CategoriesBlock = styled.div`
    display: flex;
    padding: 1rem;
    width: 768px;
    margin: 0 auto;
    @media screen and (max-width: 768px) {
        width: 100%;
        overflow-x: auto;
    }
`;

const Category = styled.div`
    font-size: 1.125rem;
    cursor: pointer;
    white-space: pre;
    text-decoration: none;
    color: inherit;
    padding-bottom: 0.25rem;

    &:hover {
        color: #495057;
    }

    ${props =>
    props.active && css`
        font-weight: 600;
        border-bottom: 2px solid #22b8cf;
        color: #22b8cf;
        &:hover {
            color: #3bc9db;
        }
    `}

    & + & {
        margin-left: 1rem;
    }
`;

const Categories = ({onSelect, category}) => {
    return (
        <CategoriesBlock>
            {categories.map(c => (
                <Category
                    key={c.name}
                    active={category === c.name}
                    onClick={() => onSelect(c.name)}
                >
                    {c.text}
                </Category>))}
        </CategoriesBlock>
    );
};;

export default Categories;
```


![](https://velog.velcdn.com/images/thisisyjin/post/d35b7201-7a1b-4936-80d5-846eeec87bcb/image.gif)


1. styled-components ì—ì„œëŠ” propsë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ìˆìŒ.
- props.activeê°€ trueë©´ cssí•¨ìˆ˜ ì ìš©.
- css ``ëŠ” ì—¬ëŸ¬ì¤„ì˜ ì¡°ê±´ ìŠ¤íƒ€ì¼ì„ ì ìš©í•˜ë ¤ í•  ë•Œ ì‚¬ìš©í•¨.

``` jsx
 ${props =>
    props.active && css`
        font-weight: 600;
        border-bottom: 2px solid #22b8cf;
        color: #22b8cf;
        &:hover {
            color: #3bc9db;
        }
    `}
```
-> ì´ êµ¬ë¬¸ì²˜ëŸ¼ ì‚¬ìš©í•˜ë¯€ë¡œ, í˜•ì‹ ì™¸ì›Œë‘ì.
> &{props => props.active && css `ìŠ¤íƒ€ì¼`}



2. props

``` jsx
<Category
    key={c.name}
    active={category === c.name}
    onClick={() => onSelect(c.name)}
>
```
- Category ì»´í¬ë„ŒíŠ¸ì— propsë¡œ `active`ë¥¼ ì¤Œ.
-> category === c.nameì´ trueë©´ activeë„ true.
-> ìœ„ì—ì„œ ì¡°ê±´ì ˆ styleì´ ì ìš©ë¨.


- ì¹´í…Œê³ ë¦¬ í´ë¦­ì‹œ onClick->onSelect(c.name)ì— ì˜í•´ category(`state`)ê°’ì´ c.nameì´ ë¨.
- ê·¸ë¦¬ê³  `active` propsê°€ trueê°€ ë¨.
- ìœ„ ì¡°ê±´ì ˆ ìŠ¤íƒ€ì¼ì— ì˜í•´ cssí•¨ìˆ˜ ë‚´ë¶€ ìŠ¤íƒ€ì¼ì´ ì ìš©ë¨.


***

## API í˜¸ì¶œ ì‹œ ì¹´í…Œê³ ë¦¬ ì§€ì •

ì´ì œ í´ë¦­ì‹œ ìŠ¤íƒ€ì¼ì´ ì ìš©ë˜ëŠ” ê²ƒì€ êµ¬í˜„í–ˆìœ¼ë‹ˆ,
ë°ì´í„° ì—°ë™ì‹œ ì¹´í…Œê³ ë¦¬ë¥¼ ì§€ì •í•˜ëŠ” ê²ƒì„ êµ¬í˜„í•´ì•¼ í•œë‹¤.

NewsList.js (ìˆ˜ì •) 
``` jsx
import { useState, useEffect } from 'react';
import styled from 'styled-components';
import NewsItem from './NewsItem';
import axios from 'axios';

const NewsListBlock = styled.div`
    box-sizing: border-box;
    padding-bottom: 3rem;
    width: 768px;
    margin: 0 auto;
    margin-top: 2rem;

    @media screen and (max-width: 768px) {
        width: 100%;
        padding-left: 1rem;
        padding-right: 1rem;
    }
`;

const NewsList = ({category}) => {
    const [articles, setArticles] = useState(null);
    const [loading, setLoading] = useState(false);

    useEffect(() => {
        const fetchData = async () => {
            setLoading(true);

          // ğŸ”» ìˆ˜ì •ëœ ë¶€ë¶„ (query + url í…œí”Œë¦¿ ë¦¬í„°ëŸ´)
            try {
                const query = category === 'all' ? '' : `&category=${category}`;
                const response = await axios.get(
                    `https://newsapi.org/v2/top-headlines?country=kr${query}&apiKey=f6052deb31a34f38b602753e2ddf0daf`
                );
                setArticles(response.data.articles);
            } catch (e) {
                console.log(e);
            }

            setLoading(false);
        };

        fetchData();
    }, [category]);

    if (loading) {
        return <NewsListBlock>ëŒ€ê¸° ì¤‘...</NewsListBlock>
    }

    if (!articles) {
        return null;
    }
    return (
        <NewsListBlock>
            {articles.map(article => (
                <NewsItem key={article.url} article={article} />
            ))}
        </NewsListBlock>
    );
};

export default NewsList;
```

- categoryë¥¼ propsë¡œ ë°›ì•„ì™”ê¸° ë•Œë¬¸ì— category ê°’ì— ë”°ë¼ í˜„ì¬ ì¹´í…Œê³ ë¦¬ë¥¼ ì§€ì •í•˜ì—¬ APIë¥¼ ìš”ì²­í•  ìˆ˜ ìˆë„ë¡.
- í˜„ì¬ categoryê°’ì— ë”°ë¼ ìš”ì²­í•  ì£¼ì†Œê°€ ë™ì ìœ¼ë¡œ ë°”ë€œ.
-> 'all'ì´ë©´ queryë¥¼ ê³µë°±ìœ¼ë¡œ ì„¤ì •í•¨.

ì¶”ê°€ë¡œ category ê°’ì´ ë°”ë€” ë•Œë§ˆë‹¤ ë‰´ìŠ¤ë¥¼ ìƒˆë¡œ ë¶ˆëŸ¬ì™€ì•¼ í•˜ë¯€ë¡œ, useEffectì˜ `deps`ì— categoryë¥¼ ë„£ì–´ì¤Œ.

> ì´ ì»´í¬ë„ŒíŠ¸ëŠ” componentDidMountì™€ componentDidUpdateì‹œ ìš”ì²­ì„ ì‹œì‘í•˜ë„ë¡ ì„¤ì •í•´ì•¼ í•¨.
-> useEffectì—ì„œëŠ” í•œë²ˆì— ì„¤ì •í•  ìˆ˜ ìˆìŒ. (ë‘ê°œë¥¼ í•©ì³ë†“ì€ ê¸°ëŠ¥ì„)


### RESULT

![](https://velog.velcdn.com/images/thisisyjin/post/e998f01c-a376-4bfa-b30b-f0ec61db4bb7/image.gif)


***

## ë¦¬ì•¡íŠ¸ ë¼ìš°í„° ì ìš©

- ê¸°ì¡´ì—ëŠ” ì¹´í…Œê³ ë¦¬ ê°’ì„ App ì»´í¬ë„ŒíŠ¸ì—ì„œ stateë¡œ ê´€ë¦¬í–ˆì§€ë§Œ,
ì´ë²ˆì—ëŠ” URL íŒŒë¼ë¯¸í„°ë¥¼ ì´ìš©í•˜ì—¬ ê´€ë¦¬í•´ë³´ì.


### 1) ë¦¬ì•¡íŠ¸ ë¼ìš°í„° ì„¤ì¹˜

``` bash
$ yarn add react-router-dom
```

### 2) index.js ì„¤ì •

``` jsx
import React from 'react';
import ReactDOM from 'react-dom/client';
import './index.css';
import App from './App';
import { BrowserRouter } from 'react-router-dom';

const root = ReactDOM.createRoot(document.getElementById('root'));
root.render(
  <BrowserRouter>
    <App />
  </BrowserRouter>
);
```


### 3) NewsPage ì»´í¬ë„ŒíŠ¸ ìƒì„±

src/pages/NewsPage.js

``` jsx
import { useParams } from "react-router-dom";
import Categories from "../Categories";
import NewsList from "../NewsList";

const NewsPage = () => {
    const params = useParams();

    const category = params.category || 'all';

    return (
        <>
            <Categories />
            <NewsList category={category} />
        </>
    )
}

export default NewsPage;
```
- useParamsë¡œ ë§Œë“  paramsì˜ categoryë¥¼ NewsListì— `props`ë¡œ ë³´ëƒ„.
- categoryê°€ ''ì´ë©´ ê¸°ë³¸ê°’ì€ 'all'ë¡œ.


### App.js (Route ì„¤ì •)

``` jsx
import { Route, Routes } from 'react-router-dom';
import NewsPage from './components/pages/NewsPage'; 

const App = () => {

  
  return (
    <Routes>
      <Route path="/" element={<NewsPage />} />
      <Route path="/:category" element={<NewsPage />} />
    </Routes>
  );
}

export default App;

```
- categoryê°€ ìˆì–´ë„ NewsPage, ì—†ì–´ë„ NewsPageë¥¼ ë³´ì—¬ì¤˜ì•¼ í•˜ë¯€ë¡œ ë‘ë²ˆ ì‘ì„±í•¨.
- path="/" ì¼ ë•ŒëŠ” params.categoryê°€ ''ì´ë¯€ë¡œ categoryëŠ” ì €ì ˆë¡œ 'all'ì´ ëœë‹¤.

### Categories.js (Link ì¶”ê°€)

``` jsx
import styled from 'styled-components';
import { NavLink } from 'react-router-dom';

const categories = [
    ...
];
const CategoriesBlock = styled.div`
    display: flex;
    padding: 1rem;
    width: 768px;
    margin: 0 auto;
    @media screen and (max-width: 768px) {
        width: 100%;
        overflow-x: auto;
    }
`;

const Category = styled(NavLink)`
    font-size: 1.125rem;
    cursor: pointer;
    white-space: pre;
    text-decoration: none;
    color: inherit;
    padding-bottom: 0.25rem;

    &:hover {
        color: #495057;
    }

    &.active {
        font-weight: 600;
        border-bottom: 2px solid #22b8cf;
        color: #22b8cf;
        &:hover {
            color: #3bc9db;
        }
    }

    & + & {
        margin-left: 1rem;
    }
`;

const Categories = () => {
    return (
        <CategoriesBlock>
            {categories.map(c => (
                <Category
                    key={c.name}
                    className={({ isActive }) => (isActive ? 'active' : undefined)}
                    to={c.name === 'all' ? '/' : `${c.name}`}
                >
                    {c.text}
                </Category>))}
        </CategoriesBlock>
    );
};;

export default Categories;
```


``` jsx
const query = category === 'all' ? '' : `&category=${category}`;
	 const response = await axios.get(
	     `https://newsapi.org/v2/top-headlines?country=kr${query}&apiKey=f6052deb31a34f38b602753e2ddf0daf`
	 );
```

1. NavLink ì»´í¬ë„ŒíŠ¸ ì„í¬íŠ¸
2. Category ì»´í¬ë„ŒíŠ¸ -> `styled(NavLink)`
3. activeë¼ëŠ” propsë¥¼ ì´ìš©í•˜ì§€ ì•Šê³ , ì¡°ê±´ë¶€ë¡œ classë¥¼ ë¶€ì—¬í•¨.
-> ` className={({ isActive }) => (isActive ? 'active' : undefined)} `
4. toë¼ëŠ” propsë¥¼ ì „ë‹¬í•˜ì—¬ 'all'ì´ë©´ '/'ë¡œ, ì•„ë‹ˆë©´ /c.nameìœ¼ë¡œ 


### RESULT

![](https://velog.velcdn.com/images/thisisyjin/post/aad611ec-3ef7-493b-8d10-395a1a33a7e2/image.gif)

- ì¢Œì¸¡í•˜ë‹¨ ì£¼ì†Œ (URL params) ì£¼ëª©.



***

## usePromise ì»¤ìŠ¤í…€ Hook

- API í˜¸ì¶œê³¼ ê°™ì´ `Promise`ë¥¼ ì‚¬ìš©í•´ì•¼ í•˜ëŠ” ê²½ìš°, ë”ìš± ê°„ë‹¨í•˜ê²Œ í•´ì£¼ëŠ” ì»¤ìŠ¤í…€ Hookì„ ë§Œë“¤ì–´ë³´ì.

### lib/usePromise.js
``` js
import { useState, useEffect } from 'react';

export default function usePromise(promiseCreator, deps) {
    const [loading, setLoading] = useState(false);
    const [resolved, setResolved] = useState(null);
    const [error, setError] = useState(null);

    useEffect(() => {
        const process = async () => {
            setLoading(true);
            try {
                const resolved = await promiseCreator();
                setResolved(resolved);
            } catch (e) {
                setError(e);
            }
            setLoading(false);
        };

        process();
    }, deps);

    return [loading, resolved, error];
}
```
- ë§¤ê°œë³€ìˆ˜ `deps`ëŠ” ë°°ì—´ì˜ í˜•íƒœë¡œ ë°›ì•„ì•¼ í•œë‹¤. 
- ë§ˆì§€ë§‰ ë¶€ë¶„ì— depsì—ì„œ esLint ê²½ê³ ê°€ ë°œìƒí•˜ëŠ”ë°, 'ë¹ ë¥¸ ìˆ˜ì •...'ì„ í´ë¦­í•˜ë©´
ESLint ê·œì¹™ì„ ë¹„í™œì„±í™”ì‹œí‚¤ëŠ” **ì£¼ì„**ì´ ì…ë ¥ë¨.
``` js
    // eslint-disable-next-line react-hooks/exhaustive-deps
```

<br>


> ì»¤ìŠ¤í…€ Hook ì‚¬ìš©
- NewList ì»´í¬ë„ŒíŠ¸ì—ì„œ APIë¥¼ ë¶ˆëŸ¬ì˜¤ë¯€ë¡œ, ì—¬ê¸°ì„œ `usePromise`ë¥¼ ì‚¬ìš©í•´ë³´ì.
- return [loading, resolved, error] ì´ë¯€ë¡œ, ê° ê°’ì„ êµ¬ì¡°ë¶„í•´ í• ë‹¹ìœ¼ë¡œ ë°›ì•„ì˜¨ë‹¤.
- 

``` jsx
import styled from 'styled-components';
import NewsItem from './NewsItem';
import axios from 'axios';
import usePromise from '../lib/usePromise';

const NewsListBlock = styled.div`
    ...
`;

const NewsList = ({category}) => {
    
    const [loading, response, error] = usePromise(() => {
        const query = category === 'all' ? '' : `${category}`;
        return axios.get(
            `https://newsapi.org/v2/top-headlines?country=kr${query}&apiKey=f6052deb31a34f38b602753e2ddf0daf`
        );
    }, [category]);

    if (loading) {
        return <NewsListBlock>ëŒ€ê¸° ì¤‘...</NewsListBlock>
    }

    if (!response) {
        return null;
    }

    if (error) {
        return <NewsListBlock>ì—ëŸ¬ ë°œìƒ!</NewsListBlock>
    }

    const { articles } = response.data;
    return (
        <NewsListBlock>
            {articles.map(article => (
                <NewsItem key={article.url} article={article} />
            ))}
        </NewsListBlock>
    );
};

export default NewsList;
```


***

> ì¤‘ìš” 
- useEffect ë‚´ë¶€ í•¨ìˆ˜ì—ëŠ” async/awaitì„ ì§ì ‘ ì‘ì„±í•˜ë©´ ì•ˆëœë‹¤.
- í•¨ìˆ˜ ë‚´ë¶€ì— asyncí•¨ìˆ˜ë¥¼ ë”°ë¡œ ë“±ë¡í•œ í›„, í˜¸ì¶œí•˜ëŠ” ë°©ì‹ìœ¼ë¡œ ì‚¬ìš©í•´ì•¼ í•œë‹¤.

> [styled-components](https://react.vlpt.us/styling/03-styled-components.html) ë¬¸ì„œ ì°¸ì¡°í•˜ê¸°.



>ì°¸ê³  - APIê°€ ë§ì•„ì§€ë©´ ìš”ì²­ì„ ìœ„í•œ ìƒíƒœê´€ë¦¬ê°€ ë²ˆê±°ë¡œì›€. (ë¦¬ë•ìŠ¤ë¡œ í•´ê²°)

# React.js

**Today I Learned ... **`react.js`

>ğŸ™‹â€â™‚ï¸ [**Reference book**](https://thebook.io/080203)

>ğŸ™‹â€ [**My Dev Blog**](https://mywebproject.tistory.com)

***

> **CH 20. ì„œë²„ì‚¬ì´ë“œ ë Œë”ë§**
part 1 - CRA eject í›„ `config í´ë”` (paths.js / wepback.config.server.js)
ë° `scripts í´ë”` (build.server.js) ì„¤ì •í•˜ê¸°.


# ì„œë²„ ì‚¬ì´ë“œ ë Œë”ë§

## ğŸ’¡ ì„œë²„ì‚¬ì´ë“œ ë Œë”ë§ ì´ë€?
- UIë¥¼ ì„œë²„ì—ì„œ ë Œë”ë§ í•˜ëŠ” ê²ƒ.
- ì´ì „ ë¦¬ì•¡íŠ¸ í”„ë¡œì íŠ¸ë“¤ì€ ëª¨ë‘ í´ë¼ì´ì–¸íŠ¸ ì‚¬ì´ë“œ ë Œë”ë§ì„ í•˜ê³  ìˆì—ˆë‹¤.
-> ëª¨ë“  UI ë Œë”ë§ì„ ë¸Œë¼ìš°ì €ê°€ ì²˜ë¦¬í•˜ëŠ” ê²ƒ. (js íŒŒì¼ì„ ì‹¤í–‰í•´ì•¼ ë Œë”ë§ ë¨)

í¬ë¡¬ ê°œë°œì ë„êµ¬ì˜ Network íƒ­ì„ ì¼œì„œ ë¦¬ë¡œë“œ í•´ë³´ë©´,
`localhost`ì˜ response íƒ­ì„ ë³´ë©´ #root ì—˜ë¦¬ë¨¼íŠ¸ê°€ ë¹„ì–´ìˆìŒì„ ì•Œ ìˆ˜ ìˆë‹¤.
ì¦‰, ì´ í˜ì´ì§€ëŠ” ì²˜ìŒì—ëŠ” ë¹ˆ í˜ì´ì§€ë¼ëŠ” ì˜ë¯¸ì´ë‹¤.

![](https://velog.velcdn.com/images/thisisyjin/post/d8db3a00-e154-4b82-aa7c-e3a25d31a869/image.png)

-> ê·¸ ì´í›„ jsíŒŒì¼ì´ ì‹¤í–‰ë˜ê³  ë¦¬ì•¡íŠ¸ ì»´í¬ë„ŒíŠ¸ê°€ ë Œë”ë§ ë˜ëŠ” ê²ƒ.

> #### ì„œë²„ì‚¬ì´ë“œ ë Œë”ë§ êµ¬í˜„ ì‹œ
 - ì‚¬ìš©ìê°€ ì›¹ ì„œë¹„ìŠ¤ì— ë°©ë¬¸ì‹œ, **ì´ˆê¸° ë Œë”ë§ì„ ì„œë²„ìª½ì—ì„œ ëŒ€ì‹ í•´**ì¤Œ.
 - ì‚¬ìš©ìê°€ html íŒŒì¼ì„ ì €ë‹¬ë°›ì•˜ì„ ë•Œ ê·¸ ë‚´ë¶€ì— ë Œë”ë§ëœ ê²°ê³¼ë¬¼ì´ ë³´ì„. (element íƒ­)
 
 
 ### ì„œë²„ì‚¬ì´ë“œ ë Œë”ë§ì˜ ì¥ì 
 
 #### 1. ê²€ìƒ‰ì—”ì§„ ìµœì í™” ê°€ëŠ¥
 - ê²€ìƒ‰ ì—”ì§„ì´ ìš°ë¦¬ ì›¹ì•±ì˜ í˜ì´ì§€ë¥¼ ì›í™œí•˜ê²Œ ìˆ˜ì§‘í•  ìˆ˜ ìˆìŒ. (**SEO, ê²€ìƒ‰ì—”ì§„ ìµœì í™”** ê°€ëŠ¥)
 - ë¦¬ì•¡íŠ¸ë¡œ ë§Œë“  SPAëŠ” ìë°”ìŠ¤í¬ë¦½íŠ¸ê°€ ì‹¤í–‰ë˜ì§€ ì•ŠëŠ” í™˜ê²½ì—ì„œëŠ” í˜ì´ì§€ê°€ ë‚˜íƒ€ë‚˜ì§€ ì•ŠìŒ.
 - ì„œë²„ì—ì„œ í´ë¼ì´ì–¸íŠ¸ ëŒ€ì‹  ë Œë”ë§ì„ í•´ì£¼ë©´ **ê²€ìƒ‰ ì—”ì§„ì´ í˜ì´ì§€ ë‚´ìš©ì„ ì œëŒ€ë¡œ ìˆ˜ì§‘**í•  ìˆ˜ ìˆìŒ.
 
#### 2. ì´ˆê¸° ë Œë”ë§ ì„±ëŠ¥ ê°œì„  
- ì„œë²„ì‚¬ì´ë“œ ë Œë”ë§ì´ êµ¬í˜„ë˜ì§€ ì•Šìœ¼ë©´, ìë°”ìŠ¤í¬ë¦½íŠ¸ê°€ ë¡œë”©ë˜ê³  ì‹¤í–‰ë  ë•Œ ê¹Œì§€ ì‚¬ìš©ìëŠ” ë¹ˆ í™”ë©´ì„ ë³´ê³  ëŒ€ê¸°í•´ì•¼ í•¨.
-> ì—¬ê¸°ì— APIê¹Œì§€ í˜¸ì¶œí•´ì•¼ í•œë‹¤ë©´ ëŒ€ê¸° ì‹œê°„ì´ ë” ê¸¸ì–´ì§.
- ì„œë²„ì‚¬ì´ë“œ ë Œë”ë§ êµ¬í˜„ì‹œ jsíŒŒì¼ì´ ë¡œë“œë˜ê¸° ì „ì—ë„ htmlìƒì— ì‚¬ìš©ìê°€ ë³¼ ìˆ˜ ìˆëŠ” ì½˜í…ì¸ ê°€ ìˆì–´
**ì‚¬ìš©ì ê²½í—˜ë„ í–¥ìƒ**ë¨.


### ì„œë²„ì‚¬ì´ë“œ ë Œë”ë§ì˜ ë‹¨ì 
- ì„œë²„ ë¦¬ì†ŒìŠ¤ê°€ ì‚¬ìš©ë¨.
-> ë¸Œë¼ìš°ì €ê°€ í•´ì•¼í•  ì¼ì„ ì„œë²„ê°€ ëŒ€ì‹  ì²˜ë¦¬í•˜ëŠ” ê²ƒ ì´ë¯€ë¡œ.
- í•œë²ˆì— ë§ì€ ì‚¬ìš©ìê°€ ë™ì‹œ ì ‘ì†ì‹œ, ì„œë²„ì— ê³¼ë¶€í•˜ê°€ ì˜¬ ìˆ˜ ìˆìŒ.
- ì‚¬ìš©ìê°€ ë§ì€ ì„œë¹„ìŠ¤ë¼ë©´, `ìºì‹±`ê³¼ `ë¡œë“œë°¸ëŸ°ì‹±`ì„ í†µí•´ ì„±ëŠ¥ ìµœì í™”ê°€ í•„ìš”.
- í”„ë¡œì íŠ¸ êµ¬ì¡°ê°€ ë³µì¡í•´ì§. (ê°œë°œ ì–´ë ¤ì›€)


> ì°¸ê³  - ì½”ë“œ ìŠ¤í”Œë¦¬íŒ… 
ì„œë²„ì‚¬ì´ë“œ ë Œë”ë§ê³¼ í•¨ê»˜ ì ìš©ì‹œ ì‘ì—…ì´ ê¹Œë‹¤ë¡œì›€.
* ì„œë²„ì‚¬ì´ë“œ ë Œë”ë§ ë¶€ë¶„ì´ ë¨¼ì € ë‚˜íƒ€ë‚¨ -> js ë¡œë”©ì‹œì‘ -> ì•„ì§ ë¶ˆëŸ¬ì˜¤ì§€ ì•Šì€ ì»´í¬ë„ŒíŠ¸ë¥¼ nullë¡œ ë Œë”ë§ -> ì½”ë“œ ìŠ¤í”Œë¦¬íŒ…ëœ ì»´í¬ë„ŒíŠ¸ ì‚¬ë¼ì§ -> ë‹¤ì‹œ ì œëŒ€ë¡œ ë‚˜íƒ€ë‚¨.


***

## í”„ë¡œì íŠ¸ ì¤€ë¹„

### 1) ì»´í¬ë„ŒíŠ¸ ìƒì„±

- íŒ¨í‚¤ì§€ ì„¤ì¹˜
``` bash
$ yarn add react-router-dom
```

- `Red.js`, `Blue.js`, `Menu.js` ìƒì„±. 
(ì´ 3ê°œì˜ ì»´í¬ë„ŒíŠ¸. + css íŒŒì¼)

1. Red.js
``` jsx
import './Red.css';

const Red = () => {
    return <div className='Red'>Red</div>
};

export default Red;
```

2. Red.css
``` css
.Red {
  background: red;
  font-size: 1.5rem;
  color: White;
  width: 128px;
  height: 128px;
  display: flex;
  align-items: center;
  justify-content: center;

```

3. Blue.js
``` jsx
import './Red.css';

const Blue = () => {
    return <div className='Blue'>Blue</div>
};

export default Blue;
```

4. Blue.css
``` css
.Blue {
  background: blue;
  font-size: 1.5rem;
  color: White;
  width: 128px;
  height: 128px;
  display: flex;
  align-items: center;
  justify-content: center;

```

5. Menu.js
``` js
import { Link } from "react-router-dom";

const Menu = () => {
    return (
        <ul>
            <li>
                <Link to="/red">Red</Link>
            </li>
            <li>
                <Link to="/blue">Blue</Link>
            </li>
        </ul>
    );
};

export default Menu;
```

### 2) í˜ì´ì§€ ì»´í¬ë„ŒíŠ¸ ìƒì„±
`src/pages` í´ë”ì— í˜ì´ì§€ ì»´í¬ë„ŒíŠ¸ ìƒì„±.


1. RedPage.js
``` jsx
import Red from "../components/Red";

const RedPage = () => {
    return <Red />
};

export default RedPage;
```

2. BluePage.js
``` jsx
import Blue from "../components/Blue";

const BluePage = () => {
    return <Blue />
};

export default BluePage;
```


### 3) App ë¼ìš°íŠ¸ ì„¤ì • 


1. app.js
``` jsx
import { Route, Routes } from 'react-router-dom';
import Menu from './components/Menu';  
import RedPage from './pages/RedPage';
import BluePage from './pages/BluePage';

function App() {
  return (
    <>
      <Menu />
      <hr />
      <Routes>
        <Route path="/red" element={<RedPage />} />
        <Route path="/blue" element={<BluePage />} />
      </Routes>
    </>
  );
}

export default App;
```

2. index.js
``` jsx
import React from 'react';
import ReactDOM from 'react-dom/client';
import App from './App';
import { BrowserRouter } from 'react-router-dom';

const root = ReactDOM.createRoot(document.getElementById('root'));
root.render(
  <BrowserRouter>
    <App />
  </BrowserRouter>
);
```

### 4) ì„œë²„ì‚¬ì´ë“œ ë Œë”ë§ êµ¬í˜„

- ì„œë²„ì‚¬ì´ë“œ ë Œë”ë§ì„ êµ¬í˜„í•˜ë ¤ë©´ ì›¹íŒ© ì„¤ì •ì„ ì»¤ìŠ¤í…€í•´ì¤˜ì•¼ í•¨.
- CRA(create-react-app)ì—ì„œëŠ” ì›¹íŒ© ì„¤ì •ì´ ëª¨ë‘ ìˆ¨ê²¨ì ¸ ìˆìœ¼ë‹ˆ,
ë¨¼ì € `yarn eject` ëª…ë ¹ì–´ë¥¼ ì‹¤í–‰í•˜ì—¬ ë°–ìœ¼ë¡œ êº¼ë‚´ì¤˜ì•¼ í•¨.

> `yarn eject`ë¥¼ í•˜ê¸° ìœ„í•´ì„œëŠ” ë ˆíŒŒì§€í† ë¦¬ì— **commit í•´ì¤˜ì•¼ í•¨**.

``` bash
$ git add .
$ git commit -m 'init'

$ yarn eject
```

ì•„ë˜ì™€ ê°™ì´ ë£¨íŠ¸ í´ë”ì— `config` í´ë”ê°€ ìƒì„±ë˜ì—ˆë‹¤.

![](https://velog.velcdn.com/images/thisisyjin/post/526dcf97-c499-40e7-8b98-5caebccd4232/image.png)
- ã…ˆã„·


### ì„œë²„ì‚¬ì´ë“œ ë Œë”ë§ìš© entry ìƒì„±
>- `entry`ë€, **ì›¹íŒ©ì—ì„œ í”„ë¡œì íŠ¸ë¥¼ ë¶ˆëŸ¬ì˜¬ ë•Œ ê°€ì¥ ë¨¼ì € ë¶ˆëŸ¬ì˜¤ëŠ” íŒŒì¼**.
-> í˜„ì¬ index.js ë¥¼ ì—”íŠ¸ë¦¬ íŒŒì¼ë¡œ ì‚¬ìš©í•¨.

- ì„œë²„ì‚¬ì´ë“œ ë Œë”ë§ì„ í•  ë•ŒëŠ”, **ì„œë²„ë¥¼ ìœ„í•œ entry íŒŒì¼**ì„ í•˜ë‚˜ ë” ìƒì„±í•´ì•¼ í•¨.
-> `/src/index.server.js` ë¥¼ ìƒì„±


index.server.js
``` js
import ReactDOMServer from 'react-dom/server';

const html = ReactDOMServer.renderToString(
    <div>Hello Server Side Rendering!</div>
);

console.log(html);
```

> react-dom ë¼ì´ë¸ŒëŸ¬ë¦¬ì˜ server ë””ë ‰í„°ë¦¬ (ìµœì í™”ë¥¼ ìœ„í•´ í•„ìš”í•œ ë””ë ‰í„°ë¦¬ë§Œ ê°€ì ¸ì˜´)
-> `ReactDOMServer` ì„ ì„í¬íŠ¸í•¨.
- [ê³µì‹ë¬¸ì„œ](https://ko.reactjs.org/docs/react-dom-server.html) ì°¸ê³ . 
-> ì»´í¬ë„ŒíŠ¸ ì •ì  ë Œë”ë§ì„ ìœ„í•´.
>
>
- **`ReactDOMServer.renderToString(element)`**
React ì—˜ë¦¬ë¨¼íŠ¸ì˜ ì´ˆê¸° HTMLì„ ë Œë”ë§í•¨. ReactëŠ” HTML ë¬¸ìì—´ì„ ë°˜í™˜í•¨.
ë¹ ë¥¸ í˜ì´ì§€ ë¡œë“œë¥¼ ìœ„í•´ **ì´ˆê¸° ìš”ì²­ ì‹œì— ì„œë²„ì—ì„œ HTMLì„ ìƒì„±í•˜ì—¬ ë§ˆí¬ì—…ì„ ë³´ë‚´ê±°ë‚˜**, ê²€ìƒ‰ ì—”ì§„ ìµœì í™”ë¥¼ ìœ„í•´ **ê²€ìƒ‰ ì—”ì§„**ì´ í˜ì´ì§€ë¥¼ í¬ë¡¤ë§í•  ìˆ˜ ìˆë„ë¡ í•˜ëŠ”ë° ì‚¬ìš© ê°€ëŠ¥.


***

### paths.js ìˆ˜ì •

- ì—”íŠ¸ë¦¬ íŒŒì¼ì„ ì›¹íŒ©ìœ¼ë¡œ ë¶ˆëŸ¬ì™€ì„œ ë¹Œë“œí•˜ë ¤ë©´, ì„œë²„ì „ìš© í™˜ê²½ì„¤ì •ì´ í•„ìš”í•¨.


 config/**paths.js** ë¥¼ ì—´ì–´ ë§¨ ì•„ë˜ë¶€ë¶„ì— ì½”ë“œ ì¶”ê°€.
``` js
'use strict';

const path = require('path');
const fs = require('fs');
const getPublicUrlOrPath = require('react-dev-utils/getPublicUrlOrPath');

// Make sure any symlinks in the project folder are resolved:
// https://github.com/facebook/create-react-app/issues/637
const appDirectory = fs.realpathSync(process.cwd());
const resolveApp = relativePath => path.resolve(appDirectory, relativePath);

// We use `PUBLIC_URL` environment variable or "homepage" field to infer
// "public path" at which the app is served.
// webpack needs to know it to put the right <script> hrefs into HTML even in
// single-page apps that may serve index.html for nested URLs like /todos/42.
// We can't use a relative path in HTML because we don't want to load something
// like /todos/42/static/js/bundle.7289d.js. We have to know the root.
const publicUrlOrPath = getPublicUrlOrPath(
  process.env.NODE_ENV === 'development',
  require(resolveApp('package.json')).homepage,
  process.env.PUBLIC_URL
);

const buildPath = process.env.BUILD_PATH || 'build';

const moduleFileExtensions = [
  'web.mjs',
  'mjs',
  'web.js',
  'js',
  'web.ts',
  'ts',
  'web.tsx',
  'tsx',
  'json',
  'web.jsx',
  'jsx',
];

// Resolve file paths in the same order as webpack
const resolveModule = (resolveFn, filePath) => {
  const extension = moduleFileExtensions.find(extension =>
    fs.existsSync(resolveFn(`${filePath}.${extension}`))
  );

  if (extension) {
    return resolveFn(`${filePath}.${extension}`);
  }

  return resolveFn(`${filePath}.js`);
};

// config after eject: we're in ./config/
module.exports = {
  ...
  ssrIndexJs: resolveApp('src/index.server.js'), // ğŸ‘ˆ ì„œë²„ì‚¬ì´ë“œ ë Œë”ë§ entry
  ssrBuild: resolveApp('dist'), // ğŸ‘ˆ ì›¹íŒ© ì²˜ë¦¬ í›„ ì €ì¥ ê²½ë¡œ
  publicUrlOrPath,
};

module.exports.moduleFileExtensions = moduleFileExtensions;
```

> ğŸ“Œ ì°¸ê³  - resolveApp
``` js
const path = require('path');
>
const resolveApp = relativePath => path.resolve(appDirectory, relativePath);
```
ì¦‰, path.resolve(appDirectory, relativePath)ë¥¼ í•´ì¤€ ê²ƒ.
- `path.resolve`ëŠ” ë¬´ì—‡ì¸ì§€?
-> ì¸ìë¡œ ë°›ì€ ê²½ë¡œë“¤ì„ í•˜ë‚˜ë¡œ í•©ì³ì„œ ë¬¸ìì—´ í—íƒœë¡œ ë¦¬í„´í•¨.
-> path ì¸ìë“¤ì„ í•©ì³ë‚˜ê°€ëŠ”ì¤‘ `/` ë¥¼ ë§Œë‚˜ë©´ ì ˆëŒ€ê²½ë¡œë¡œ ì¸ì‹í•´ì„œ ë‚˜ë¨¸ì§€ ê²½ë¡œì¸ìë“¤ì„ ë¬´ì‹œí•œë‹¤. ë§Œì•½ `/` ë¥¼ ëê¹Œì§€ ë§Œë‚˜ì§€ ëª»í•˜ë©´ /í˜„ì¬ê²½ë¡œ/ìƒì„±ëœê²½ë¡œ í˜•íƒœë¡œ ê²°ê³¼ë¥¼ ë¦¬í„´í•œë‹¤.

> ğŸ“Œ ì°¸ê³  2 - [path.joinê³¼ path.resolveì˜ ì°¨ì´](https://www.hanumoka.net/2018/11/08/node-20181108-node-path-join-vs-resolve/)
``` js
path.resolve('foo', '/bar', 'baz') // /bar/baz => bazë¶€í„° ì‹œì‘í•´ /barë¥¼ ë§Œë‚˜ëŠ” ìˆœê°„ ì¢…ë£Œ
path.join('foo', '/bar', 'baz') // foo/bar/baz
```

<br>


### ì›¹íŒ© ê¸°ë³¸ ì„¤ì •

- config/**webpack.config.server.js** ìˆ˜ì •

#### 1) ì›¹íŒ© ê¸°ë³¸ ì„¤ì •
``` js
const paths = require('./paths');
// ğŸ”º ìœ„ì—ì„œ ì‘ì„±í–ˆë˜ paths.jsì—ì„œ module.exports í•œ ê°ì²´.

module.exports = {
    mode: 'production',  // í”„ë¡œë•ì…˜ ëª¨ë“œë¡œ ì„¤ì •
    entry: paths.ssrIndexJs,  // ì—”íŠ¸ë¦¬ ê²½ë¡œ
    target: 'node',  // ë…¸ë“œ í™˜ê²½ì—ì„œ ì‹¤í–‰ë  ê²ƒ
    output: {
        path: paths.ssrBuild,  // ë¹Œë“œ ê²½ë¡œ
        filename: 'server.js',  // íŒŒì¼ ì´ë¦„
        chunkFilename: 'js/[name].chunk.js',  // ì²­í¬íŒŒì¼ ì´ë¦„
        publicPath: paths.publicUrlOrPath,  // ì •ì íŒŒì¼ ì œê³µë  ê²½ë¡œ
    }
}
```
- ë¹Œë“œí•  ë•Œ ì–´ë–¤ íŒŒì¼ì—ì„œ ì‹œì‘í• ì§€ = entry
- ì–´ë””ì— ê²°ê³¼ë¬¼ì„ ì €ì¥í• ì§€ = output


#### 2) ì›¹íŒ© ë¡œë” ì„¤ì •

> **ë¡œë” (loader)**
- íŒŒì¼ì„ ë¶ˆëŸ¬ì˜¬ ë•Œ í™•ì¥ìì— ë§ê²Œ í•„ìš”í•œ ì²˜ë¦¬ë¥¼ í•´ì¤Œ.
-> js íŒŒì¼ì€ ë°”ë²¨ì„ í†µí•´ íŠ¸ëœìŠ¤íŒŒì¼ë§ì„ í•´ì£¼ê³ , ì´ë¯¸ì§€ íŒŒì¼ì€ ë‹¤ë¥¸ ê²½ë¡œì— ì €ì¥í•˜ëŠ” ë“±

- cssë‚˜ ì´ë¯¸ì§€ íŒŒì¼ì„ ë³„ë„ë¡œ ì„¤ì •í•´ì¤˜ì„œ ê²°ê³¼ë¬¼ì— í¬í•¨ë˜ì§€ ì•Šë„ë¡ êµ¬í˜„.

webpack.config.server.js

``` js
const paths = require('./paths');
const getCSSModuleLocalIdent = require('react-dev-utils/getCSSModuleLocalIdent');

// ğŸ”» ì •ê·œí‘œí˜„ì‹. ì•„ë˜ ì¡°ê±´ì— ë§ëŠ” ê²ƒì„ ì°¾ê¸° ìœ„í•´ `test`í•„ë“œì— ë„£ì–´ì¤Œ. 
const cssRegex = /\.css$/;
const cssModuleRegex = /\.module\.css$/;
const sassRegex = /\.(scss|sass)$/;
const sassModuleRegex = /\.module\.(scss|sass)$/;

module.exports = {
    mode: 'production',
    entry: paths.ssrIndexJs,
    target: 'node',
    output: {
        path: paths.ssrBuild,
        filename: 'server.js',
        chunkFilename: 'js/[name].chunk.js',
        publicPath: paths.publicUrlOrPath,
    },
    module: {
        rules: [
            {
                oneOf: [
                    // JS ë¥¼ ìœ„í•œ ì²˜ë¦¬
                    {
                        test: /\.(js|mjs|jsx|ts|tsx)$/,
                        include: paths.appSrc,
                        loader: require.resolve('babel-loader'),
                        options: {
                            customize: require.resolve(
                                'babel-preset-react-app/webpack-overrides'
                            ),
                            presets: [
                                [
                                    require.resolve('babel-preset-react-app'),
                                    {
                                        runtime: 'automatic',
                                    },
                                ],
                            ],
                            plugins: [
                                [
                                    require.resolve('bable-plugin-named-asset-import'),
                                    {
                                        loaderMap: {
                                            svg: {
                                                ReactComponent:
                                                    '@svgr/webpack?-svgo,+titleProp,+ref![path]'
                                            },
                                        },
                                    },
                                ],
                            ],
                            cacheDirectory: true,
                            cacheCompression: false,
                            compact: false,
                        },
                    },
                    // CSS ë¥¼ ìœ„í•œ ì²˜ë¦¬
                    {
                        test: cssRegex,
                        exclude: cssModuleRegex,
                        loader: require.resolve('css-loader'),
                        options: {
                            importLoaders: 1,
                            modules: {
                                exportOnlyLocals: true, // ì‹¤ì œ cssíŒŒì¼ ë§Œë“¤ì§€ ì•Šê²Œ.
                            },
                        },
                    },
                    // CSS Module ì„ ìœ„í•œ ì²˜ë¦¬
                    {
                        test: cssModuleRegex,
                        loader: require.resolve('css-loader'),
                        options: {
                            importLoaders: 1,
                            modules: {
                                exportOnlyLocals: true,
                                getLocalIdent: getCSSModuleLocalIdent,
                            },
                        },
                    },
                    // SASS ë¥¼ ìœ„í•œ ì²˜ë¦¬
                    {
                        test: sassRegex,
                        exclude: sassModuleRegex,
                        use: [
                            {
                                loader: require.resolve('css-loader'),
                                options: {
                                    importLoaders: 3,
                                    modules: {
                                        exportOnlyLocals: true,
                                    },
                                },
                            },
                            require.resolve('sass-loader');
                        ],
                    },
                    // SASS + CSS Module ì„ ìœ„í•œ ì²˜ë¦¬
                    {
                        test: sassRegex,
                        exclude: sassModuleRegex,
                        use: [
                            {
                                loader: require.resolve('css-loader'),
                                options: {
                                    importLoaders: 3,
                                    modules: {
                                        exportOnlyLocals: true,
                                        getLocalIdent: getCSSModuleLocalIdent,
                                    },
                                },
                            },
                            require.resolve('sass-loader');
                        ],
                    },
                    // url-loader ì„ ìœ„í•œ ì„¤ì •
                    {
                        test: [/\.bmp$/, /\.gif$/, /\.jpe?g$/, /\.png$/],
                        loader: require.resolve('url-loader');
                        options: {
                            emitFile: false,
                            limit: 10000,
                            name: 'static/media/[name].[hash:8].[ext]',
                        },
                    },
                    // ê·¸ ì™¸ íŒŒì¼ë“¤ì€ file-loader ì‚¬ìš©
                    {
                        loader: require.resolve('file-loader'),
                        exclude: [/\.(js|mjs|jsx|ts|tsx)$/, /\.html$/, /\.json$/],
                        options: {
                            emitFile: false,
                            name: 'static/media/[name].[hash:8].[ext]',
                        },
                    },
                ],
            },
        ],
    },
};
```


***


### ğŸ›  Error Log
```
Parsing error: [BABEL] /~~: Using `babel-preset-react-app` requires that you specify `NODE_ENV` or `BABEL_ENV` environment variables. Valid values are "development", "test", and "production". Instead, received: undefined. 
```
- package.jsonì— ì•„ë˜ì™€ ê°™ì´ ì‘ì„±í•´ì¤Œ. (eslintConfig í•„ë“œì— ì‘ì„±)
``` js
"eslintConfig": {
    "env": {
      "NODE_ENV": "development"
    },
    ...
  }
```

***


### node_moudules ë‚´ì˜ ë¼ì´ë¸ŒëŸ¬ë¦¬ resolve

webpack.config.server.js
``` js
module.exports = {
    mode: 'production',
    entry: paths.ssrIndexJs,
    target: 'node',
    output: {
        ...
    },
    module: {
      ...
    },
    // ğŸ”» ì¶”ê°€í•œ ë¶€ë¶„
 	resolve: {
        modules: ['node_modules']
    }
};
```
- import êµ¬ë¬¸ìœ¼ë¡œ ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ë¶ˆëŸ¬ì˜¤ë©´ **node_modules** í´ë”ì—ì„œ ì°¾ì•„ ì‚¬ìš©í•˜ê²Œ ë¨.
- ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ë¶ˆëŸ¬ì˜¤ë©´ ë¹Œë“œì‹œ _output_ íŒŒì¼ ì•ˆì— í•´ë‹¹ ë¼ì´ë¸ŒëŸ¬ë¦¬ ê´€ë ¨ ì½”ë“œê°€ í•¨ê»˜ ë²ˆë“¤ë§ë¨.
-> ì´ë¥¼ ë§‰ê¸° ìœ„í•´ ë²ˆë“¤ë§í•´ì¤˜ì•¼í•¨. (`webpack-node-externals` ë¼ì´ë¸ŒëŸ¬ë¦¬)

### webpack-node-externals

``` bash
$ yarn add webpack-node-externals
```

webpack.config.server.js (ìˆ˜ì •)
``` js
const nodeExternals = require('webpack-node-externals');
```

### í™˜ê²½ë³€ìˆ˜ ì£¼ì…
``` js
const webpack = require('webpack');
const getClientEnvironment = require('./env');

const env = getClientEnvironment(paths.publicUrlOrPath.slice(0, -1));
```

``` js
{
module.exports = {
		...
    module: {
        ...
    },
    resolve: {
        modules: ['node_modules']
    },
    // ğŸ”» ì¶”ê°€
    externals: [
        nodeExternals({
            allowlist: [/@babel/],
        }),
    ],
};
```

### build ìŠ¤í¬ë¦½íŠ¸ ì‘ì„±

ë£¨íŠ¸ í´ë”ì— /scripts í´ë”ë¥¼ ì—´ì–´ë³´ë©´ `build.js` íŒŒì¼ì´ ì¡´ì¬í•¨ã….
-> í´ë¼ì´ì–¸íŠ¸ì—ì„œ ì‚¬ìš©í•  ë¹Œë“œ íŒŒì¼ì„ ë§Œë“œëŠ” ì‘ì—….

ì´ ìŠ¤í¬ë¦½íŠ¸ì™€ ìœ ì‚¬í•˜ê²Œ build.server.js íŒŒì¼ì„ ìƒì„±í•´ë³´ì.

scripts/build.server.js
``` js
process.env.BABEL_ENV = 'production';
process.env.NODE_ENV = 'production';

process.on('unhandledRejection', err => {
    throw err;
});

require('../config/env');

const fs = require('fs-extra');
const webpack = require('webpack');
const config = require('../config/webpack.config.server');
const paths = require('../config/paths');

function build() {
    console.log('Creating server build...');
    fs.emptyDirSync(paths.ssrBuild);

    let compiler = webpack(config);
    return new Promise((resolve, reject) => {
        compiler.run((err, stats) => {
            if (err) {
                console.log(err);
                return;
            }
            console.log(stats.toString());
        });
    });
}

build();
```

> #### âš¡ï¸ build í…ŒìŠ¤íŠ¸
``` 
$ node scripts/build.server.js
```
> - ì •ìƒì ìœ¼ë¡œ ë¹Œë“œë¨.
![](https://velog.velcdn.com/images/thisisyjin/post/aaea23a7-a569-4d47-b612-82b942ef75cc/image.png)

> #### âš¡ï¸ ì‘ë™ í…ŒìŠ¤íŠ¸
```
$ node dist/server.js
```
- ì •ìƒì ìœ¼ë¡œ ì‘ë™í•¨.
(ì´ˆë°˜ì— src/index.server.jsì— ì‘ì„±í–ˆë˜ ë‚´ìš©ì´ ì¶œë ¥ë¨)
-> `ReactDOMServer.renderToString()` ì•ˆì— ë„£ì–´ì¤¬ë˜ JSX.
![](https://velog.velcdn.com/images/thisisyjin/post/89d6d01d-2cb7-4d4e-b732-e6617e5824ea/image.png)


### package.json ìŠ¤í¬ë¦½íŠ¸ ì¶”ê°€
``` js
  "scripts": {
    "start": "node scripts/start.js",
    "build": "node scripts/build.js",
    "test": "node scripts/test.js",
     // ğŸ”» ì¶”ê°€
    "start:server": "node/server.js",
    "build:server": "node scripts/build.server.js"
  },
```

- ìŠ¤í¬ë¦½íŠ¸ ì‹¤í–‰
``` 
$ yarn build:server
$ yarn start:server
```
ì´ì œ ì„œë²„ì‚¬ì´ë“œ ë Œë”ë§ êµ¬í˜„ ì¤€ë¹„ ì™„ë£Œ!
ì„œë²„ì½”ë“œ ì‘ì„± í›„ ì—°ë™í•˜ë©´ ëì„.


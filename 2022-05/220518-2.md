# Blogrow Project

> ğŸ“ DAY 01 - 220518 (2)
- ë¦¬ë•ìŠ¤ ìƒíƒœê´€ë¦¬


## ë¦¬ë•ìŠ¤ ìƒíƒœê´€ë¦¬

- íšŒì›ê°€ì…, ë¡œê·¸ì¸ í¼(form)ì˜ ìƒíƒœ ê´€ë¦¬.

modules/auth.js ìˆ˜ì •

``` js
import { createAction, handleActions } from 'redux-actions';
import produce from 'immer';

const CHANGE_FIELD = 'auth/CHANGE_FIELD';
const INITIALIZE_FORM = 'auth/INITIALIZE_FORM';

export const changeField = createAction(
  CHANGE_FIELD,
  ({ form, key, value }) => ({ form, key, value }), // form: register, login / key: username, password, passwordConfirm
);
export const initializeForm = createAction(INITIALIZE_FORM, (form) => form);
// register, login

const initialState = {
  register: {
    username: '',
    password: '',
    passwordConfirm: '',
  },
  login: {
    username: '',
    password: '',
  },
};

const auth = handleActions(
  {
    [CHANGE_FIELD]: (state, { payload: { form, key, value } }) =>
      produce(state, (draft) => {
        draft[form][key] = value; // ex> state.register.username
      }),
    [INITIALIZE_FORM]: (state, { payload: form }) => ({
      ...state,
      [form]: initialState[form],
    }),
  },

  initialState,
);

export default auth;

```

#### 1. createAction()

- `redux-actions`ì˜ createActions í•¨ìˆ˜.
-> ì²«ë²ˆì§¸ ì¸ìë¡œëŠ” typeì´ ë“¤ì–´ê°€ê³  / **ë‘ë²ˆì§¸ ì¸ìë¡œëŠ” payloadë¡œ ë“¤ì–´ê°ˆ ê²ƒ**ë“¤ì˜ ì´ë¦„ì„ ë„£ì–´ì¤Œ.


- ì›ë˜ëŠ” payload: { form: 123, key: 456, value: 789 } ì™€ ê°™ì´ ê°ì²´ë¡œ ì €ì¥ë˜ì§€ë§Œ,
- êµ¬ì¡°ë¶„í•´ í• ë‹¹ìœ¼ë¡œ ` ({ form, key, value }) => ({ form, key, value })` ì™€ ê°™ì´ í•´ì¤Œ.


#### 2. handleActions()

- ì²«ë²ˆì§¸ ì¸ìë¡œ ë“¤ì–´ê°€ëŠ” ê°ì²´ì˜ ê° í•„ë“œì— ì•¡ì…˜íƒ€ì…ì„ ì ì–´ì£¼ê³ ,  ê°’ìœ¼ë¡œëŠ” state ì—…ë°ì´íŠ¸í•¨ìˆ˜ë¥¼ ë„£ì–´ì¤Œ.
-> ì—¬ê¸°ì„œëŠ” immerì˜ produce() í•¨ìˆ˜ë¡œ ì‰½ê²Œ (spread ... ì—†ì´) ë¶ˆë³€ì„±ì„ ìœ ì§€í•¨

- ë‘ë²ˆì§¸ ì¸ìë¡œëŠ” ì´ˆê¸° ê°’ì¸ initialStateê°€ ë“¤ì–´ê°.



#### 3. immer ë¼ì´ë¸ŒëŸ¬ë¦¬ì˜ `produce` í•¨ìˆ˜

- [ì°¸ê³  ë§í¬](https://immerjs.github.io/immer/produce/)
- ì²«ë²ˆì§¸ ì¸ìëŠ” state(ë¦¬ë“€ì„œ í•¨ìˆ˜ì˜ ì¸ìë¡œ ë“¤ì–´ì˜¤ëŠ” state)
- ë‘ë²ˆì§¸ ì¸ìëŠ” recipe. ì²«ë²ˆì§¸ ì¸ì(=state)ê°€ ì–´ë–»ê²Œ ë°”ë€”ì§€ ì •ì˜í•˜ëŠ” í•¨ìˆ˜ì„.
``` js
produce(state, (draft) => {
        draft[form][key] = value; // ex> state.register.username
   })
```

***

## ì»¨í…Œì´ë„ˆ ì»´í¬ë„ŒíŠ¸ ìƒì„±

-  ì»´í¬ë„ŒíŠ¸ë¥¼ ë¦¬ë•ìŠ¤ì™€ ì—°ë™ì‹œí‚´.
-> connect() í•¨ìˆ˜ ëŒ€ì‹ ì—
react-reduxì˜ Hookì¸ `useDispatch`, `useSelector` ì´ìš©.

> [ì§€ë‚œ í¬ìŠ¤íŒ…](https://velog.io/@thisisyjin/TIL-22-05-04#hooks%EB%A1%9C-%EC%BB%A8%ED%85%8C%EC%9D%B4%EB%84%88-%EC%83%9D%EC%84%B1) ì°¸ì¡° - `useDispatch`, `useSelector`(state ì¡°íšŒ)


src/containers í´ë” ìƒì„± í›„, auth/LoginForm íŒŒì¼ ìƒì„±.


### LoginForm (ì»¨í…Œì´ë„ˆ) ìƒì„±
containers/auth/LoginForm
``` js
import { useEffect } from 'react';
import { useDispatch, useSelector } from 'react-redux';
import { changeField, initializeForm } from '../../modules/auth';
import AuthForm from '../../components/auth/AuthForm';

const LoginForm = () => {
  
  // store.dispatch ì‚¬ìš©í•˜ê¸° ìœ„í•´ ê°€ì ¸ì˜´
  const dispatch = useDispatch();
  
  // useSelectorë¡œ state.auth.login ì„ ê°€ì ¸ì˜´. (stateëŠ” register, login í•„ë“œ ì¡´ì¬)
  const { form } = useSelector(({ auth }) => ({
    form: auth.login,
  }));

  // input ë³€ê²½ì‹œ ì´ë²¤íŠ¸
  const onChange = (e) => {
    const { value, name } = e.target;
    // changeField ì•¡ì…˜ì„ ë°œìƒì‹œí‚´. -> ì¸ìë¡œëŠ” payloadê°€ ë“¤ì–´ê°.
    dispatch(
      changeField({ 
        form: 'login',  
        key: name,	// e.target.name ìœ¼ë¡œ, username ë˜ëŠ” password
        value, 
      }),
    );
  };

  const onSubmit = (e) => {
    e.preventDefault(); 
    // í¼ ì œì¶œì‹œ ğŸ‘‰ ì¶”í›„ ì‘ì„±ì˜ˆì •.
  };

  useEffect(() => {
    // initializeForm ì•¡ì…˜ ìƒì„±í•¨ìˆ˜ë¥¼ dispatchí•¨. - payloadëŠ” login (form: login)
    dispatch(initializeForm('login'));
  }, [dispatch]);

  return (
    // propsë¡œ ë„˜ê¸´ loginê°’ì— ë”°ë¼ UI ë³€ê²½ë¨.
    <AuthForm
      type="login"
    // ğŸ”» ìƒˆë¡œìš´ propsë“¤ ë„˜ê¹€
      form={form}
      onChange={onChange}
      onSubmit={onSubmit}
    />
  );
};

```


> âœ… ì•¡ì…˜ ë°œìƒ(dispatch)ì‹œ
`dispatch(ì•¡ì…˜ìƒì„±í•¨ìˆ˜(payload))`ë¥¼ í•´ì£¼ë©´ ë¨

### LoginPage ë Œë”ë§

- AuthForm ëŒ€ì‹ ì— LoginForm(=ì»¨í…Œì´ë„ˆ)ë¥¼ ë„£ì–´ì¤Œ.

pages/LoginPage.js ìˆ˜ì •
``` jsx
import AuthTemplate from '../components/auth/AuthTemplate';
import LoginForm from '../containers/auth/LoginForm';

const LoginPage = () => {
  return (
    <AuthTemplate>
      <LoginForm />
    </AuthTemplate>
  );
};

export default LoginPage;

```

### AuthForm ìˆ˜ì •
components/auth/AuthForm.js ìˆ˜ì •
``` js
import styled from 'styled-components';
import palette from '../../lib/styles/palette';
import { Link } from 'react-router-dom';
import Button from '../common/Button';

	... 

const AuthForm = ({ type, form, onChange, onSubmit }) => {
  const text = textMap[type];
  return (
    <AuthFormBlock>
      <h3>{text}</h3>
      <form onSubmit={onSubmit}>
        <StyledInput
          autoComplete="username"
          name="username"
          placeholder="ì•„ì´ë””"
          onChange={onChange}
          value={form.username}
        />
        <StyledInput
          type="password"
          autoComplete="new-password"
          name="password"
          placeholder="ë¹„ë°€ë²ˆí˜¸"
          onChange={onChange}
          value={form.password}
        />
        {type === 'register' && (
          <StyledInput
            autoComplete="new-password"
            name="passwordConfirm"
            placeholder="ë¹„ë°€ë²ˆí˜¸ í™•ì¸"
            type="password"
            onChange={onChange}
            value={form.passwordConfirm}
          />
        )}
        <ButtonWithMarginTop teal fullWidth>
          {text}
        </ButtonWithMarginTop>
      </form>
      <Footer>
        {type === 'login' ? (
          <Link to="/register">íšŒì›ê°€ì…</Link>
        ) : (
          <Link to="/login">ë¡œê·¸ì¸</Link>
        )}
      </Footer>
    </AuthFormBlock>
  );
};

export default AuthForm;

```

- LoginForm(ì»¨í…Œì´ë„ˆ)ì—ì„œ ë„˜ê²¨ì¤€ propsë¥¼ ë°›ì•„ì˜¤ê³  ê°’ì„ ì‚¬ìš©í•¨.

``` js
const { form } = useSelector(({ auth }) => ({
    form: auth.login,
  }));
```

- propsë¡œ ì „ë‹¬ëœ `form`ì€ state, ì¦‰ `auth.login` ì´ë¯€ë¡œ username, password í•„ë“œë¥¼ ê°€ì§„ ê°ì²´ì´ë‹¤.
``` 
login: {
    username: '',
    password: '',
  },
```

<br>

#### âœ… TEST

- localhost:3000/login ì—ì„œ ì¸í’‹ì— í…ìŠ¤íŠ¸ ì…ë ¥ í›„,
ë¦¬ë•ìŠ¤ ìŠ¤í† ì–´ì— ê°’ì´ ì˜ ë“¤ì–´ê°€ëŠ” ê²ƒì„ í™•ì¸.

![](https://velog.velcdn.com/images/thisisyjin/post/3f42e466-bb9b-44a3-9523-ada49e627dda/image.png)


***

### RegisterForm (ì»¨í…Œì´ë„ˆ) ìƒì„±

- LoginForm ì„ ê·¸ëŒ€ë¡œ ë³µì œí•´ì„œ 
Login -> Register,
login -> register ë¡œ ë°”ê¿”ì£¼ë©´ ë¨. 

containers/RegisterForm.js
``` jsx
import { useEffect } from 'react';
import { useDispatch, useSelector } from 'react-redux';
import { changeField, initializeForm } from '../../modules/auth';
import AuthForm from '../../components/auth/AuthForm';

const RegisterForm = () => {
  const dispatch = useDispatch();
  const { form } = useSelector(({ auth }) => ({
    form: auth.register,
  }));

  const onChange = (e) => {
    const { value, name } = e.target;
    dispatch(
      changeField({
        form: 'register',
        key: name,
        value, // value: e.target.value
      }),
    );
  };

  const onSubmit = (e) => {
    e.preventDefault();
    // í¼ ì œì¶œì‹œ
  };

  useEffect(() => {
    dispatch(initializeForm('register'));
  }, [dispatch]);

  return (
    <AuthForm
      type="register"
      form={form}
      onChange={onChange}
      onSubmit={onSubmit}
    />
  );
};

export default RegisterForm;

```

ë§ˆì°¬ê°€ì§€ë¡œ RegisterPage ë Œë”ë§ì„ ë°”ê¿”ì¤Œ.

pages/RegisterPage.js

``` jsx
import AuthTemplate from '../components/auth/AuthTemplate';
import RegisterForm from '../containers/auth/RegisterForm';

const RegisterPage = () => {
  return (
    <AuthTemplate>
      <RegisterForm />
    </AuthTemplate>
  );
};

export default RegisterPage;

```

### RESULT

![](https://velog.velcdn.com/images/thisisyjin/post/42a0eca2-b42d-44ee-8dc1-86be10888578/image.png)

![](https://velog.velcdn.com/images/thisisyjin/post/350cd178-1953-4754-94fe-2a7fab318e9c/image.png)


ìŠ¤í† ì–´ì— ì˜ ì €ì¥ë¨!


> ìš°ì„  ì—¬ê¸°ê¹Œì§€ ì§„í–‰ ê³¼ì • ë³µìŠµí•˜ê¸°.
ë‚´ì¼ì€ redux ë¯¸ë“¤ì›¨ì–´ì¸ redux-saga ë¡œ API ì—°ë™ + íšŒì›ê°€ì… / ë¡œê·¸ì¸ êµ¬í˜„

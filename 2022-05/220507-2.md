# React.js

**Today I Learned ... **`react.js`

>üôã‚Äç‚ôÇÔ∏è [**Reference Lecture*](https://nomadcoders.co/react-hooks-introduction)

>üôã‚Äç [**My Dev Blog**](https://mywebproject.tistory.com/)

***

> ** React Hooks Í∞ïÏùò **


# Hooks

## custom Hooks


### useScroll

- Ï¥àÍ∏∞ ÏΩîÎìú
``` jsx
const useScroll = () => {
  const [state, setState] = useState({
    x: 0,
    y: 0
  });
  const onScroll = (e) => {
    console.log(e);
  };
  useEffect(() => {
    window.addEventListener("scroll", onScroll);
    return () => window.removeEventListener("scroll", onScroll);
  }, []);

  return state;
};

const App = () => {
  const { y } = useScroll();

  return (
    <div style={{ height: "1000vh" }}>
      <h1 style={{ position: "fixed", color: y > 100 ? "red" : "blue" }}>hi</h1>
      <p></p>
    </div>
  );
};
```

![](https://velog.velcdn.com/images/thisisyjin/post/242fa619-4317-4054-b675-76803d5240df/image.png)

Ïä§ÌÅ¨Î°§ Ï¢åÌëúÏùò Í≤ΩÏö∞ÏóêÎäî, Ïù¥Î≤§Ìä∏ Í∞ùÏ≤¥ÏóêÏÑú ÏñªÎäîÍ≤ÉÏù¥ ÏïÑÎãå `window.scrollY`ÏóêÏÑú Í∞ÄÏ†∏ÏôÄÏïº Ìï®.

![](https://velog.velcdn.com/images/thisisyjin/post/bf04ccd9-0498-4ced-ac3a-c11d29e85b67/image.png)

- Ïä§ÌÅ¨Î°§ÏùÑ ÎÇ¥Î¶¥Îïå ÎßàÎã§ scrollYÍ∞Ä Ï∂úÎ†•Îê®.

``` js
const onScroll = () => {
    setState({ x: window.scrollX, y: window.scrollY });
  };
```
-> setStateÎ•º Ìï¥Ï§å.

![](https://velog.velcdn.com/images/thisisyjin/post/b3ba7d62-dda3-48ed-b426-b501844d9d55/image.gif)

``` jsx
<h1 style={{ position: "fixed", color: y > 100 ? "red" : "blue" }}>hi</h1>
```
`y > 100` Ïù¥ ÎêòÎ©¥ h1Ïùò colorÏù¥ redÎ°ú Ï†ÅÏö©Îê®.



***

### useFullscreen

- Ïù¥ÎØ∏ÏßÄÎ•º fullscreenÏúºÎ°ú ÎßåÎì§ÎèÑÎ°ù.

- useRef + `requestFullscreen` Ïù¥Ïö©
> [requestFullscreen](https://developer.mozilla.org/en-US/docs/Web/API/Element/requestFullScreen) 

``` jsx
const useFullscreen = () => {
  const element = useRef();
  const triggerFull = () => {
    if (element.current) {
      element.current.requestFullscreen();
    }
  };
  return { element, triggerFull };
};

const App = () => {
  const { element, triggerFull } = useFullscreen();
  return (
    <div>
      <img
        ref={element}
        src="https://miro.medium.com/max/1200/0*XCgoYU9sqt95P8J0.png"
        alt="react"
      />
      <button onClick={triggerFull}>make fullscreen</button>
    </div>
  );
};
```


![](https://velog.velcdn.com/images/thisisyjin/post/cf89af29-d34e-462c-b05f-faa64e55a00b/image.gif)
Î≤ÑÌäº ÌÅ¥Î¶≠Ïãú `ref.current`Î•º Ï†ÑÏ≤¥ÌôîÎ©¥ÏúºÎ°ú ÎßåÎì§Ïñ¥Ï§å.

#### fullscreenÏùÑ Îπ†Ï†∏ÎÇòÍ∞ÄÎäî Í∏∞Îä• (exit)

``` jsx
const exitFull = () => {
    document.exitFullscreen();
  };
```

> ‚úÖ Ï∞∏Í≥† 
- `requestFullscreen`ÏùÄ **element**Ïóê Ïç®Ï£ºÏóàÎäîÎç∞, (=ref) 
- `exitFullscreen`ÏùÄ **document** Í∞ùÏ≤¥ÏóêÏÑú Ïç®Ï§å.

- jsx ÏàòÏ†ï
``` jsx
const App = () => {
  const { element, triggerFull, exitFull } = useFullscreen();
  return (
    <div>
      <div ref={element}>
        <img
          src="https://miro.medium.com/max/1200/0*XCgoYU9sqt95P8J0.png"
          alt="react"
          width="300px"
        />
        <button onClick={exitFull}>exit fullscreen</button>
      </div>
      <button onClick={triggerFull}>make fullscreen</button>
    </div>
  );
};
```
-> imgÎ•º divÎ°ú Í∞êÏãº ÌõÑ refÎ•º divÏóê Îã¨ÏïÑÏ£ºÍ≥†,
exit Î≤ÑÌäºÏùÄ ÌíÄÏä§ÌÅ¨Î¶∞Ïù¥ ÎêòÎäî divÏïàÏóê ÎÑ£Ïñ¥Ï§å.

(Í∑∏ÎûòÏïº Îπ†Ï†∏ÎÇòÏò¨ Ïàò ÏûàÍ∏∞ ÎïåÎ¨∏)


#### +) callback Ïã§ÌñâÎèÑ ÌïòÎ†§Î©¥

- fullscreenÏùºÎïå ÏΩúÎ∞±ÏùÑ Ïã§ÌñâÌïòÎ†§Î©¥
ÏïÑÎûòÏôÄ Í∞ôÏù¥ ÏûëÏÑ±Ìï¥Ï§ÄÎã§.
-> `triggerFull` ÏóêÏÑúÎäî Ìï®Ïàò callback(true) Ïã§ÌñâÌïòÍ≥†, 
`exitFull` ÏóêÏÑúÎäî callback(false)Î•º Ïã§Ìñâ.

>Ï∞∏Í≥†Î°ú true, falseÎäî callbackÏúºÎ°ú Ï†ÑÎã¨ÎêòÎäî Ìï®ÏàòÏùò `isFull` Î≥ÄÏàòÏûÑ.
``` js
const onFullS = (isFull) => {
    console.log(isFull ? "full!" : "small.");
  };
```

``` jsx
const useFullscreen = (callback) => {
  const element = useRef();
  const triggerFull = () => {
    if (element.current) {
      element.current.requestFullscreen();
      if (callback && typeof callback === "function") {
        callback(true);
      }
    }
  };
  const exitFull = () => {
    document.exitFullscreen();
    if (callback && typeof callback === "function") {
      callback(false);
    }
  };
  return { element, triggerFull, exitFull };
};
```

#### Ï†ÑÏ≤¥ ÏΩîÎìú
``` jsx
const useFullscreen = (callback) => {
  const element = useRef();
  const triggerFull = () => {
    if (element.current) {
      element.current.requestFullscreen();
      if (callback && typeof callback === "function") {
        callback(true);
      }
    }
  };
  const exitFull = () => {
    document.exitFullscreen();
    if (callback && typeof callback === "function") {
      callback(false);
    }
  };
  return { element, triggerFull, exitFull };
};

const App = () => {
  const onFullS = (isFull) => {
    console.log(isFull ? "full!" : "small.");
  };
  const { element, triggerFull, exitFull } = useFullscreen(onFullS);
  return (
    <div>
      <div ref={element}>
        <img
          src="https://miro.medium.com/max/1200/0*XCgoYU9sqt95P8J0.png"
          alt="react"
          width="300px"
        />
        <button onClick={exitFull}>exit fullscreen</button>
      </div>
      <button onClick={triggerFull}>make fullscreen</button>
    </div>
  );
};
```

![](https://velog.velcdn.com/images/thisisyjin/post/a7fd910c-d27c-4117-90b5-077c2afb3feb/image.png)


***


### useNotification

- ÏïåÎûåÏùÑ Î≥¥ÎÇ¥Îäî Í∏∞Îä•
- `notification API` ÏÇ¨Ïö©.
- HookÏùÑ ÏÇ¨Ïö©ÌïúÍ±¥ ÏïÑÎãàÏßÄÎßå, Ïú†Ïö©ÌïòÍ≤å Ïì∞ÏûÑ.

> [notification API - mdn Î¨∏ÏÑú](https://developer.mozilla.org/ko/docs/Web/API/notification)
- ÏÇ¨Ïö©ÏûêÏóêÍ≤å Îç∞Ïä§ÌÅ¨ÌÜ± ÏïåÎ¶ºÏùÑ ÏÑ§Ï†ïÌïòÍ≥† Î≥¥Ïó¨Ï£ºÎäîÎç∞ ÏÇ¨Ïö©Ìï®.
1. `Notification.permission` (read only props)
-> denied, granted, default Í∞Ä ÏûàÏùå.
2. `Notification.requesetPermission()` - Ï†ïÏ†Å Î©îÏÑúÎìú
-> ÏïÑÏßÅ ÏïåÎ¶º ÌëúÏãú Í∂åÌïúÏù¥ ÌóàÏö©ÎêòÏßÄ ÏïäÏïòÎã§Î©¥ , `Notification.requestPermission()` Î©îÏÑúÎìúÎ•º ÏÇ¨Ïö©ÌïòÏó¨ ÏÇ¨Ïö©ÏûêÏóêÍ≤å Í∂åÌïúÏùÑ ÏöîÏ≤≠Ìï† ÌïÑÏöîÍ∞Ä ÏûàÏùå.

``` jsx
const useNotification = (title, options) => {
  if (!("Notification" in window)) {
    return;
  }
  const fireNotif = () => {
    if (Notification.permission !== "granted") {
      Notification.requestPermission().then((permission) => {
        if (permission === "granted") {
          new Notification(title, options);
        } else {
          return;
        }
      });
    } else {
      new Notification(title, options);
    }
  };
  return fireNotif;
};

const App = () => {
  const triggerNotif = useNotification("this is notification!");
  return (
    <div>
      <button onClick={triggerNotif}>Notification</button>
    </div>
  );
};
```

Î≤ÑÌäº ÌÅ¥Î¶≠Ïãú Îã§ÏùåÍ≥º Í∞ôÏù¥ ÏïåÎ¶ºÏ∞ΩÏù¥ Îú¨Îã§.
![](https://velog.velcdn.com/images/thisisyjin/post/78c7767b-bdf1-4b85-a0e9-0fef94ac0cd7/image.png)



#### +) options

useNotification()Ïùò ÎëêÎ≤àÏß∏ Ïù∏ÏûêÎ°ú optionsÏùÑ ÎÑ£Ïñ¥Ï§Ñ Ïàò ÏûàÏùå.
``` jsx
  const triggerNotif = useNotification("this is notification!", {
    body: "I love React Hooks."
  });
```
![](https://velog.velcdn.com/images/thisisyjin/post/31548ebb-3628-409d-9553-6431e2e17477/image.png)

> Ï∞∏Í≥†Î°ú, urlÏ∞Ω ÏôºÏ™ΩÏóê ÏûêÎ¨ºÏá† Î™®ÏñëÏùÑ ÎàÑÎ•¥Î©¥ Îã§Ïãú ÏïåÎ¶º ÏÑ§Ï†ïÏùÑ Ìï† Ïàò ÏûàÎã§.
![](https://velog.velcdn.com/images/thisisyjin/post/62b8dab6-2083-4102-8425-eb3f29ca7df3/image.png)




***

### useAxios

- Ïö∞ÏÑ†, ÏΩîÎìúÎ•º ÏûëÏÑ±Ï§ëÏù¥Îçò codesandboxÏóê dependencyÏù∏ `axios`Î•º Ï∂îÍ∞ÄÌï¥Ï§ÄÎã§.
-> ÌïòÎã®Ïóê ÏùòÏ°¥ÏÑ± Ï∂îÍ∞Ä Ï∞ΩÏù¥ ÏûàÏùå.

![](https://velog.velcdn.com/images/thisisyjin/post/37e6fca5-46a6-4f18-a889-b5897e03a486/image.png)

#### 1. Ï¥àÍ∏∞ ÏΩîÎìú

useAxios.js
``` jsx
import defaultAxios from 'axios';

const useAxios = (opts, axiosInstance = defaultAxios) => {
  // defaultAxiosÎ•º Í∏∞Î≥∏Í∞íÏúºÎ°ú ÏÑ§Ï†ï.
  // axiosÎäî customizeÏôÄ configureÏùÑ ÌóàÏö©Ìï®. 
  // ÎîîÌè¥Ìä∏ urlÏù¥ÎÇò Ìó§Îçî ÏÑ§Ï†ï Îì±.
  
  if (!opts.url) {
    return;
  }
}

export default useAxios;
```

Ï≤´Î≤àÏß∏ Ïù∏ÏûêÎ°ú `opts` Î•º Ï£ºÎäîÎç∞, optsÎäî Í∞ùÏ≤¥ ÌòïÌÉúÏù¥Í≥†, url ÌïÑÎìúÎ•º Î∞òÎìúÏãú Ìè¨Ìï®Ìï¥Ïïº ÌïúÎã§.
-> if-returnÎ¨∏ÏúºÎ°ú Í±∏Îü¨Ï§å



#### 2. App ÏóêÏÑú ÏÇ¨Ïö©
``` jsx
import useAxios from './useAxios';

const App = () => {
  const request = useAxios({ url: "https://yts.am/api/v2/list_movies.json" });

  return <div>hello</div>;
};
```
-> Ï≤´Î≤àÏß∏ Ïù∏ÏûêÏù∏ optsÎ•º ÎÑ£Ïñ¥Ï§å.
-> url ÌïÑÎìúÎ•º ÎßåÎìúÏãú Ìè¨Ìï®.

#### 3. useState + useEffect

``` jsx
const useAxios = (opts, axiosInstance = defaultAxios) => {
  // defaultAxiosÎ•º Í∏∞Î≥∏Í∞íÏúºÎ°ú ÏÑ§Ï†ï.
  // axiosÎäî customizeÏôÄ configureÏùÑ ÌóàÏö©Ìï®.
  // ÎîîÌè¥Ìä∏ urlÏù¥ÎÇò Ìó§Îçî ÏÑ§Ï†ï Îì±.
  const [state, setState] = useState({
    loading: true,
    error: null,
    data: null
  });

  if (!opts.url) {
    return;
  }

  useEffect(() => {
    
  }, []); // ÌïúÎ≤àÎßå Î∂àÎü¨Ïò§ÎèÑÎ°ù depsÎ•º Îπà Î∞∞Ïó¥Î°ú

  return state;
};

export default useAxios;
```
-> useStateÎ°ú ÏÉÅÌÉúÎ•º ÎßåÎì§Ïñ¥Ï£ºÍ≥†, useEffect ÏïàÏóêÏÑúÎäî axiosÎ•º ÏöîÏ≤≠ÌïòÎäî ÏΩîÎìúÎ•º ÎÑ£ÏùÑ Í≤ÉÏûÑ.

stateÎ°úÎäî loading, error, data Í∞Ä ÏûàÏùå.

#### 4. setState

useAxios.js
``` jsx
const useAxios = (opts, axiosInstance = defaultAxios) => {
  const [state, setState] = useState({
    loading: true,
    error: null,
    data: null
  });

  if (!opts.url) {
    return;
  }

  useEffect(() => {
    axiosInstance(opts).then((data) => {
      setState({
        ...state,
        loading: false,
        data
      });
    });
  }, []); // ÌïúÎ≤àÎßå Î∂àÎü¨Ïò§ÎèÑÎ°ù depsÎ•º Îπà Î∞∞Ïó¥Î°ú

  return state;
};
```



App.js
``` jsx
const App = () => {
  const { loading, data, error } = useAxios({
    url: "https://yts.mx/api/v2/list_movies.json"
  });
  console.log(loading, data, error);

  return <div>hello</div>;
};
```

ÎëêÎ≤àÏß∏ Ïù∏ÏûêÎ•º ÏïàÏ§¨ÏúºÎØÄÎ°ú defaultAxiosÍ∞Ä **axiosInstanceÍ∞Ä** ÎêúÎã§. (Í∏∞Î≥∏Í∞í)

üîª Í≤∞Íµ≠ Ïù¥Îü∞ Íµ¨Ï°∞Ïù∏ ÏÖà.
``` js
axios({url: ~~~}).then( data => {
setState({~~~}) } 
```


![](https://velog.velcdn.com/images/thisisyjin/post/94e0e423-cd3b-4297-b631-9195f9c6e255/image.png)

-> Îç∞Ïù¥ÌÑ∞Í∞Ä Îì§Ïñ¥Ïò§Í≥†, loadingÏù¥ falseÎ°ú Î∞îÎÄú.

#### 5. ÏóêÎü¨ catch
-> .then() Îí§Ïóê .catch(e => {}) Ï∂îÍ∞Ä.

``` jsx
useEffect(() => {
    axiosInstance(opts)
      .then((data) => {
        setState({
          ...state,
          loading: false,
          data
        });
      })
      .catch((error) => {
        setState({ ...state, loading: false, error });
      });
  }, []); // ÌïúÎ≤àÎßå Î∂àÎü¨Ïò§ÎèÑÎ°ù depsÎ•º Îπà Î∞∞Ïó¥Î°ú
```


### refetching (Îã§Ïãú Í∞ÄÏ†∏Ïò§Í∏∞)
-> `useEffect`Îäî deps ÏïàÏóê ÏÉÅÌÉúÍ∞Ä Î∞îÎÄî Îïå ÎßàÎã§ Ïã§ÌñâÎêúÎã§.


1. trigger state Ï∂îÍ∞Ä + `refetch()` Ìï®Ïàò
``` jsx
const [trigger, setTrigger] = useState(0);

...

const refetch = () => {
    setState({
      ...state,
      loading: true
    });
    setTrigger(Date.now()); // Í≥†Ïú†Ìïú ÏûÑÏùòÏùò Ïà´Ïûê ÏÉùÏÑ±
  };
```
> Í≥†Ïú†Ìïú Í∞íÏùÑ ÎÑòÍ≤®Ï£ºÍ∏∞ ÏúÑÌï¥ Date.now()Î•º ÏçºÏùå.

2. useEffect Ï∂îÍ∞Ä - depsÏóê trigger Ï∂îÍ∞Ä
``` jsx
useEffect(() => {
    axiosInstance(opts)
      .then((data) => {
        ...
      })
      .catch((error) => {
        ...
      });
  }, [trigger]); // triggerÏù¥ Î≥ÄÍ≤ΩÎê†ÎïåÎßàÎã§ Î¶¨Ìå®Ïπ≠
```

3. return trigger
``` js
return { ...state, refetch }
```
-> state Î•º ÌéºÏ≥êÏÑú -> {loading, error, data}Î•º ÌéºÏ≥êÏÑú Î¶¨ÌÑ¥Ìï®.
Ï¶â, {loading, error, data, refetch} ÏûÑ.


4. App ÏàòÏ†ï
``` jsx
const App = () => {
  const { loading, data, error, refetch } = useAxios({
    url: "https://yts.mx/api/v2/list_movies.json"
  });
  console.log(loading, data, error);

  return (
    <div>
      <h1>{data && data.status}</h1>
      <h2>{loading && "loading ..."}</h2>
      <button onClick={refetch}>Refetch</button>
    </div>
  );
};
```
### Result

![](https://velog.velcdn.com/images/thisisyjin/post/47630678-94af-4a8a-b9d1-5b93079eba34/image.gif)
-> refetch Ìï†ÎïåÎßàÎã§ Ìå®ÏπòÌï®.

***

ÏßÄÍ∏àÍπåÏßÄ ÏïÑÎûòÏôÄ Í∞ôÏùÄ HookÏùÑ Ï†úÏûëÌï¥Î¥Ñ.

![](https://velog.velcdn.com/images/thisisyjin/post/1aa1797c-c005-4290-9e1a-e81f2428e899/image.png)

***

## NPM publishing 

> [Ï∞∏Í≥† Î¨∏ÏÑú](https://www.daleseo.com/js-npm-publish/)

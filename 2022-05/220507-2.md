# React.js

**Today I Learned ... **`react.js`

>ðŸ™‹â€â™‚ï¸ [**Reference Lecture*](https://nomadcoders.co/react-hooks-introduction)

>ðŸ™‹â€ [**My Dev Blog**](https://mywebproject.tistory.com/)

***

> ** React Hooks ê°•ì˜ **


# Hooks

## custom Hooks


### useScroll

- ì´ˆê¸° ì½”ë“œ
``` jsx
const useScroll = () => {
  const [state, setState] = useState({
    x: 0,
    y: 0
  });
  const onScroll = (e) => {
    console.log(e);
  };
  useEffect(() => {
    window.addEventListener("scroll", onScroll);
    return () => window.removeEventListener("scroll", onScroll);
  }, []);

  return state;
};

const App = () => {
  const { y } = useScroll();

  return (
    <div style={{ height: "1000vh" }}>
      <h1 style={{ position: "fixed", color: y > 100 ? "red" : "blue" }}>hi</h1>
      <p></p>
    </div>
  );
};
```

![](https://velog.velcdn.com/images/thisisyjin/post/242fa619-4317-4054-b675-76803d5240df/image.png)

ìŠ¤í¬ë¡¤ ì¢Œí‘œì˜ ê²½ìš°ì—ëŠ”, ì´ë²¤íŠ¸ ê°ì²´ì—ì„œ ì–»ëŠ”ê²ƒì´ ì•„ë‹Œ `window.scrollY`ì—ì„œ ê°€ì ¸ì™€ì•¼ í•¨.

![](https://velog.velcdn.com/images/thisisyjin/post/bf04ccd9-0498-4ced-ac3a-c11d29e85b67/image.png)

- ìŠ¤í¬ë¡¤ì„ ë‚´ë¦´ë•Œ ë§ˆë‹¤ scrollYê°€ ì¶œë ¥ë¨.

``` js
const onScroll = () => {
    setState({ x: window.scrollX, y: window.scrollY });
  };
```
-> setStateë¥¼ í•´ì¤Œ.

![](https://velog.velcdn.com/images/thisisyjin/post/b3ba7d62-dda3-48ed-b426-b501844d9d55/image.gif)

``` jsx
<h1 style={{ position: "fixed", color: y > 100 ? "red" : "blue" }}>hi</h1>
```
`y > 100` ì´ ë˜ë©´ h1ì˜ colorì´ redë¡œ ì ìš©ë¨.



***

### useFullscreen

- ì´ë¯¸ì§€ë¥¼ fullscreenìœ¼ë¡œ ë§Œë“¤ë„ë¡.

- useRef + `requestFullscreen` ì´ìš©
> [requestFullscreen](https://developer.mozilla.org/en-US/docs/Web/API/Element/requestFullScreen) 

``` jsx
const useFullscreen = () => {
  const element = useRef();
  const triggerFull = () => {
    if (element.current) {
      element.current.requestFullscreen();
    }
  };
  return { element, triggerFull };
};

const App = () => {
  const { element, triggerFull } = useFullscreen();
  return (
    <div>
      <img
        ref={element}
        src="https://miro.medium.com/max/1200/0*XCgoYU9sqt95P8J0.png"
        alt="react"
      />
      <button onClick={triggerFull}>make fullscreen</button>
    </div>
  );
};
```


![](https://velog.velcdn.com/images/thisisyjin/post/cf89af29-d34e-462c-b05f-faa64e55a00b/image.gif)
ë²„íŠ¼ í´ë¦­ì‹œ `ref.current`ë¥¼ ì „ì²´í™”ë©´ìœ¼ë¡œ ë§Œë“¤ì–´ì¤Œ.

#### fullscreenì„ ë¹ ì ¸ë‚˜ê°€ëŠ” ê¸°ëŠ¥ (exit)

``` jsx
const exitFull = () => {
    document.exitFullscreen();
  };
```

> âœ… ì°¸ê³  
- `requestFullscreen`ì€ **element**ì— ì¨ì£¼ì—ˆëŠ”ë°, (=ref) 
- `exitFullscreen`ì€ **document** ê°ì²´ì—ì„œ ì¨ì¤Œ.

- jsx ìˆ˜ì •
``` jsx
const App = () => {
  const { element, triggerFull, exitFull } = useFullscreen();
  return (
    <div>
      <div ref={element}>
        <img
          src="https://miro.medium.com/max/1200/0*XCgoYU9sqt95P8J0.png"
          alt="react"
          width="300px"
        />
        <button onClick={exitFull}>exit fullscreen</button>
      </div>
      <button onClick={triggerFull}>make fullscreen</button>
    </div>
  );
};
```
-> imgë¥¼ divë¡œ ê°ì‹¼ í›„ refë¥¼ divì— ë‹¬ì•„ì£¼ê³ ,
exit ë²„íŠ¼ì€ í’€ìŠ¤í¬ë¦°ì´ ë˜ëŠ” divì•ˆì— ë„£ì–´ì¤Œ.

(ê·¸ëž˜ì•¼ ë¹ ì ¸ë‚˜ì˜¬ ìˆ˜ ìžˆê¸° ë•Œë¬¸)


#### +) callback ì‹¤í–‰ë„ í•˜ë ¤ë©´

- fullscreenì¼ë•Œ ì½œë°±ì„ ì‹¤í–‰í•˜ë ¤ë©´
ì•„ëž˜ì™€ ê°™ì´ ìž‘ì„±í•´ì¤€ë‹¤.
-> `triggerFull` ì—ì„œëŠ” í•¨ìˆ˜ callback(true) ì‹¤í–‰í•˜ê³ , 
`exitFull` ì—ì„œëŠ” callback(false)ë¥¼ ì‹¤í–‰.

>ì°¸ê³ ë¡œ true, falseëŠ” callbackìœ¼ë¡œ ì „ë‹¬ë˜ëŠ” í•¨ìˆ˜ì˜ `isFull` ë³€ìˆ˜ìž„.
``` js
const onFullS = (isFull) => {
    console.log(isFull ? "full!" : "small.");
  };
```

``` jsx
const useFullscreen = (callback) => {
  const element = useRef();
  const triggerFull = () => {
    if (element.current) {
      element.current.requestFullscreen();
      if (callback && typeof callback === "function") {
        callback(true);
      }
    }
  };
  const exitFull = () => {
    document.exitFullscreen();
    if (callback && typeof callback === "function") {
      callback(false);
    }
  };
  return { element, triggerFull, exitFull };
};
```

#### ì „ì²´ ì½”ë“œ
``` jsx
const useFullscreen = (callback) => {
  const element = useRef();
  const triggerFull = () => {
    if (element.current) {
      element.current.requestFullscreen();
      if (callback && typeof callback === "function") {
        callback(true);
      }
    }
  };
  const exitFull = () => {
    document.exitFullscreen();
    if (callback && typeof callback === "function") {
      callback(false);
    }
  };
  return { element, triggerFull, exitFull };
};

const App = () => {
  const onFullS = (isFull) => {
    console.log(isFull ? "full!" : "small.");
  };
  const { element, triggerFull, exitFull } = useFullscreen(onFullS);
  return (
    <div>
      <div ref={element}>
        <img
          src="https://miro.medium.com/max/1200/0*XCgoYU9sqt95P8J0.png"
          alt="react"
          width="300px"
        />
        <button onClick={exitFull}>exit fullscreen</button>
      </div>
      <button onClick={triggerFull}>make fullscreen</button>
    </div>
  );
};
```

![](https://velog.velcdn.com/images/thisisyjin/post/a7fd910c-d27c-4117-90b5-077c2afb3feb/image.png)


***


### useNotification

- ì•ŒëžŒì„ ë³´ë‚´ëŠ” ê¸°ëŠ¥
- `notification API` ì‚¬ìš©.
- Hookì„ ì‚¬ìš©í•œê±´ ì•„ë‹ˆì§€ë§Œ, ìœ ìš©í•˜ê²Œ ì“°ìž„.

> [notification API - mdn ë¬¸ì„œ](https://developer.mozilla.org/ko/docs/Web/API/notification)
- ì‚¬ìš©ìžì—ê²Œ ë°ìŠ¤í¬í†± ì•Œë¦¼ì„ ì„¤ì •í•˜ê³  ë³´ì—¬ì£¼ëŠ”ë° ì‚¬ìš©í•¨.
1. `Notification.permission` (read only props)
-> denied, granted, default ê°€ ìžˆìŒ.
2. `Notification.requesetPermission()` - ì •ì  ë©”ì„œë“œ
-> ì•„ì§ ì•Œë¦¼ í‘œì‹œ ê¶Œí•œì´ í—ˆìš©ë˜ì§€ ì•Šì•˜ë‹¤ë©´ , `Notification.requestPermission()` ë©”ì„œë“œë¥¼ ì‚¬ìš©í•˜ì—¬ ì‚¬ìš©ìžì—ê²Œ ê¶Œí•œì„ ìš”ì²­í•  í•„ìš”ê°€ ìžˆìŒ.

``` jsx
const useNotification = (title, options) => {
  if (!("Notification" in window)) {
    return;
  }
  const fireNotif = () => {
    if (Notification.permission !== "granted") {
      Notification.requestPermission().then((permission) => {
        if (permission === "granted") {
          new Notification(title, options);
        } else {
          return;
        }
      });
    } else {
      new Notification(title, options);
    }
  };
  return fireNotif;
};

const App = () => {
  const triggerNotif = useNotification("this is notification!");
  return (
    <div>
      <button onClick={triggerNotif}>Notification</button>
    </div>
  );
};
```

ë²„íŠ¼ í´ë¦­ì‹œ ë‹¤ìŒê³¼ ê°™ì´ ì•Œë¦¼ì°½ì´ ëœ¬ë‹¤.
![](https://velog.velcdn.com/images/thisisyjin/post/78c7767b-bdf1-4b85-a0e9-0fef94ac0cd7/image.png)



#### +) options

useNotification()ì˜ ë‘ë²ˆì§¸ ì¸ìžë¡œ optionsì„ ë„£ì–´ì¤„ ìˆ˜ ìžˆìŒ.
``` jsx
  const triggerNotif = useNotification("this is notification!", {
    body: "I love React Hooks."
  });
```
![](https://velog.velcdn.com/images/thisisyjin/post/31548ebb-3628-409d-9553-6431e2e17477/image.png)

> ì°¸ê³ ë¡œ, urlì°½ ì™¼ìª½ì— ìžë¬¼ì‡  ëª¨ì–‘ì„ ëˆ„ë¥´ë©´ ë‹¤ì‹œ ì•Œë¦¼ ì„¤ì •ì„ í•  ìˆ˜ ìžˆë‹¤.
![](https://velog.velcdn.com/images/thisisyjin/post/62b8dab6-2083-4102-8425-eb3f29ca7df3/image.png)




***

### useAxios

- ìš°ì„ , ì½”ë“œë¥¼ ìž‘ì„±ì¤‘ì´ë˜ codesandboxì— dependencyì¸ `axios`ë¥¼ ì¶”ê°€í•´ì¤€ë‹¤.
-> í•˜ë‹¨ì— ì˜ì¡´ì„± ì¶”ê°€ ì°½ì´ ìžˆìŒ.

![](https://velog.velcdn.com/images/thisisyjin/post/37e6fca5-46a6-4f18-a889-b5897e03a486/image.png)

#### 1. ì´ˆê¸° ì½”ë“œ

useAxios.js
``` jsx
import defaultAxios from 'axios';

const useAxios = (opts, axiosInstance = defaultAxios) => {
  // defaultAxiosë¥¼ ê¸°ë³¸ê°’ìœ¼ë¡œ ì„¤ì •.
  // axiosëŠ” customizeì™€ configureì„ í—ˆìš©í•¨. 
  // ë””í´íŠ¸ urlì´ë‚˜ í—¤ë” ì„¤ì • ë“±.
  
  if (!opts.url) {
    return;
  }
}

export default useAxios;
```

ì²«ë²ˆì§¸ ì¸ìžë¡œ `opts` ë¥¼ ì£¼ëŠ”ë°, optsëŠ” ê°ì²´ í˜•íƒœì´ê³ , url í•„ë“œë¥¼ ë°˜ë“œì‹œ í¬í•¨í•´ì•¼ í•œë‹¤.
-> if-returnë¬¸ìœ¼ë¡œ ê±¸ëŸ¬ì¤Œ



#### 2. App ì—ì„œ ì‚¬ìš©
``` jsx
import useAxios from './useAxios';

const App = () => {
  const request = useAxios({ url: "https://yts.am/api/v2/list_movies.json" });

  return <div>hello</div>;
};
```
-> ì²«ë²ˆì§¸ ì¸ìžì¸ optsë¥¼ ë„£ì–´ì¤Œ.
-> url í•„ë“œë¥¼ ë§Œë“œì‹œ í¬í•¨.

#### 3. useState + useEffect

``` jsx
const useAxios = (opts, axiosInstance = defaultAxios) => {
  // defaultAxiosë¥¼ ê¸°ë³¸ê°’ìœ¼ë¡œ ì„¤ì •.
  // axiosëŠ” customizeì™€ configureì„ í—ˆìš©í•¨.
  // ë””í´íŠ¸ urlì´ë‚˜ í—¤ë” ì„¤ì • ë“±.
  const [state, setState] = useState({
    loading: true,
    error: null,
    data: null
  });

  if (!opts.url) {
    return;
  }

  useEffect(() => {
    
  }, []); // í•œë²ˆë§Œ ë¶ˆëŸ¬ì˜¤ë„ë¡ depsë¥¼ ë¹ˆ ë°°ì—´ë¡œ

  return state;
};

export default useAxios;
```
-> useStateë¡œ ìƒíƒœë¥¼ ë§Œë“¤ì–´ì£¼ê³ , useEffect ì•ˆì—ì„œëŠ” axiosë¥¼ ìš”ì²­í•˜ëŠ” ì½”ë“œë¥¼ ë„£ì„ ê²ƒìž„.

stateë¡œëŠ” loading, error, data ê°€ ìžˆìŒ.

#### 4. setState

useAxios.js
``` jsx
const useAxios = (opts, axiosInstance = defaultAxios) => {
  const [state, setState] = useState({
    loading: true,
    error: null,
    data: null
  });

  if (!opts.url) {
    return;
  }

  useEffect(() => {
    axiosInstance(opts).then((data) => {
      setState({
        ...state,
        loading: false,
        data
      });
    });
  }, []); // í•œë²ˆë§Œ ë¶ˆëŸ¬ì˜¤ë„ë¡ depsë¥¼ ë¹ˆ ë°°ì—´ë¡œ

  return state;
};
```



App.js
``` jsx
const App = () => {
  const { loading, data, error } = useAxios({
    url: "https://yts.mx/api/v2/list_movies.json"
  });
  console.log(loading, data, error);

  return <div>hello</div>;
};
```

ë‘ë²ˆì§¸ ì¸ìžë¥¼ ì•ˆì¤¬ìœ¼ë¯€ë¡œ defaultAxiosê°€ **axiosInstanceê°€** ëœë‹¤. (ê¸°ë³¸ê°’)

ðŸ”» ê²°êµ­ ì´ëŸ° êµ¬ì¡°ì¸ ì…ˆ.
``` js
axios({url: ~~~}).then( data => {
setState({~~~}) } 
```


![](https://velog.velcdn.com/images/thisisyjin/post/94e0e423-cd3b-4297-b631-9195f9c6e255/image.png)

-> ë°ì´í„°ê°€ ë“¤ì–´ì˜¤ê³ , loadingì´ falseë¡œ ë°”ë€œ.

#### 5. ì—ëŸ¬ catch
-> .then() ë’¤ì— .catch(e => {}) ì¶”ê°€.

``` jsx
useEffect(() => {
    axiosInstance(opts)
      .then((data) => {
        setState({
          ...state,
          loading: false,
          data
        });
      })
      .catch((error) => {
        setState({ ...state, loading: false, error });
      });
  }, []); // í•œë²ˆë§Œ ë¶ˆëŸ¬ì˜¤ë„ë¡ depsë¥¼ ë¹ˆ ë°°ì—´ë¡œ
```


### refetching (ë‹¤ì‹œ ê°€ì ¸ì˜¤ê¸°)
-> `useEffect`ëŠ” deps ì•ˆì— ìƒíƒœê°€ ë°”ë€” ë•Œ ë§ˆë‹¤ ì‹¤í–‰ëœë‹¤.


1. trigger state ì¶”ê°€ + `refetch()` í•¨ìˆ˜
``` jsx
const [trigger, setTrigger] = useState(0);

...

const refetch = () => {
    setState({
      ...state,
      loading: true
    });
    setTrigger(Date.now()); // ê³ ìœ í•œ ìž„ì˜ì˜ ìˆ«ìž ìƒì„±
  };
```
> ê³ ìœ í•œ ê°’ì„ ë„˜ê²¨ì£¼ê¸° ìœ„í•´ Date.now()ë¥¼ ì¼ìŒ.

2. useEffect ì¶”ê°€ - depsì— trigger ì¶”ê°€
``` jsx
useEffect(() => {
    axiosInstance(opts)
      .then((data) => {
        ...
      })
      .catch((error) => {
        ...
      });
  }, [trigger]); // triggerì´ ë³€ê²½ë ë•Œë§ˆë‹¤ ë¦¬íŒ¨ì¹­
```

3. return trigger
``` js
return { ...state, refetch }
```
-> state ë¥¼ íŽ¼ì³ì„œ -> {loading, error, data}ë¥¼ íŽ¼ì³ì„œ ë¦¬í„´í•¨.
ì¦‰, {loading, error, data, refetch} ìž„.


4. App ìˆ˜ì •
``` jsx
const App = () => {
  const { loading, data, error, refetch } = useAxios({
    url: "https://yts.mx/api/v2/list_movies.json"
  });
  console.log(loading, data, error);

  return (
    <div>
      <h1>{data && data.status}</h1>
      <h2>{loading && "loading ..."}</h2>
      <button onClick={refetch}>Refetch</button>
    </div>
  );
};
```
### Result

![](https://velog.velcdn.com/images/thisisyjin/post/47630678-94af-4a8a-b9d1-5b93079eba34/image.gif)
-> refetch í• ë•Œë§ˆë‹¤ íŒ¨ì¹˜í•¨.

***

ì§€ê¸ˆê¹Œì§€ ì•„ëž˜ì™€ ê°™ì€ Hookì„ ì œìž‘í•´ë´„.

![](https://velog.velcdn.com/images/thisisyjin/post/1aa1797c-c005-4290-9e1a-e81f2428e899/image.png)

***

## NPM publishing 

> [ì°¸ê³  ë¬¸ì„œ](https://www.daleseo.com/js-npm-publish/)

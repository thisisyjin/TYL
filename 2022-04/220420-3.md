# React.js

**Today I Learned ... **`react.js`

>ğŸ™‹â€â™‚ï¸ [**React.js Lecture**](https://www.youtube.com/watch?v=KDJNjLZrqJk&list=PLcqDmjxt30RtqbStQqk-eYMK8N-1SYIFn)

>ğŸ™‹â€ [**My Dev Blog**](https://mywebproject.tistory.com/)



***  

### ì§€ë‚œ ì‹œê°„ ë¦¬ë·°

- **React.createContext**
exportí•˜ì—¬ í•˜ìœ„ ì»´í¬ë„ŒíŠ¸ì—ì„œë„ ì‚¬ìš© ê°€ëŠ¥í•˜ê²Œ.
-> ()ì•ˆì— ì´ˆê¸°ê°’ì„ ì‘ì„±í•´ì¤€ë‹¤.

- **useContext**
importí•œ contextëª…ì„ ì‘ì„±í•´ì¤€ë‹¤.


- JSXë‚´ì—ì„œ `<Provider value={value}>`
-> valueëŠ” useMemoë¡œ ìºì‹±í•´ì¤˜ì•¼ ì„±ëŠ¥ ìµœì í™” ê°€ëŠ¥.


***

>  ### **React Lecture CH 8**
~~1 - context API 
2 - createContextì™€ Provider
3 - useContext~~ 
4 - ì¢Œí´ë¦­, ìš°í´ë¦­ ë¡œì§
5 - ì§€ë¢° ê°œìˆ˜ í‘œì‹œ
6 - ë¹ˆì¹¸ í•œë²ˆì— ì—´ê¸°
7 - ìŠ¹ë¦¬ ì¡°ê±´ ì²´í¬, íƒ€ì´ë¨¸
8 - context API ìµœì í™”


## ì¢Œí´ë¦­, ìš°í´ë¦­ ë¡œì§

### 1) ì¢Œí´ë¦­ - OPEN_CELL 

MineSearch.jsx

``` jsx
const reducer = (state, action) => {
  switch (action.type) {
    case START_GAME:
      return {
        ...state,
        tableData: plantMine(action.row, action.cell, action.mine),
      };
      // ğŸ”» ì¶”ê°€
    case OPEN_CELL: {
      const tableData = [...state.tableData];
      tableData[action.row] = [...state.tableData[action.row]];
      tableData[action.row][action.cell] = CODE.OPENED;
      return {
        ...state,
        tableData,
      };
    }

    default:
      return state;
  }
};
```

- ì–•ì€ ë³µì‚¬ë¥¼ í•œ í›„([...]), í•´ë‹¹ ì…€ì— CODE.OPENEDë¥¼ í• ë‹¹í•˜ë©´ ëœë‹¤.


Td.jsx
``` jsx
const Td = ({ rowIndex, cellIndex }) => {
  const { tableData, dispatch } = useContext(TableContext);

  const onClickTd = useCallback(() => {
    dispatch({ type: OPEN_CELL, row: rowIndex, cell: cellIndex });
  }, []);

  return (
    <td style={getTdStyle(tableData[rowIndex][cellIndex])} onClick={onClickTd}>
      {getTdText(tableData[rowIndex][cellIndex])}
    </td>
  );
};
```
- Tdë¥¼ í´ë¦­í–ˆì„ë•Œ ë°œìƒí•˜ëŠ” `onClickTd` í•¨ìˆ˜ë¥¼ ì‘ì„±í•¨. 
- JSX ì–´íŠ¸ë¦¬ë·°íŠ¸ì— ì§ì ‘ ë„£ëŠ” í•¨ìˆ˜ëŠ” -> `useCallback` ì‚¬ìš©!


- dispatchë¥¼ useContextë¡œ ë°›ì•„ì˜¨ í›„, action ê°ì²´ë¥¼ ë„£ì–´ì¤Œ.
-> row, cell ì •ë³´ëŠ” ê°ê° (propsë¡œ ë°›ì€) rowIndex, cellIndexë¥¼ ëŒ€ì….


**_<ê²°ê³¼>_**
Tdë¥¼ í´ë¦­ì‹œ í•˜ì–€ìƒ‰ìœ¼ë¡œ ë³€í•¨.
ì¦‰, tableData[rowIndex][cellIndex]ì— `CODE.OPENED`ê°€ ëŒ€ì…ë˜ì–´, getTdStyleì— ì˜í•´ backgroundê°€ `#fff`ê°€ ë˜ëŠ” ê²ƒ.
![](https://velog.velcdn.com/images/thisisyjin/post/331ae174-b5fb-46fa-923c-8c0b453e3291/image.gif)


> í•´ê²°í•  ì 
- ì§€ë¢°ê°€ ìˆëŠ” ë¶€ë¶„ë„ í•˜ì–—ê²Œ ë¨
- ìˆ«ìê°€ ë‚˜ì™€ì•¼ í•¨


### onClickTd ì„¸ë¶„í™”

- `tableData[rowIndex][cellIndex]` ì˜ ê°’ì— ë”°ë¼ì„œ ë™ì‘ì´ ë‹¬ë¼ì ¸ì•¼í•¨.
-> **switchë¬¸**ì„ ì´ìš©.

Td.jsx
``` jsx
const onClickTd = useCallback(() => {
    switch (tableData[rowIndex][cellIndex]) {
      case CODE.OPENED:
      case CODE.FLAG_MINE:
      case CODE.FLAG:
      case CODE.QUESTION_MINE:
      case CODE.QUESTION:
        return;
      case CODE.NORMAL:
        dispatch({ type: OPEN_CELL, row: rowIndex, cell: cellIndex });
        return;
      case CODE.MINE:
        dispatch({ type: CLICK_MINE, row: rowIndex, cell: cellIndex });
        return;
    }
  }, [tableData[rowIndex][cellIndex]]);
```

- OPENED, FLAG, QUESTIONì¼ë•ŒëŠ” í´ë¦­í•´ë„ ë³€í™”ê°€ ì—†ê²Œ í•¨. (return;ìœ¼ë¡œ ë¹ ì ¸ë‚˜ê°)
- NORMAL ì¼ë•ŒëŠ” OPEN_CELL ì•¡ì…˜ì´ ì‹¤í–‰ë˜ë„ë¡.
(ìƒíƒœëŠ” OPENEDê°€ ë˜ê³ , ìŠ¤íƒ€ì¼ë„ ì ìš©)
- MINEì„ í´ë¦­í–ˆì„ë•ŒëŠ” CLICK_MINE ì•¡ì…˜ì´ ì‹¤í–‰ë˜ë„ë¡. (ì§€ë¢°ê°€ í„°ì§€ëŠ” ì•¡ì…˜. ì¶”í›„ ì‘ì„±í•¨)


- useCallback ë‘ë²ˆì§¸ ì¸ìëŠ” ê·¸ ê°’ì´ ë°”ë€”ë•Œë§ˆë‹¤ í•¨ìˆ˜ë„ ë‹¤ì‹œ ì €ì¥ë˜ë„ë¡ í•¨.


### ìŠ¤íƒ€ì¼ + í…ìŠ¤íŠ¸ ì„¸ë¶„í™”

Td ì»´í¬ë„ŒíŠ¸ì˜ getTdStyle, getTdTextë¥¼ ìˆ˜ì •í•´ë³´ì.

``` jsx
const getTdStyle = (code) => {
  switch (code) {
    case CODE.NORMAL:
    case CODE.MINE:
      return {
        background: '#444',
      };
    case CODE.CLICKED_MINE:
    case CODE.OPENED:
      return {
        background: '#fff',
      };
    case CODE.QUESTION:
    case CODE.QUESTION_MINE:
      return {
        background: 'yellow', 
      };
    case CODE.FLAG:
    case CODE.FLAG_MINE:
      return {
        background: 'red',
      };
    default:
      return {
        background: '#fff',
      };
  }
};
```

``` jsx
const getTdText = (code) => {
  switch (code) {
    case CODE.NORMAL:
      return '';
    case CODE.MINE:
      return 'X';
    case CODE.CLICKED_MINE:
      return 'í‘';
    case CODE.FLAG:
    case CODE.FLAG_MINE:
      return '!';
    case CODE.QUESTION:
    case CODE.QUESTION_MINE:
      return '?';
    default:
      return '';
  }
};
```



***

### 2) ìš°í´ë¦­ - onContextMenu


Td.jsx
``` jsx
const onRightClickTd = useCallback(
    (e) => {
      e.preventDefault();
      switch (tableData[rowIndex][cellIndex]) {
        case CODE.NORMAL:
        case CODE.MINE:
          dispatch({ type: FLAG_CELL, row: rowIndex, cell: cellIndex });
          return;
        case CODE.FLAG:
        case CODE.FLAG_MINE:
          dispatch({ type: QUESTION_CELL, row: rowIndex, cell: cellIndex });
          return;
        case CODE.QUESTION:
        case CODE.QUESTION_MINE:
          dispatch({ type: NORMALIZE_CELL, row: rowIndex, cell: cellIndex });
          return;

        default:
          return;
      }
    },
    [tableData[rowIndex][cellIndex]]
  );

// JSX
return (
    <td
      style={getTdStyle(tableData[rowIndex][cellIndex])}
      onClick={onClickTd}
      onContextMenu={onRightClickTd}
    >
      {getTdText(tableData[rowIndex][cellIndex])}
    </td>
  );
```
- ìš°í´ë¦­ì‹œ ê¸°ë³¸ ë™ì‘ì„ ë§‰ê¸°ìœ„í•´ (ì»¨í…ìŠ¤íŠ¸ë©”ë‰´ê°€ ëœ¨ëŠ” ê²ƒ) **e.preventDefault**ë¥¼ í•´ì¤€ë‹¤.
- onRightClickTd í•¨ìˆ˜ë„ `tableData[rowIndex][cellIndex]`ì˜ ê°’ì— ì˜í•´ ë™ì‘ì´ ë‹¬ë¼ì ¸ì•¼ í•˜ë¯€ë¡œ, **switchë¬¸** ì‘ì„±.



MineSearch.jsx

``` jsx
...

export const START_GAME = 'START_GAME';
export const OPEN_CELL = 'OPEN_CELL';
export const CLICK_MINE = 'CLICK_MINE';
export const FLAG_CELL = 'FLAG_CELL';
export const QUESTION_CELL = 'QUESTION_CELL';
export const NORMALIZE_CELL = 'NORMALIZE_CELL';

```

- ìš°ì„  exportë¡œ ëª¨ë“ˆë¡œ ë§Œë“¤ê³ , Td ì—ì„œ ì „ë¶€ importí•¨.

> #### ì¶”ê°€ state - `halted`
- ì§€ë¢°ê°€ í„°ì¡Œì„ë•Œ ê²Œì„ì„ ì¼ì‹œì •ì§€í•˜ëŠ” state.
>
``` jsx
const initialState = {
  tableData: [],
  timer: 0,
  result: '',
  halted: false, // ğŸ‘ˆ ì¶”ê°€
};
```


- ì´ì œ, **CLICK_CELL ì•¡ì…˜**ì„ ì²˜ë¦¬í•˜ëŠ” reducerì„ ì‘ì„±í•´ë³´ë©´

``` jsx
case CLICK_MINE: {
      const tableData = [...state.tableData];
      tableData[action.row] = [...state.tableData[action.row]];
      tableData[action.row][action.cell] = CODE.CLICKED_MINE;
      return {
        ...state,
          tableData,
          halted: true,
      };
    }
```
- `halted`ë¥¼ trueë¡œ í•˜ì—¬ ê²Œì„ì´ ì¤‘ë‹¨ë˜ê²Œ í•œë‹¤.

- ë‹¨, **START_GAME ì•¡ì…˜**ì— return ë¶€ë¶„ì— halted: falseë¥¼ ì¶”ê°€í•˜ì—¬ ê²Œì„ì„ ë‹¤ì‹œ ì‹œì‘í•  ìˆ˜ ìˆë„ë¡.

``` jsx
case START_GAME:
      return {
        ...state,
        tableData: plantMine(action.row, action.cell, action.mine),
        halted: false,
      };
```


haltedë¥¼ initialStateì™€ creactContextì—ë„ ì¶”ê°€í•´ì£¼ê³ ,
Td ì»´í¬ë„ŒíŠ¸ì—ì„œ useContext()ë¡œ ë¶ˆëŸ¬ì™€ì¤€ë‹¤.

MineSearch.jsx
``` jsx
export const TableContext = createContext({
  tableData: [],
  halted: true,
  dispatch: () => {},
});

const initialState = {
  tableData: [],
  timer: 0,
  result: '',
  halted: true,
};
```
- ì´ˆê¸°ê°’ì€ trueë¡œ í•˜ê³ , ì²˜ìŒì— ë²„íŠ¼ í´ë¦­ì‹œ falseê°€ ë˜ê²Œ í•œë‹¤.


Td.jsx
``` jsx
  const { tableData, dispatch, halted } = useContext(TableContext);
```


1. ì´ˆê¸°ê°’ì€ **true**
2. ì‹œì‘ ë²„íŠ¼ í´ë¦­ì‹œ **false**ê°€ ë¨
3. if(halted) return; ìœ¼ë¡œ í•„í„°ë§ í•¨.
-> **onClickTd, onRightClickTd**ì—ì„œ.
-> `halter`ê°€ trueë©´ ì…€ í´ë¦­ ëª»í•˜ê²Œ (ê²Œì„ ì¤‘ë‹¨)

``` jsx
const onClickTd = useCallback(() => {
    if (halted) {
      return;
    }
  ...
}
  
const onRightClickTd = useCallback(
    (e) => {
      e.preventDefault();
      if (halted) {
        return;
      }
   ... 
}
      
```
<br>

#### ë‚˜ë¨¸ì§€ reducer ì‘ì„±

- **FLAG_CELL, QUESTION_CELL, NORMALIZE_CELL**ì— ëŒ€í•œ reducerë„ ì‘ì„±í•´ì¤Œ.

MineSearch.jsx
``` jsx
case FLAG_CELL: {
      const tableData = [...state.tableData];
      tableData[action.row] = [...state.tableData[action.row]];
      if (tableData[action.row][action.cell] === CODE.MINE) {
        tableData[action.row][action.cell] = CODE.FLAG_MINE;
      } else {
        tableData[action.row][action.cell] = CODE.FLAG;
      }
      return {
        ...state,
        tableData,
      };
    }
    case QUESTION_CELL: {
      const tableData = [...state.tableData];
      tableData[action.row] = [...state.tableData[action.row]];
      if (tableData[action.row][action.cell] === CODE.FLAG_MINE) {
        tableData[action.row][action.cell] = CODE.QUESTION_MINE;
      } else {
        tableData[action.row][action.cell] = CODE.QUESTION;
      }
      return {
        ...state,
        tableData,
      };
    }

    case NORMALIZE_CELL: {
      const tableData = [...state.tableData];
      tableData[action.row] = [...state.tableData[action.row]];
      if (tableData[action.row][action.cell] === CODE.QUESTION_MINE) {
        tableData[action.row][action.cell] = CODE.MINE;
      } else {
        tableData[action.row][action.cell] = CODE.NORMAL;
      }
      return {
        ...state,
        tableData,
      };
    }
```

- ì „ë¶€ ì›ë¦¬ëŠ” ê°™ë‹¤.

> - ìš°ì„ , ì›ë³¸ì´ ë³€í•˜ë©´ ì•ˆë˜ë¯€ë¡œ, ì–•ì€ ë³µì‚¬ë¥¼ í†µí•´ tableDataë¥¼ ë³µì‚¬í•œë‹¤.
- tableData[action.row]ë„ ì–•ì€ ë³µì‚¬ í•œë‹¤.
(ì´ì°¨ì› ë°°ì—´ì´ë¯€ë¡œ í¼ì³ì¤˜ì•¼í•¨)
- if-else ë¡œì§ìœ¼ë¡œ ì¼ë°˜ ì…€ì¸ì§€ (NORMAL), ì§€ë¢° ì…€ì¸ì§€ (MINE) ì²´í¬í•´ì„œ êµ¬ë¶„í•´ì¤Œ.


### Result

![](https://velog.velcdn.com/images/thisisyjin/post/101b25bd-7b91-425a-b0fe-91c314ed0785/image.gif)


***

## ì§€ë¢° ê°¯ìˆ˜ ë‚˜íƒ€ë‚´ê¸°

- ë¹ˆ ì¹¸ì„ ëˆ„ë¥´ë©´ **ì£¼ë³€ì— ì§€ë¢°ê°€ ëª‡ ê°œê°€ ìˆëŠ”ì§€** ë‚˜íƒ€ë‚´ì•¼ í•¨
-> OPEN_CELLì˜ reducerì— ì‘ì„±.

- ë¹ˆì¹¸ë§Œ ì—¬ëŸ¬ê°œ ìˆëŠ” ê³³ì„ ëˆŒë €ì„ ë•ŒëŠ”, ì£¼ë³€ ì¹¸ê¹Œì§€ **í•œë²ˆì— ì—´ë¦¬ê²Œ**
-> ì¬ê·€ë¥¼ í†µí•´ êµ¬í˜„.



### ì£¼ë³€ ì§€ë¢° ê°œìˆ˜ ì¹´ìš´íŠ¸

- OPEN_CELL ë¡œì§ êµ¬í˜„.
- ìœ„ or ì•„ë˜ì¹¸ì´ ì¡´ì¬í•˜ëŠ”ê°€ì— ëŒ€í•œ ì°¨ì´ë¡œ
ê²€ì‚¬í•´ì•¼í•  ì£¼ë³€ ì…€ì˜ ê°œìˆ˜ê°€ ë‹¬ë¼ì§.
-> ë§Œì•½ 


MineSearch.jsx

``` jsx
case OPEN_CELL: {
      const tableData = [...state.tableData];
      tableData[action.row] = [...state.tableData[action.row]];
      tableData[action.row][action.cell] = CODE.OPENED;

      let around = [];
      if (tableData[action.row - 1]) {
        around = around.concat(
          tableData[action.row - 1][action.cell - 1],
          tableData[action.row - 1][action.cell],
          tableData[action.row - 1][action.cell + 1]
        );
      }
      around = around.concat(
        tableData[action.row][action.cell - 1],
        tableData[action.row][action.cell + 1]
      );

      if (tableData[action.row + 1]) {
        around = around.concat(
          tableData[action.row + 1][action.cell - 1],
          tableData[action.row + 1][action.cell],
          tableData[action.row + 1][action.cell - 1]
        );
      }
      const count = around.filter((v) =>
        [CODE.MINE, CODE.FLAG_MINE, CODE.QUESTION_MINE].includes(v)
      ).length;
      console.log(around, count);
      tableData[action.row][action.cell] = count;

      return {
        ...state,
        tableData,
      };
    }
```


- concatì€ ë°°ì—´ê³¼ ë°°ì—´ì„ í•©ì³ì¤Œ.
 (ì›ë³¸ ë³€ê²½ì€ x. ìƒˆ ë°°ì—´ ë°˜í™˜)
 - ì£¼ë³€ì— ì§€ë¢°ê°€ ìˆëŠ”ì§€ ì¹´ìš´íŠ¸í•˜ì—¬ ê°œìˆ˜ë¥¼ ì…ˆ.
 -> filter([].includes()) ë¥¼ í•´ì„œ ì§€ë¢° ì…€ì„ ì €ì¥í•˜ê³ , ì´ ë°°ì—´ì˜ lengthëŠ” ê³§ ì§€ë¢°ì˜ ê°œìˆ˜ì„.
 
 
 
 Td.jsx
 
 ``` jsx
const getTdText = (code) => {
  switch (code) {
      		...
          default:
      return code || '';
  }
  ```
  - ê¸°ë³¸ì ìœ¼ë¡œ code (=tableData[rowIndex][cellIndex])ë¥¼ ì¶œë ¥í•˜ê³ , 
  0ì´ë©´(ì§€ë¢°ê°€ì—†ìœ¼ë©´) ê³µë°±ì„ ì¶œë ¥í•˜ê²Œ.
  
 

![](https://velog.velcdn.com/images/thisisyjin/post/dd7a2f1c-8b80-4098-ada9-a45ca599ab83/image.png)



> ë‹¤ìŒì‹œê°„ - ë¹ˆì¹¸ í•œë²ˆì— ì—´ë¦¬ê²Œ (**ì¬ê·€í•¨ìˆ˜**)

# React.js

**Today I Learned ... **`react.js`

>ğŸ™‹â€â™‚ï¸ [**React.js Lecture**](https://www.youtube.com/watch?v=KDJNjLZrqJk&list=PLcqDmjxt30RtqbStQqk-eYMK8N-1SYIFn)

>ğŸ™‹â€ [**My Dev Blog**](https://mywebproject.tistory.com/)

***

>  ### **React Lecture CH 8**
~~1 - context API 
2 - createContextì™€ Provider
3 - useContext 
4 - ì¢Œí´ë¦­, ìš°í´ë¦­ ë¡œì§
5 - ì§€ë¢° ê°œìˆ˜ í‘œì‹œ~~
6 - ë¹ˆì¹¸ í•œë²ˆì— ì—´ê¸°
7 - ìŠ¹ë¦¬ ì¡°ê±´ ì²´í¬, íƒ€ì´ë¨¸
8 - context API ìµœì í™”



## ë¹ˆì¹¸ í•œë²ˆì— ì—´ê¸°

- **ì¬ê·€ í•¨ìˆ˜**(recursion function)ë¥¼ ì´ìš©í•¨.


- ì…€ì„ í´ë¦­í•˜ë©´ ì£¼ë³€ì— ì§€ë¢°ê°€ ëª‡ê°œì¸ì§€ ì¹´ìš´íŠ¸í•œë‹¤.
- ë§Œì•½, ì£¼ë³€ì— ì§€ë¢°ê°€ í•˜ë‚˜ë„ ì—†ìœ¼ë©´ 0.
- 0ì¸ ì¹¸ì„ í´ë¦­í–ˆë‹¤ë©´, ê·¸ ì£¼ë³€ ì¹¸ë„ 0ì¸ì§€ í™•ì¸í•œë‹¤.
- ì£¼ë³€ì— ìˆëŠ” ëª¨ë“  0ì¸ ì¹¸ì´ í•œë²ˆì— ì—´ë¦°ë‹¤.

> **â• ì°¸ê³ ** - ì™œ ìœ„,ì•„ë˜ë§Œ ê²€ìƒ‰í•˜ëŠ”ê±´ì§€?
ì§€ë‚œë²ˆì— OPEN_CELL ë¡œì§ì—ì„œ ë§¨ ìœ—ì¤„ì¸ì§€, ë§¨ ë§ˆì§€ë§‰ì¤„ì¸ì§€ ì²´í¬í–ˆì—ˆë‹¤. ì™œ ì¢Œ,ìš°ëŠ” ì‹ ê²½ì“°ì§€ ì•ŠëŠ”ì§€?
-> ìë°”ìŠ¤í¬ë¦½íŠ¸ íŠ¹ì„±ìƒ tableData[row][cell]ì—ì„œ rowê°€ ì—†ìœ¼ë©´ undefinedê°€ ë‚˜ì™€ì„œ ì—ëŸ¬ê°€ ë°œìƒí•œë‹¤.
-> ì¦‰, ì—ëŸ¬ë¥¼ ë§‰ê¸° ìœ„í•´ì„œ rowë¥¼ ê²€ì‚¬í•˜ëŠ” ê²ƒ.



### checkAround í•¨ìˆ˜

MineSearch.jsx

``` jsx
const checkAround = (row, cell) => {
        if (
          [
            CODE.OPENED,
            CODE.FLAG_MINE,
            CODE.FLAG,
            CODE.MINE,
            CODE.QUESTION,
          ].includes(tableData[row][cell])
        ) {
          return;
        }

        if (
          row < 0 ||
          row > tableData.length ||
          cell < 0 ||
          cell > tableData[0].length
        ) {
          return;
        }

   	// ì£¼ë³€ ì…€ ê²€ì‚¬ - 1) rowê°€ ë§¨ ìœ„ê°€ ì•„ë‹ˆë¼ë©´ 
        let around = [];
        if (tableData[row - 1]) {
          around = around.concat(
            tableData[row - 1][cell - 1],
            tableData[row - 1][cell],
            tableData[row - 1][cell + 1]
          );
        }
  
  	// ê¸°ë³¸ - ì–‘ì˜† ì…€ ì¶”ê°€
        around = around.concat(
          tableData[row][cell - 1],
          tableData[row][cell + 1]
        );
  
  	// 2) rowê°€ ë§¨ ì•„ë˜ê°€ ì•„ë‹ˆë¼ë©´
        if (tableData[row + 1]) {
          around = around.concat(
            tableData[row + 1][cell - 1],
            tableData[row + 1][cell],
            tableData[row + 1][cell - 1]
          );
        }
  
  	// ì¹´ìš´íŠ¸ ì„¸ê¸°.
  	// í•„í„°ë§ í•´ì¤Œ. - ì§€ë¢°ì¸ ê²ƒì˜ ê°œìˆ˜ ì…ˆ
        const count = around.filter((v) =>
          [CODE.MINE, CODE.FLAG_MINE, CODE.QUESTION_MINE].includes(v)
        ).length;
  
  	// ì…€ ë‚´ìš©ì—(text) countê°€ ë Œë”ë§ë˜ê²Œ.
        tableData[row][cell] = count;
  
  	// ğŸ”» ìƒˆë¡œ ì¶”ê°€ëœ ì½”ë“œ
  	// í˜„ì¬ í´ë¦­í•œ ê²Œ countê°€ 0ì´ë©´?
        if (count === 0) {
          const near = [];
          if (row - 1 > -1) {
            // ì œì¼ ìœ—ì¹¸ì´ ì•„ë‹Œì§€ ì²´í¬
            near.push([row - 1, cell - 1]);
            near.push([row - 1, cell]);
            near.push([row - 1, cell + 1]);
          }
          near.push([row, cell - 1]);
          near.push([row, cell + 1]);
          if (row + 1 < tableData.length) {
            // ì œì¼ ì•„ë«ì¹¸ì´ ì•„ë‹Œì§€ ì²´í¬ 
            near.push([row + 1, cell - 1]);
            near.push([row + 1, cell]);
            near.push([row + 1, cell + 1]);
          }
            // nearì€ [3,2]ì™€ ê°™ì´ row, cellì´ ì €ì¥ë˜ì–´ìˆëŠ” ë°°ì—´ì´ë¯€ë¡œ ì´ì°¨ì›ë°°ì—´ì´ë‹¤.
          near.forEach((n) => {
            if (tableData[n[0]][n[1]] !== CODE.OPENED) {
              // nearì— í•´ë‹¹í•˜ëŠ” ì…€ë“¤ì´ OPENEDê°€ ì•„ë‹ˆë¼ë©´ 
              checkAround(n[0], n[1]);
              // ì¬ê·€í•¨ìˆ˜. (ìì‹ ì„ ë‹¤ì‹œí•œë²ˆ í˜¸ì¶œ)
            }
          });
        } else {
        }
      };
```


### ì½œìŠ¤íƒ exceedë¥¼ ë§‰ê¸° ìœ„í•œ ìºì‹±
- ì´ë¯¸ ì²´í¬í•œ ì…€ì€ ë‹¤ì‹œ ê²€ì‚¬í•˜ì§€ ì•Šë„ë¡ ìºì‹±ì´ í•„ìš”.
- ë§Œì•½, ì´ë¯¸ ì²´í¬í•œ ì…€ì„ ë˜ ê²€ì‚¬í•˜ë©´ ê³„ì† ë¬´í•œë°˜ë³µì´ ë˜ì–´ ì½œìŠ¤íƒ ì´ˆê³¼ ì˜¤ë¥˜ê°€ ë°œìƒí•¨.
![](https://velog.velcdn.com/images/thisisyjin/post/ac1dfdc2-9bff-498f-940b-3e0500e05371/image.png)

``` jsx
const checked = [];

const checkAround = (row, cell) => {
        
 ...
        
    // ì´ë¯¸ ê²€ì‚¬í•œ ì…€ì¸ì§€ í™•ì¸
   if (checked.includes(row + ',' + cell)) {
     return;
   } else {
     checked.push(row + ',' + cell);
   }
  
...

}

```


### ì¡°ê±´ì— ë”°ë¼ í•„í„°ë§
```jsx
const checkAround = (row, cell) => {
        console.log(row, cell);
        if (
          row < 0 ||
          row >= tableData.length ||
          cell < 0 ||
          cell >= tableData[0].length
        ) {
          return;
        } // ğŸ”º ìƒí•˜ì¢Œìš° ì—†ëŠ”ì¹¸ì€ ì•ˆ ì—´ê¸°
        if (
          [
            CODE.OPENED,
            CODE.FLAG,
            CODE.FLAG_MINE,
            CODE.QUESTION_MINE,
            CODE.QUESTION,
          ].includes(tableData[row][cell])
        ) {
          return;
        } // ğŸ”º ë‹«íŒ ì¹¸ì´ ì•„ë‹ˆë©´ ì—´ì§€ ë§ê¸°
        if (checked.includes(row + '/' + cell)) {
          return;
        } else {
          checked.push(row + '/' + cell);
        } // í•œ ë²ˆ ì—°ì¹¸ì€ ë¬´ì‹œí•˜ê¸°
  		// ë§Œì•½ ì—†ë‹¤ë©´ ìƒˆë¡œ ì¶”ê°€í•˜ê¸° (checkedì— push)
  ```




### < ê²°ê³¼ >
![](https://velog.velcdn.com/images/thisisyjin/post/c6863988-8d47-4680-940a-6787e2f9e279/image.gif)

***


## ìŠ¹ë¦¬ì¡°ê±´ ì²´í¬

### ì—´ë¦° ì¹¸ ìˆ˜ ì²´í¬

- ì§€ë¢°ë¥¼ ì œì™¸í•œ ë‚˜ë¨¸ì§€ ì¹¸ë“¤ì„ ë‹¤ ì—´ë©´ ìŠ¹ë¦¬.
- `10 * 10`ì—ì„œ ì§€ë¢°ê°€ 20ê°œë¼ ì¹˜ë©´,
`10*10` - 20 = 80ê°œì˜ ì…€ì„ ë¬´ì‚¬íˆ í´ë¦­í•˜ë©´ ì„±ê³µì„.
-> ì§€ë¢°ë¥¼ ê±´ë“¤ì´ë©´ haltedê°€ trueê°€ ë˜ì–´ ì¼ì‹œì¤‘ì§€ë˜ë¯€ë¡œ,
ê²°êµ­ì—” ì…€ì„ 80ê°œ í´ë¦­í•˜ë©´ ìŠ¹ë¦¬.



- ì¹¸ì„ í•˜ë‚˜ ì—´ë•Œë§ˆë‹¤ ì¦ê°€í•˜ëŠ” `opendedCount`ë¥¼ ìƒì„±.

``` jsx
let openedCount = 0;

if (tableData[row][cell] === CODE.NORMAL) {
          // ë‚´ ì¹¸ì´ ë‹«íŒ ì¹¸ì´ë©´ -> ì˜¤í”ˆ ì¹´ìš´íŠ¸ ì¦ê°€
          openedCount += 1;
}
```

- stateì—ë„ ì¶”ê°€í•´ì¤Œ.
``` jsx
const initialState = {
  tableData: [],
  timer: 0,
  result: '',
  halted: true,
  openedCount: 0, // ğŸ‘ˆ ì¶”ê°€
};
```
- OPEN_CELLì˜ returnë¬¸ì—ë„ openedCountë¥¼ ì¶”ê°€í•´ì¤Œ.
``` jsx
case OPEN_CELL: {
  ...
  
return { 
        ...state,
        tableData,
        openedCount: state.openedCount + openedCount,
        halted,
        result,
      };
    }
```
-> ë§¨ ì²˜ìŒì— `state.openedCount` ëŠ” ì´ˆê¸°ê°’ 0ì´ê³ ,
`openedCount`ëŠ” í•œë²ˆ í´ë¦­í• ë•Œë§ˆë‹¤ (ì—¬ëŸ¬ ì¹¸ì´ ì—´ë¦¬ë©´ - openCountê°€ 2ì´ìƒì„) +1ì”© ë˜ì–´  ì´ì „ `openedCount`ê°’ì— ëˆ„ì ëœë‹¤.





### row, cell, mine - state ì¶”ê°€

- ëª¨ë“  ì¹¸ìˆ˜ê°€ ì—´ë¦°ì§€ í™•ì¸í•˜ê¸° ìœ„í•´ì„œëŠ”
- row, cell ìˆ˜ì™€ mineì˜ ê°œìˆ˜ë¥¼ ì•Œì•„ì•¼í•¨.
-> ì´ˆê¸° ì‚¬ìš©ìê°€ ì„¤ì •í•œëŒ€ë¡œ.



- **stateì— ì¶”ê°€**í•´ì¤€ë‹¤.
(row, cell, mineì€ ì„œë¡œ ê´€ë ¨ëœ ê·¸ë£¹ì´ë¯€ë¡œ ê°ì²´ í˜•ì‹ìœ¼ë¡œ ë¬¶ì–´ì¤Œ)

``` jsx
const initialState = {
  tableData: [],
  data: {		// ğŸ‘ˆ
    row: 0,
    cell: 0,
    mine: 0,
  },
  timer: 0,
  result: '',
  halted: true,
  openedCount: 0,
};
```

- state.dataëŠ” ê²Œì„ ì‹œì‘ ë²„íŠ¼ì„ ëˆŒë €ì„ ë•Œ,
(ì¦‰ START_GAMEì•¡ì…˜ì´ dispatch ë˜ì—ˆì„ ë•Œ) ì €ì¥ë˜ì–´ì•¼ í•œë‹¤.

``` jsx
case START_GAME:
      return {
        ...state,
        data: {
          row: action.row,
          cell: action.cell,
          mine: action.mine,
        },
        openedCount: 0,
        tableData: plantMine(action.row, action.cell, action.mine),
        halted: false,
        timer: 0,
      };
```




### ìŠ¹ë¦¬ ì¡°ê±´

``` jsx
if (
    state.data.row * state.data.cell - state.data.mine ===
    state.openedCount + openedCount
   ) {
    // ìŠ¹ë¦¬ì‹œ ì¼ì‹œì •ì§€ + result 
    halted = true;
    result = `ìŠ¹ë¦¬í•˜ì…¨ìŠµë‹ˆë‹¤`;
}
``` 


### < ê²°ê³¼ >

![](https://velog.velcdn.com/images/thisisyjin/post/80c64104-2890-44dd-a90d-9d3daa953064/image.gif)
- ì§€ë¢°ë¥¼ ì œì™¸í•œ ëª¨ë“  ì¹¸ì„ ì—´ì—ˆì„ë•Œ, ìŠ¹ë¦¬ ë¬¸êµ¬ê°€ ëœ¬ë‹¤.


***

## íƒ€ì´ë¨¸ ì„¤ì •

- actionì— ì¶”ê°€í•´ì¤Œ.
``` jsx
case INCREMENT_TIMER: {
      return {
        ...state,
        timer: state.timer + 1,
      };
}
```

- useEffectë¡œ setIntervalì„ ì‚¬ìš©í•´ì¤Œ.
``` jsx
useEffect(() => {
    let timer;
    if (halted === false) {
      timer = setInterval(() => {
        dispatch({ type: INCREMENT_TIMER });
      }, 1000);
    }
    return () => {
      clearInterval(timer);
    };
  }, [halted]);
```
-> 1ì´ˆë§ˆë‹¤ INCREMENT_TIMERì„ dispatch í•´ì¤˜ì„œ íƒ€ì´ë¨¸ê°€ 1ì”© ì¦ê°€í•˜ê²Œ í•¨.

> â—ï¸ ì£¼ì˜
- if(halted === false) ë¥¼ í•˜ì§€ ì•Šìœ¼ë©´, ì‹œì‘ ë²„íŠ¼ì„ ëˆ„ë¥´ì§€ ì•Šì•„ë„ íƒ€ì´ë¨¸ê°€ ì¦ê°€í•˜ê²Œ ëœë‹¤.
- useEffectì˜ ë‘ë²ˆì§¸ ì¸ìë¡œ haltedë¥¼ ë„˜ê²¨ì¤˜ì„œ, haltedê°€ ì—…ë°ì´íŠ¸ ë ë•Œë§ˆë‹¤ ì‹¤í–‰í•¨. (componentDidUpdate)

- claerIntervalì€ return()ì•ˆì— ì‘ì„±í•´ì£¼ë©´ ë¨. 
-> `clearInterval`ì€ ë‹¤ì‹œ haltedê°€ trueê°€ ë˜ì—ˆì„ ë•Œ 
(ìŠ¹ë¦¬í–ˆì„ ë•Œ or ì§€ë¢° í´ë¦­ì‹œ) ë©ˆì¶”ê²Œ í•œë‹¤.



### ìŠ¹ë¦¬ì¡°ê±´ì— resultì— timer ë Œë”ë§


``` jsx
if (
        state.data.row * state.data.cell - state.data.mine ===
        state.openedCount + openedCount
      ) {
        halted = true;
        result = `${state.timer}ì´ˆë§Œì— ìŠ¹ë¦¬í•˜ì…¨ìŠµë‹ˆë‹¤`; // ğŸ‘ˆ ì¶”ê°€
      }
```

***


## Context API ìµœì í™”

![](https://velog.velcdn.com/images/thisisyjin/post/1eda3afe-b8bb-4785-a901-747a2a81e2f8/image.gif)

- ë Œë”ë§ ë˜ëŠ” ê²ƒì„ ì‚´í´ë³´ë©´, 
í•˜ë‚˜ì˜ Tdë¥¼ ëˆŒë €ëŠ”ë° ëª¨ë“  ì…€ì´ ë‹¤ ë Œë”ë§ë˜ê³ ,
íƒ€ì´ë¨¸, ì¦‰ **setInterval**ì´ ì¼ì–´ë‚  ë•Œ ë§ˆë‹¤ ì „ì²´ê°€ ê³„ì† ë Œë”ë§ëœë‹¤.

-> contextAPIëŠ” ìµœì í™”ì— ì–´ë ¤ì›€ì´ ìˆë‹¤.



### React.memo ë¡œ ê°ì‹¸ì£¼ê¸°.

- Table.jsxì™€ Form.jsxë¥¼ React.memoë¡œ ê°ì‹¸ì¤€ë‹¤.
+ í•˜ìœ„ ì»´í¬ë„ŒíŠ¸ Tr, Tdì—ë„ memo ì ìš©.

![](https://velog.velcdn.com/images/thisisyjin/post/3d410593-0c77-4c78-a74f-36ae665cd795/image.gif)

> í•˜ìœ„ ì»´í¬ë„ŒíŠ¸ë„ memoê°€ ë˜ì–´ìˆì–´ì•¼ ìƒìœ„ ì»´í¬ë„ŒíŠ¸ì—ë„ memoê°€ ì ìš©ë  ìˆ˜ ìˆë‹¤.


> âœ… ì£¼ì˜ - Formì—ì„œ useContextë¥¼ ì‚¬ìš©í•˜ê¸° ë•Œë¬¸ì—
ì–´ì©” ìˆ˜ ì—†ì´ ë¦¬ë Œë”ë§ì´ ë°œìƒ.


- Td ì»´í¬ë„ŒíŠ¸ì— useMemoë¥¼ ì‚¬ìš©í•´ì¤€ë‹¤.
- Td ìì²´ëŠ” ì‹¤í–‰ë˜ì§€ë§Œ, ì‹¤ì œë¡œ return(=ë Œë”ë§)ì€ í´ë¦­í•œ ê°œìˆ˜ë§Œí¼ë§Œ ë˜ë„ë¡ í•œë‹¤.


``` jsx

import React, { useContext, useCallback, useMemo, memo } from 'react';
import {
  CLICK_MINE,
  CODE,
  FLAG_CELL,
  NORMALIZE_CELL,
  OPEN_CELL,
  QUESTION_CELL,
  TableContext,
} from './MineSearch';

const getTdStyle = (code) => {
  switch (code) {
    case CODE.NORMAL:
    case CODE.MINE:
      return {
        background: '#444',
      };
    case CODE.CLICKED_MINE:
    case CODE.OPENED:
      return {
        background: 'white',
      };
    case CODE.QUESTION_MINE:
    case CODE.QUESTION:
      return {
        background: 'yellow',
      };
    case CODE.FLAG_MINE:
    case CODE.FLAG:
      return {
        background: 'red',
      };
    default:
      return {
        background: 'white',
      };
  }
};

const getTdText = (code) => {
  console.log('getTdtext');
  switch (code) {
    case CODE.NORMAL:
      return '';
    case CODE.MINE:
      return 'X';
    case CODE.CLICKED_MINE:
      return 'í‘';
    case CODE.FLAG_MINE:
    case CODE.FLAG:
      return '!';
    case CODE.QUESTION_MINE:
    case CODE.QUESTION:
      return '?';
    default:
      return code || '';
  }
};

const Td = memo(({ rowIndex, cellIndex }) => {
  const { tableData, dispatch, halted } = useContext(TableContext);

  const onClickTd = useCallback(() => {
    if (halted) {
      return;
    }
    switch (tableData[rowIndex][cellIndex]) {
      case CODE.OPENED:
      case CODE.FLAG_MINE:
      case CODE.FLAG:
      case CODE.QUESTION_MINE:
      case CODE.QUESTION:
        return;
      case CODE.NORMAL:
        dispatch({ type: OPEN_CELL, row: rowIndex, cell: cellIndex });
        return;
      case CODE.MINE:
        dispatch({ type: CLICK_MINE, row: rowIndex, cell: cellIndex });
        return;
      default:
        return;
    }
  }, [tableData[rowIndex][cellIndex], halted]);

  const onRightClickTd = useCallback(
    (e) => {
      e.preventDefault();
      if (halted) {
        return;
      }
      switch (tableData[rowIndex][cellIndex]) {
        case CODE.NORMAL:
        case CODE.MINE:
          dispatch({ type: FLAG_CELL, row: rowIndex, cell: cellIndex });
          return;
        case CODE.FLAG_MINE:
        case CODE.FLAG:
          dispatch({ type: QUESTION_CELL, row: rowIndex, cell: cellIndex });
          return;
        case CODE.QUESTION_MINE:
        case CODE.QUESTION:
          dispatch({ type: NORMALIZE_CELL, row: rowIndex, cell: cellIndex });
          return;
        default:
          return;
      }
    },
    [tableData[rowIndex][cellIndex], halted]
  );

  console.log('td rendered');

  return (
    <RealTd
      onClickTd={onClickTd}
      onRightClickTd={onRightClickTd}
      data={tableData[rowIndex][cellIndex]}
    />
  );
});

const RealTd = memo(({ onClickTd, onRightClickTd, data }) => {
  console.log('real td rendered'); // ì‹¤ì œë¡œ ë Œë”ë§
  return (
    <td
      style={getTdStyle(data)}
      onClick={onClickTd}
      onContextMenu={onRightClickTd}
    >
      {getTdText(data)}
    </td>
  );
});

export default Td;
```
-> ì»´í¬ë„ŒíŠ¸ë¥¼ ìª¼ê°¤ ìˆ˜ ìˆìŒ.

<br>

### < ìµœì¢… ì™„ì„± >

![](https://velog.velcdn.com/images/thisisyjin/post/68b47812-4971-48a6-83c7-10542dd231b9/image.gif)


***



>[ì „ì²´ ì½”ë“œ -  Githubì— ì—…ë¡œë“œ](https://github.com/thisisyjin/TYL/tree/main/2022-04/react-zrc/mineSearch)


> [Reference Lecture](https://www.zerocho.com/)

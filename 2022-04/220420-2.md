# React.js

**Today I Learned ... **`react.js`

>ğŸ™‹â€â™‚ï¸ [**React.js Lecture**](https://www.youtube.com/watch?v=KDJNjLZrqJk&list=PLcqDmjxt30RtqbStQqk-eYMK8N-1SYIFn)

>ğŸ™‹â€ [**My Dev Blog**](https://mywebproject.tistory.com/)



***  

### ì§€ë‚œ ì‹œê°„ ë¦¬ë·°

- **useReducer**

stateë¥¼ í•˜ë‚˜ë¡œ ê´€ë¦¬í•˜ê¸° ìœ„í•¨.
actionê°ì²´ë¥¼ ì‹¤í–‰í•˜ëŠ” dispatch.
reducerë¡œ actionì„ ì²˜ë¦¬í•¨.

- **useReducerê³¼ Reduxì˜ ì°¨ì´**

ReduxëŠ” stateë¥¼ ë™ê¸°ì ìœ¼ë¡œ ë³€ê²½ë˜ì§€ë§Œ,
useReducerì€ **ë¹„ë™ê¸°ì **ìœ¼ë¡œ ë³€ê²½ë¨. (`useEffect` í•„ìš”)

- BUT. propsë¥¼ ìì† ì»´í¬ë„ŒíŠ¸ì—ê²Œ ë¬¼ë ¤ì¤„ë•Œ ëª¨ë“  ì¤‘ê°„ ì»´í¬ë„ŒíŠ¸ë“¤ì„ ë‹¤ ê±°ì³ì•¼ í–ˆìŒ.
(ì˜ˆ- tableData)
-> ì´ë¥¼ í•´ê²°í•˜ê¸° ìœ„í•´ì„œëŠ” **context API**ë¥¼ ì‚¬ìš©.


***

>  ### **React Lecture CH 8**
1 - context API 
2 - createContextì™€ Provider
3 - useContext 
4 - ì¢Œí´ë¦­, ìš°í´ë¦­ ë¡œì§
5 - ì§€ë¢° ê°œìˆ˜ í‘œì‹œ
6 - ë¹ˆì¹¸ í•œë²ˆì— ì—´ê¸°
7 - ìŠ¹ë¦¬ ì¡°ê±´ ì²´í¬, íƒ€ì´ë¨¸
8 - context API ìµœì í™”



## ì§€ë¢° ì°¾ê¸° ì´ˆê¸°ì½”ë“œ

- ì»´í¬ë„ŒíŠ¸ êµ¬ì„±
![](https://velog.velcdn.com/images/thisisyjin/post/0bebbec2-9e98-416e-9ced-761b14d0a701/image.png)
- useReducerì„ ì‚¬ìš©í•˜ë˜, ì´ë²ˆì—ëŠ” context APIë¥¼ ì¶”ê°€ë¡œ ì´ìš©í•¨.



MineSearch.jsx

``` jsx
import React, { useReducer } from 'react';
import Table from './Table';
import Form from './Form';

const initialState = {
  tableData: [],
  timer: 0,
  result: '',
};

const reducer = (state, action) => {
  switch (action.type) {
    default:
      return state;
  }
};

const MineSearch = () => {
  const [state, dispatch] = useReducer(reducer, initialState);

  return (
    <>
      <Form />
      <div>{state.timer}</div>
      <Table />
      <div>{state.result}</div>
    </>
  );
};

export default MineSearch;
```

- í•˜ìœ„ ì»´í¬ë„ŒíŠ¸ì¸ Formì€ ê°€ë¡œ*ì„¸ë¡œì˜ í¬ê¸°ì™€ ì§€ë¢° ê°œìˆ˜ë¥¼ ì •í•˜ëŠ” Inputë“¤ê³¼ 'ì‹œì‘'ë²„íŠ¼ì´ ì¡´ì¬í•¨.

- Form ì»´í¬ë„ŒíŠ¸ëŠ” í•˜ìœ„ ì»´í¬ë„ŒíŠ¸ì´ê³ , useReducerì´ ì•„ë‹Œ useStateë¥¼ ì´ìš©í•´ì„œ ì‘ì„±.


Form.jsx

``` jsx
import React, { useState, useCallback } from 'react';

const Form = () => {
  const [row, setRow] = useState(10);
  const [cell, setCell] = useState(10);
  const [mine, setMine] = useState(20);

  const onChangeRow = useCallback((e) => {
    setRow(e.target.value);
  });
  const onChangeCell = useCallback((e) => {
    setCell(e.target.value);
  });
  const onChangeMine = useCallback((e) => {
    setMine(e.target.value);
  });

  const onClickBtn = useCallback(() => {});

  return (
    <>
      <input
        type="number"
        placeholder="ê°€ë¡œ"
        value={row}
        onChange={onChangeRow}
      />
      <input
        type="number"
        placeholder="ì„¸ë¡œ"
        value={cell}
        onChange={onChangeCell}
      />
      <input
        type="number"
        placeholder="ì§€ë¢°"
        value={mine}
        onChange={onChangeMine}
      />

      <button onClick={onClickBtn}>ì‹œì‘</button>
    </>
  );
};

export default Form;
```

Form ì»´í¬ë„ŒíŠ¸ì˜ buttonì„ í´ë¦­ì‹œ (onClickBtn)
ê²Œì„ì´ ì‹œì‘ë˜ë„ë¡ í•´ì•¼ í•¨.

-> MineSearch ì»´í¬ë„ŒíŠ¸ì—ì„œ `dispatch`ë¥¼ ë„˜ê²¨ì¤˜ì•¼í•¨.

> - ê¸°ì¡´ ë°©ë²• - propsë¡œ ë„˜ê²¨ì¤€ë‹¤.
``` jsx
return <Form dispatch={dispatch}/>
```
>
- ìƒˆë¡œìš´ ë°©ë²• - **context API** ì´ìš©
-> ê·¸ ì•„ë˜ì— ìˆëŠ” ëª¨ë“  ì»´í¬ë„ŒíŠ¸ê°€ ë‹¤ ë°›ì„ ìˆ˜ ìˆìŒ.
(ì¤‘ê°„ ì»´í¬ë„ŒíŠ¸ë“¤ì„ ë¶ˆí•„ìš”í•˜ê²Œ ê±°ì¹  í•„ìš” X)


***

## createContextì™€ Provider

### createContext

``` jsx
import React, { useReducer, createContext } from 'react';

const TableContext = createContext(); // ê¸°ë³¸ê°’ ë„£ì„ìˆ˜ ìˆìŒ
```

### Provider

- ë°ì´í„°ì— ì ‘ê·¼í•˜ê³  ì‹¶ì€ ì»´í¬ë„ŒíŠ¸ë¥¼ context APIì˜ **Providerë¡œ** ë¬¶ì–´ì¤˜ì•¼í•¨.
- ì „ë‹¬í•´ì¤„ ë°ì´í„°ëŠ” **value** ì–´íŠ¸ë¦¬ë·°íŠ¸ë¡œ ì ì–´ì¤Œ.

``` jsx
return (
    <TableContext.Provider
      value={{tableData: state.tableData, dispatch}}
    >
      <Form />
      <div>{state.timer}</div>
      <Table />
      <div>{state.result}</div>
    </TableContext.Provider>
  );
```

> Provider ë€? 
- ê´€ì°°ì íŒ¨í„´ (**ë°ì´í„°ëŠ” ê³µê¸‰ìê°€ ê´€ë¦¬**í•˜ê³ , ê´€ì°°ìëŠ” **ê³µê¸‰ìë¥¼ êµ¬ë…í•˜ì—¬ ë°ì´í„°ë¥¼ ì–»ëŠ” ë°©ì‹**.)
![](https://velog.velcdn.com/images/thisisyjin/post/e91f699a-0795-441f-9ef7-d8f493d3a1e8/image.png)
-> [ì§€ë‚œ í¬ìŠ¤íŒ… ì°¸ì¡°](https://velog.io/@thisisyjin/TIL-22-04-08-2)

<br>

#### ì´ˆê¸°ê°’ ì„¤ì • + export í•´ì£¼ê¸°

``` jsx
export const TableContext = createContext({
  // ì´ˆê¸°ê°’. ì—¬ê¸°ì„  ì¤‘ìš”í•˜ì§€ ì•Šìœ¼ë‹ˆ ëª¨ì–‘ë§Œ ë§ì¶°ì£¼ê¸°
    tableData: [],
    dispatch: () => {}
}); 
```
-> ë‹¤ë¥¸ ì»´í¬ë„ŒíŠ¸ì—ì„œ import í•˜ì—¬ ì‚¬ìš© ê°€ëŠ¥í•˜ë„ë¡ export í•´ì¤Œ.



### useContext

Form.jsx

``` jsx
import React, { useState, useCallback, useContext } from 'react';
import { TableContext } from './MineSearch';

const Form = () => {
  const [row, setRow] = useState(10);
  const [cell, setCell] = useState(10);
  const [mine, setMine] = useState(20);

  const value = useContext(TableContext);
  
  ...
}
```

1. useContextë„ ì„í¬íŠ¸í•´ì¤Œ
2. MineSearch ì»´í¬ë„ŒíŠ¸ì˜ TableContextë¥¼ ì„í¬íŠ¸í•´ì˜´.
3. const value = useContext(TableContext) í•´ì¤Œ.
-> dispatchë¥¼ ì‚¬ìš©í•˜ê¸° ìœ„í•´ì„œ `value.dispatch` ì™€ ê°™ì´ ì‚¬ìš© ê°€ëŠ¥.
-> ê°€ë…ì„±ì„ ìœ„í•´ `{ dispatch }` ì™€ ê°™ì´ êµ¬ì¡°ë¶„í•´ í• ë‹¹ ê¶Œì¥.



> âœ… ì£¼ì˜ - ì„±ëŠ¥ ìµœì í™” ë¬¸ì œ
- context API ì‚¬ìš©ì‹œ ì„±ëŠ¥ ìµœì í™”ê°€ ë§¤ìš° ì–´ë ¤ì›€.
``` jsx
return (
    <TableContext.Provider value={{ tableData: state.tableData, dispatch }}>
      <Form />
      <div>{state.timer}</div>
      <Table />
      <div>{state.result}</div>
    </TableContext.Provider>
  );
```
-> ì—¬ê¸°ì„œ ì»´í¬ë„ŒíŠ¸ê°€ ë Œë”ë§ ë  ë•Œ ë§ˆë‹¤ 
value={{ tableData: state.tableData, dispatch }} ê°ì²´ê°€ ê³„ì† ìƒì„±ë˜ë¯€ë¡œ ìì‹ë“¤ë„ ë§¤ë²ˆ ìƒˆë¡­ê²Œ ë¦¬ë Œë”ë§ ë¨.
>
- useMemoë¥¼ í†µí•œ ìºì‹±(caching) ì´ í•„ìš”í•˜ë‹¤.


``` jsx
const MineSearch = () => {
  const [state, dispatch] = useReducer(reducer, initialState);

  const value = useMemo(
    () => ({
      tableData: state.tableData,
      dispatch,
    }),
    [state.tableData]
  );
  
  return (
    <TableContext.Provider value={value}>
      <Form />
      <div>{state.timer}</div>
      <Table />
      <div>{state.result}</div>
    </TableContext.Provider>
  );
};
```
- **useMemo**ëŠ” í•¨ìˆ˜ì˜ ê°’ì„ ì €ì¥í•œë‹¤.
- `tableData`ê°€ ë°”ë€” ë•Œë§ˆë‹¤ ê°’ì„ ë‹¤ì‹œ ì €ì¥í•˜ë„ë¡ í•œë‹¤.


<br>

### dispatch

Form.jsx

``` jsx
const onClickBtn = useCallback(() => {
      dispatch({type: START_GAME, row, cell, mine })
  }, [row, cell, mine]);
```

- actionì„ ì ì–´ì£¼ê³  **dispatchë¡œ** ì‹¤í–‰í•´ì¤Œ.
-> Form ì»´í¬ë„ŒíŠ¸ì—ì„œ ì‚¬ìš©ìê°€ ì„¤ì •í•œ **row, cell, mine**ì„ ì „ë‹¬í•´ì¤˜ì•¼ í•¨.

<br>

MineSearch.jsx

- actionì„ ë“±ë¡í•´ì£¼ê³ , reducerì—ë„ caseë¬¸ìœ¼ë¡œ ì‘ì„±.
``` jsx
...

export const START_GAME = 'START_GAME';

const reducer = (state, action) => {
  switch (action.type) {
    case START_GAME: {
      return {
        ...state,
        tableData: plantMine(action.row, action.cell, action.mine),
      };
    }
    default:
      return state;
  }
};

```
- ê²Œì„ì´ ì‹œì‘ë˜ë©´ 
-> 1) row*cell í…Œì´ë¸”ì„ ë§Œë“¤ê³ , 2) ì§€ë¢° ê°œìˆ˜ë§Œí¼ ì‹¬ì–´ì•¼ í•¨.
-> ì½”ë“œì˜ ì–‘ì´ ë§ìœ¼ë¯€ë¡œ í•˜ë‚˜ì˜ í•¨ìˆ˜ë¡œ ë¹¼ì¤Œ. (plantMine í•¨ìˆ˜)

***

### ì§€ë¢°ì°¾ê¸° ë¡œì§

tableDataë¥¼ ë³€ê²½í•˜ëŠ”ë°, ì§€ë‚œ í‹±íƒí†  ì˜ˆì œì™€ ë§ˆì°¬ê°€ì§€ë¡œ 2ì°¨ì› ë°°ì—´ë¡œ êµ¬ì„±ëœë‹¤.

ì§€ë¢°ëŠ” -7ë¡œ í‘œì‹œí•˜ê³ , ì¼ë°˜ ì…€ì€ -1ë¡œ, ê·¸ ì™¸ì—ë„ ë‹¤ì–‘í•œ ìƒíƒœë“¤ì„ ìˆ«ìë¡œ í‘œê¸°í•˜ì—¬ êµ¬ë¶„í•œë‹¤.

ì˜ˆ>

[-1, -1, -1, -1, -1, -7, -1, -1],
[-1, -1, -7, -1, -1, -1, -1, -1],
[-1, -1, -1, -7, -1, -1, -1, -1],
[-1, -1, -1, -1, -7, -1, -1, -1],
[-7, -1, -7, -1, -1, -1, -1, -1],
[-1, -1, -1, -7, -1, -1, -1, -1],
[-1, -1, -1, -1, -7, -7, -1, -1],
[-1, -1, -7, -1, -1, -1, -1, -1],

<br>


#### CODE ë³€ìˆ˜ ì„ ì–¸

- -1, -7ê³¼ ê°™ì´ ìˆ«ìë¡œë§Œ í‘œê¸°í•˜ë©´ ìˆ«ìê°€ ë­˜ ì˜ë¯¸í•˜ëŠ”ì§€ ëª¨ë¥´ë¯€ë¡œ, ì½”ë“œ ë³€ìˆ˜ë“¤ì„ ì €ì¥í•œ ê°ì²´ë¥¼ ì„ ì–¸í•œë‹¤.

- export í•˜ì—¬ ëª¨ë“ˆë¡œ ì‚¬ìš© ê°€ëŠ¥í•˜ë„ë¡ í•œë‹¤.
``` jsx
export const CODE = {
  MINE: -7,
  NORMAL: -1,
  QUESTION: -2,
  FLAG: -3,
  QUESTION_MINE: -4,
  FLAG_MINE: -5,
  CLICKED_MINE: -6,
  OPENED: 0, 
};
```

<center>* * *</center>

### plantMine í•¨ìˆ˜ ë¡œì§


``` jsx
const plantMine = (row, cell, mine) => {
  console.log(row, cell, mine);

  const candidate = Array(row * cell)
    .fill()
    .map((arr, i) => i);
  const shuffle = [];
  while (candidate.length > row * cell - mine) {
    shuffle.push(
      candidate.splice(Math.floor(Math.random() * candidate.length), 1)[0]
    );
  }
  const data = [];
  for (let i = 0; i < row; i++) {
    const rowData = [];
    data.push(rowData);
    for (let j = 0; j < cell; j++) {
      const cellData = [];
      rowData.push(CODE.NORMAL);
    }
  }
  for (let k = 0; k < shuffle.length; k++) {
    const ver = Math.floor(shuffle[k] / cell);
    const hor = shuffle[k] % cell;

    data[ver][hor] = CODE.MINE;
  }
  console.log(data);
  return data;
};
```


#### 1. candidate ë°°ì—´ ë§Œë“¤ê¸°
- row * cell ë§Œí¼ì˜ ì¹¸ ë§Œë“¤ê¸°.
- ë§Œì•½ 10*10ì´ë¼ë©´? 0~99ê¹Œì§€ë¥¼ ê°–ëŠ” ë°°ì—´ ë§Œë“¤ê¸°.
(mapìœ¼ë¡œ indexë¥¼ ë¦¬í„´í•¨)

<br>

#### 2. shuffle 
- candidate ë°°ì—´ì—ì„œ mine ë§Œí¼ ëœë¤ìœ¼ë¡œ ë½‘ê¸°.
-> 0~99ê¹Œì§€ì˜ ìˆ«ì ì¤‘ 20ê°œê°€ ë½‘íˆê²Œ ë¨.
- ëœë¤ìœ¼ë¡œ ë½‘ê¸° ìœ„í•´ ë¹ˆ ë°°ì—´ì¸ shuffleì—
push í•˜ëŠ” ë°©ì‹ìœ¼ë¡œ.
- candidate ë°°ì—´ì„ spliceí•˜ì—¬ ì˜ë¼ëƒ„.


<br>

#### 3. NORMAL ì½”ë“œ ì±„ì›€

- ì¤‘ì²© ë°˜ë³µë¬¸ì„ í†µí•´ row~cellì„ ìˆœíšŒí•˜ë©°
1) dataì— rowData (ë¹ˆ ë°°ì—´)ì„ pushí•œ í›„,
2) rowDataì— CODE.NORMALì„ pushí•¨.

> 1) data = []
>2) data.push(rowData)
-> data = [[],[],[],[],[],[],[],[],[],[]]
>3) rowData.push(CODE.NORMAL)
-> data = [[-1,-1,-1,-1,-1,-1,-1,-1,-1,-1],
[-1,-1,-1,-1,-1,-1,-1,-1,-1,-1],
[-1,-1,-1,-1,-1,-1,-1,-1,-1,-1],
[-1,-1,-1,-1,-1,-1,-1,-1,-1,-1],
... ]

-> 10*10ì˜ ê²½ìš° ëª¨ë“  100ê°œì˜ ìš”ì†Œë“¤ì´ CODE.NORMAL(-1)ì´ ëœ ê²ƒì„.


<br>

#### 4. MINE ì‹¬ê¸°

- shuffle ë°°ì—´ lengthë§Œí¼ ìˆœíšŒí•˜ëŠ” ë°˜ë³µë¬¸
- ì´ì°¨ì› ë°°ì—´ì´ë¯€ë¡œ í–‰, ì—´ì„ êµ¬í•´ì„œ
(ver, hor) ìœ„ì¹˜ì— ë§ê²Œ CODE.MINEì„ ëŒ€ì…í•¨.

> âœ… ì°¸ê³  - ì´ì°¨ì›ë°°ì—´ ìœ„ì¹˜ êµ¬í•˜ê¸°![](https://velog.velcdn.com/images/thisisyjin/post/4be21147-caf3-40de-89b5-858c5a9e117d/image.png)

- array **[number / cell] [number % cell]**


<br>

console.log(data)ë¥¼ í•´ë³´ë©´
ì•„ë˜ì™€ ê°™ì´ ì´ 10*10 í…Œì´ë¸”ì— 20ê°œì˜ ì§€ë¢°ê°€ ì‹¬ì–´ì ¸ìˆë‹¤.

![](https://velog.velcdn.com/images/thisisyjin/post/d107c6f0-47a9-4ef3-aee7-8926e07196b7/image.png)



***

### useContextë¡œ ë Œë”ë§

- ì´ì œ ì§€ë¢° ì¹¸ì„ ê°ê° ë Œë”ë§ í•´ì£¼ë©´ ëœë‹¤.


1. Table.jsx

``` jsx
import React, { useContext } from 'react';
import Tr from './Tr';
import { TableContext } from './MineSearch';

const Table = () => {
  const { tableData } = useContext(TableContext);
  return (
    <table>
      {Array(tableData.length)
        .fill()
        .map((tr, i) => (
          <Tr rowIndex={i} />
        ))}
    </table>
  );
};
export default Table;
```
- `useContext`ì™€ TableContext ì„í¬íŠ¸.
- ì§€ë‚œ ì˜ˆì œì—ì„œì²˜ëŸ¼ Array(length).fill().map()ì„ ì´ìš©í•˜ì—¬
tableDataì˜ ìš”ì†Œë“¤ì„ ë Œë”ë§í•¨.


- 10*10ì¼ë•Œ, 2ì°¨ì› ë°°ì—´ì¸ tableDataì˜ length=10ì´ë‹¤.
- ì´ 10ê°œì˜ Trì´ ë Œë”ë§ë¨.


<br>

2. Tr.jsx

``` jsx
import React, { useContext } from 'react';
import Td from './Td';
import { TableContext } from './MineSearch';

const Tr = ({ rowIndex }) => {
  const { tableData } = useContext(TableContext);
  return (
    <tr>
      {tableData[0] &&
        Array(tableData[0].length)
          .fill()
          .map((td, i) => <Td rowIndex={rowIndex} cellIndex={i} />)}
    </tr>
  );
};
export default Tr;

```
- ë§ˆì°¬ê°€ì§€ë¡œ `useContext`ì™€ tableContext ì„í¬íŠ¸.
- ì—¬ê¸°ì„œëŠ” í•œ rowì— í•´ë‹¹í•˜ëŠ” ì…€ì˜ lengthë§Œí¼ ë°˜ë³µ.
-> tableData[0]ì€ [-1,-1,-1,-1,-1,-1,-7,-1,-1,-1]ê³¼ ê°™ì´ ì´ 10ê°œì˜ ìš”ì†Œê°€ ì¡´ì¬í•¨.


- ë”°ë¼ì„œ 10ê°œì˜ Tdê°€ ë Œë”ë§ë¨




![](https://velog.velcdn.com/images/thisisyjin/post/22c6c35c-3b5a-4d79-a9e9-76386e728bc4/image.png)

***

### Td ì»´í¬ë„ŒíŠ¸ ìŠ¤íƒ€ì¼ë§

- ìŠ¤íƒ€ì¼ê³¼ í…ìŠ¤íŠ¸ë¥¼ ì…íˆê¸°.
- í•¨ìˆ˜ë¥¼ ì‚¬ìš©. (`getTdStyle`, `getTdText`)

Td.jsx

``` jsx
import React, { useContext } from 'react';
import { CODE, TableContext } from './MineSearch';

const getTdStyle = (code) => {
  switch (code) {
    case CODE.NORMAL:
    case CODE.MINE:
      return {
        background: '#444',
      };
    case CODE.OPENED:
      return {
        background: '#fff',
      };
    default:
      return {
        background: '#fff',
      };
  }
};

const getTdText = (code) => {
  switch (code) {
    case CODE.NORMAL:
      return '';
    case CODE.MINE:
      return 'X';
    default:
      return '';
  }
};

const Td = ({ rowIndex, cellIndex }) => {
  const { tableData } = useContext(TableContext);
  return (
    <td style={getTdStyle(tableData[rowIndex][cellIndex])}>
      {getTdText(tableData[rowIndex][cellIndex])}
    </td>
  );
};
export default Td;

```

- JSXì˜ `style` ì–´íŠ¸ë¦¬ë·°íŠ¸ì— í•¨ìˆ˜ì˜ ë¦¬í„´ê°’ì„ ë„£ì–´ì¤„ ìˆ˜ ìˆë‹¤.
- í•¨ìˆ˜ì˜ ì¸ìë¡œ tableDataë°°ì—´ì˜ ìš”ì†Œë¥¼ ë°›ëŠ”ë‹¤.
-1 (CODE.NORMAL), -7(CODE.MINE) ë“±ì„ êµ¬ë¶„í•  ìˆ˜ ìˆë‹¤.


- textì˜ ê²½ìš°ì—ëŠ” ì§€ë¢°ëŠ” xë¡œ í‘œì‹œë˜ê²Œ í•¨.
- background ìƒ‰ì„ ì‹œì»¤ë©“ê²Œ í•˜ê³ , 
í´ë¦­í•˜ë©´ í•˜ì–—ê²Œ ë˜ë„ë¡ í•¨.


#### <ê²°ê³¼>

![](https://velog.velcdn.com/images/thisisyjin/post/5e32ae67-55b1-422f-81a5-33d330d3a9dc/image.png)
